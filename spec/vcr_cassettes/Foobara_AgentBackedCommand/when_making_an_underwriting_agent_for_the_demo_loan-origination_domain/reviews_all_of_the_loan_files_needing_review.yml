---
http_interactions:
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"user","content":"{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"context\":{\"command_log\":[{\"command_name\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"},\"outcome\":{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}},{\"command_name\":\"Foobara::Agent::ListCommands\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}}]}}"}],"system":"You
        are implementing an API for a command named Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nAccepts the current goal, which might
        already be accomplished, and context of the work  so far and returns the inputs
        for the next command to run to make progress towards accomplishing the goal.
        If the goal has already been accomplished then choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.  \n\nHere is the inputs JSON schema for the data you will receive:\n\n{\"type\":\"object\",\"required\":[\"context\",\"goal\"],\"properties\":{\"goal\":{\"type\":\"string\",\"description\":\"The
        current goal to accomplish. If the goal has already been accomplished by the
        previous command runs then choose NotifyUserThatCurrentGoalHasBeenAccomplished
        to stop the loop.\"},\"context\":{\"type\":\"object\",\"properties\":{\"command_log\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"command_name\",\"outcome\"],\"properties\":{\"command_name\":{\"type\":\"string\",\"description\":\"Name
        of the command that was run\"},\"inputs\":{\"type\":[\"object\",\"null\"],\"description\":\"Inputs
        to the command\"},\"outcome\":{\"type\":\"object\",\"required\":[\"success\"],\"properties\":{\"success\":{\"type\":\"boolean\",\"description\":\"Whether
        the command succeeded or not\"},\"result\":{\"description\":\"Result of the
        command\"},\"errors_hash\":{\"description\":\"Errors that occurred during
        the command\"}}}}},\"description\":\"Log of all commands run so far and their
        outcomes\"}},\"description\":\"Context of the progress towards the goal so
        far\"}}}\n\nHere is the result JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command_name\"],\"properties\":{\"command_name\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will receive 1 message containing only JSON data according to the inputs JSON
        schema above\nand you will generate a JSON response that is a valid response
        according to the result JSON schema above.\n\nYou will reply with nothing
        more than the JSON you''ve generated so that the calling code\ncan successfully
        parse your answer.\n"}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Thu, 26 Jun 2025 05:25:51 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-26T05:25:50Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-26T05:25:51Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-26T05:25:46Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '48000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-26T05:25:50Z'
      Request-Id:
      - req_011CQWH1xCQGNXhRaxLCkSEQ
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 955a49360dd8ed3f-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01DuyC9xgMopp2jy1CWDPD3F","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":1112,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":36,"service_tier":"standard"}}'
  recorded_at: Thu, 26 Jun 2025 05:25:51 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"user","content":"{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"context\":{\"command_log\":[{\"command_name\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"},\"outcome\":{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}},{\"command_name\":\"Foobara::Agent::ListCommands\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}}]}}"}],"system":"You
        are implementing an API for a command named Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nAccepts the current goal, which might
        already be accomplished, and context of the work  so far and returns the inputs
        for the next command to run to make progress towards accomplishing the goal.
        If the goal has already been accomplished then choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.  \n\nHere is the inputs JSON schema for the data you will receive:\n\n{\"type\":\"object\",\"required\":[\"context\",\"goal\"],\"properties\":{\"goal\":{\"type\":\"string\",\"description\":\"The
        current goal to accomplish. If the goal has already been accomplished by the
        previous command runs then choose NotifyUserThatCurrentGoalHasBeenAccomplished
        to stop the loop.\"},\"context\":{\"type\":\"object\",\"properties\":{\"command_log\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"command_name\",\"outcome\"],\"properties\":{\"command_name\":{\"type\":\"string\",\"description\":\"Name
        of the command that was run\"},\"inputs\":{\"type\":[\"object\",\"null\"],\"description\":\"Inputs
        to the command\"},\"outcome\":{\"type\":\"object\",\"required\":[\"success\"],\"properties\":{\"success\":{\"type\":\"boolean\",\"description\":\"Whether
        the command succeeded or not\"},\"result\":{\"description\":\"Result of the
        command\"},\"errors_hash\":{\"description\":\"Errors that occurred during
        the command\"}}}}},\"description\":\"Log of all commands run so far and their
        outcomes\"}},\"description\":\"Context of the progress towards the goal so
        far\"}}}\n\nHere is the result JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command_name\"],\"properties\":{\"command_name\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will receive 1 message containing only JSON data according to the inputs JSON
        schema above\nand you will generate a JSON response that is a valid response
        according to the result JSON schema above.\n\nYou will reply with nothing
        more than the JSON you''ve generated so that the calling code\ncan successfully
        parse your answer.\n"}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Thu, 26 Jun 2025 05:25:55 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-26T05:25:54Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-26T05:25:55Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-26T05:25:51Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '48000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-26T05:25:54Z'
      Request-Id:
      - req_011CQWH2KAiXRcKBBk9tbQsb
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 955a4954f89cee17-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01WpGQx8ibmGkhA2A13f9quG","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file_id\":1}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":1260,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":38,"service_tier":"standard"}}'
  recorded_at: Thu, 26 Jun 2025 05:25:55 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"user","content":"{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"context\":{\"command_log\":[{\"command_name\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"},\"outcome\":{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}},{\"command_name\":\"Foobara::Agent::ListCommands\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file_id\":1},\"errors_hash\":{\"data.loan_file.missing_required_attribute\":{\"key\":\"data.loan_file.missing_required_attribute\",\"path\":[\"loan_file\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute loan_file\",\"context\":{\"attribute_name\":\"loan_file\"},\"is_fatal\":true}}}}]}}"}],"system":"You
        are implementing an API for a command named Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextStartUnderwriterReviewCommand
        which has the following description:\n\nAccepts a goal and context of the
        work so far and returns the inputs for the next StartUnderwriterReview command
        to run to make progress towards accomplishing the goal.  \n\nHere is the inputs
        JSON schema for the data you will receive:\n\n{\"type\":\"object\",\"required\":[\"context\",\"goal\"],\"properties\":{\"goal\":{\"type\":\"string\",\"description\":\"The
        current (possibly already accomplished) goal\"},\"context\":{\"type\":\"object\",\"properties\":{\"command_log\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"command_name\",\"outcome\"],\"properties\":{\"command_name\":{\"type\":\"string\",\"description\":\"Name
        of the command that was run\"},\"inputs\":{\"type\":[\"object\",\"null\"],\"description\":\"Inputs
        to the command\"},\"outcome\":{\"type\":\"object\",\"required\":[\"success\"],\"properties\":{\"success\":{\"type\":\"boolean\",\"description\":\"Whether
        the command succeeded or not\"},\"result\":{\"description\":\"Result of the
        command\"},\"errors_hash\":{\"description\":\"Errors that occurred during
        the command\"}}}}},\"description\":\"Log of all commands run so far and their
        outcomes\"}},\"description\":\"Context of the progress towards the goal so
        far\"}}}\n\nHere is the result JSON schema:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}\n\nYou will receive 1 message containing only JSON data according
        to the inputs JSON schema above\nand you will generate a JSON response that
        is a valid response according to the result JSON schema above.\n\nYou will
        reply with nothing more than the JSON you''ve generated so that the calling
        code\ncan successfully parse your answer.\n"}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Thu, 26 Jun 2025 05:26:00 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-26T05:25:59Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-26T05:26:00Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-26T05:25:55Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '48000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-26T05:25:59Z'
      Request-Id:
      - req_011CQWH2dZFdGFU3bRY4VVDt
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 955a496fbf70f94f-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_016PAW2FunkkhoYkaVGvHiBW","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"```json\n{\n  \"loan_file\":
        1\n}\n```"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":1429,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":20,"service_tier":"standard"}}'
  recorded_at: Thu, 26 Jun 2025 05:26:00 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"user","content":"{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"context\":{\"command_log\":[{\"command_name\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"},\"outcome\":{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}},{\"command_name\":\"Foobara::Agent::ListCommands\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file_id\":1},\"errors_hash\":{\"data.loan_file.missing_required_attribute\":{\"key\":\"data.loan_file.missing_required_attribute\",\"path\":[\"loan_file\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute loan_file\",\"context\":{\"attribute_name\":\"loan_file\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextStartUnderwriterReviewCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"loan_file\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}}]}}"}],"system":"You
        are implementing an API for a command named Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nAccepts the current goal, which might
        already be accomplished, and context of the work  so far and returns the inputs
        for the next command to run to make progress towards accomplishing the goal.
        If the goal has already been accomplished then choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.  \n\nHere is the inputs JSON schema for the data you will receive:\n\n{\"type\":\"object\",\"required\":[\"context\",\"goal\"],\"properties\":{\"goal\":{\"type\":\"string\",\"description\":\"The
        current goal to accomplish. If the goal has already been accomplished by the
        previous command runs then choose NotifyUserThatCurrentGoalHasBeenAccomplished
        to stop the loop.\"},\"context\":{\"type\":\"object\",\"properties\":{\"command_log\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"command_name\",\"outcome\"],\"properties\":{\"command_name\":{\"type\":\"string\",\"description\":\"Name
        of the command that was run\"},\"inputs\":{\"type\":[\"object\",\"null\"],\"description\":\"Inputs
        to the command\"},\"outcome\":{\"type\":\"object\",\"required\":[\"success\"],\"properties\":{\"success\":{\"type\":\"boolean\",\"description\":\"Whether
        the command succeeded or not\"},\"result\":{\"description\":\"Result of the
        command\"},\"errors_hash\":{\"description\":\"Errors that occurred during
        the command\"}}}}},\"description\":\"Log of all commands run so far and their
        outcomes\"}},\"description\":\"Context of the progress towards the goal so
        far\"}}}\n\nHere is the result JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command_name\"],\"properties\":{\"command_name\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will receive 1 message containing only JSON data according to the inputs JSON
        schema above\nand you will generate a JSON response that is a valid response
        according to the result JSON schema above.\n\nYou will reply with nothing
        more than the JSON you''ve generated so that the calling code\ncan successfully
        parse your answer.\n"}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Thu, 26 Jun 2025 05:26:03 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-26T05:26:03Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-26T05:26:03Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-26T05:26:00Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '48000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-26T05:26:03Z'
      Request-Id:
      - req_011CQWH2yN7yqxi3RdtLR9cJ
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 955a498ccf2dcf35-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01Q5KFohTWyLPqzsbwxUWwP1","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"id\":1}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":1773,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":31,"service_tier":"standard"}}'
  recorded_at: Thu, 26 Jun 2025 05:26:03 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"user","content":"{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"context\":{\"command_log\":[{\"command_name\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"},\"outcome\":{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}},{\"command_name\":\"Foobara::Agent::ListCommands\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file_id\":1},\"errors_hash\":{\"data.loan_file.missing_required_attribute\":{\"key\":\"data.loan_file.missing_required_attribute\",\"path\":[\"loan_file\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute loan_file\",\"context\":{\"attribute_name\":\"loan_file\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextStartUnderwriterReviewCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"loan_file\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"id\":1},\"errors_hash\":{\"data.credit_policy.missing_required_attribute\":{\"key\":\"data.credit_policy.missing_required_attribute\",\"path\":[\"credit_policy\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute credit_policy\",\"context\":{\"attribute_name\":\"credit_policy\"},\"is_fatal\":true}}}}]}}"}],"system":"You
        are implementing an API for a command named Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextFindCreditPolicyCommand
        which has the following description:\n\nAccepts a goal and context of the
        work so far and returns the inputs for the next FindCreditPolicy command to
        run to make progress towards accomplishing the goal.  \n\nHere is the inputs
        JSON schema for the data you will receive:\n\n{\"type\":\"object\",\"required\":[\"context\",\"goal\"],\"properties\":{\"goal\":{\"type\":\"string\",\"description\":\"The
        current (possibly already accomplished) goal\"},\"context\":{\"type\":\"object\",\"properties\":{\"command_log\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"command_name\",\"outcome\"],\"properties\":{\"command_name\":{\"type\":\"string\",\"description\":\"Name
        of the command that was run\"},\"inputs\":{\"type\":[\"object\",\"null\"],\"description\":\"Inputs
        to the command\"},\"outcome\":{\"type\":\"object\",\"required\":[\"success\"],\"properties\":{\"success\":{\"type\":\"boolean\",\"description\":\"Whether
        the command succeeded or not\"},\"result\":{\"description\":\"Result of the
        command\"},\"errors_hash\":{\"description\":\"Errors that occurred during
        the command\"}}}}},\"description\":\"Log of all commands run so far and their
        outcomes\"}},\"description\":\"Context of the progress towards the goal so
        far\"}}}\n\nHere is the result JSON schema:\n\n{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}}\n\nYou will receive 1 message containing only JSON data according
        to the inputs JSON schema above\nand you will generate a JSON response that
        is a valid response according to the result JSON schema above.\n\nYou will
        reply with nothing more than the JSON you''ve generated so that the calling
        code\ncan successfully parse your answer.\n"}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Thu, 26 Jun 2025 05:26:08 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-26T05:26:07Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-26T05:26:07Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-26T05:26:03Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '48000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-26T05:26:07Z'
      Request-Id:
      - req_011CQWH3CyBDc86kH4MZWxum
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 955a49a0b87eed3a-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_014XgBpz1pFFG4xizwx26i25","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"credit_policy\":1}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":1934,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":10,"service_tier":"standard"}}'
  recorded_at: Thu, 26 Jun 2025 05:26:08 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"user","content":"{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"context\":{\"command_log\":[{\"command_name\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"},\"outcome\":{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}},{\"command_name\":\"Foobara::Agent::ListCommands\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file_id\":1},\"errors_hash\":{\"data.loan_file.missing_required_attribute\":{\"key\":\"data.loan_file.missing_required_attribute\",\"path\":[\"loan_file\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute loan_file\",\"context\":{\"attribute_name\":\"loan_file\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextStartUnderwriterReviewCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"loan_file\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"id\":1},\"errors_hash\":{\"data.credit_policy.missing_required_attribute\":{\"key\":\"data.credit_policy.missing_required_attribute\",\"path\":[\"credit_policy\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute credit_policy\",\"context\":{\"attribute_name\":\"credit_policy\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextFindCreditPolicyCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"credit_policy\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"institutional_investor_name\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"required_pay_stub_quantity\":1}}}]}}"}],"system":"You
        are implementing an API for a command named Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nAccepts the current goal, which might
        already be accomplished, and context of the work  so far and returns the inputs
        for the next command to run to make progress towards accomplishing the goal.
        If the goal has already been accomplished then choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.  \n\nHere is the inputs JSON schema for the data you will receive:\n\n{\"type\":\"object\",\"required\":[\"context\",\"goal\"],\"properties\":{\"goal\":{\"type\":\"string\",\"description\":\"The
        current goal to accomplish. If the goal has already been accomplished by the
        previous command runs then choose NotifyUserThatCurrentGoalHasBeenAccomplished
        to stop the loop.\"},\"context\":{\"type\":\"object\",\"properties\":{\"command_log\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"command_name\",\"outcome\"],\"properties\":{\"command_name\":{\"type\":\"string\",\"description\":\"Name
        of the command that was run\"},\"inputs\":{\"type\":[\"object\",\"null\"],\"description\":\"Inputs
        to the command\"},\"outcome\":{\"type\":\"object\",\"required\":[\"success\"],\"properties\":{\"success\":{\"type\":\"boolean\",\"description\":\"Whether
        the command succeeded or not\"},\"result\":{\"description\":\"Result of the
        command\"},\"errors_hash\":{\"description\":\"Errors that occurred during
        the command\"}}}}},\"description\":\"Log of all commands run so far and their
        outcomes\"}},\"description\":\"Context of the progress towards the goal so
        far\"}}}\n\nHere is the result JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command_name\"],\"properties\":{\"command_name\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will receive 1 message containing only JSON data according to the inputs JSON
        schema above\nand you will generate a JSON response that is a valid response
        according to the result JSON schema above.\n\nYou will reply with nothing
        more than the JSON you''ve generated so that the calling code\ncan successfully
        parse your answer.\n"}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Thu, 26 Jun 2025 05:27:06 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '39000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-26T05:27:07Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-26T05:27:06Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-26T05:27:03Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '47000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-26T05:27:06Z'
      Request-Id:
      - req_011CQWH7di546jy4Xzjde2P1
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 955a4b17da50ebe9-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_011uGECkfGYFjC2oCpnUC6Ud","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"inputs\":{\"loan_file_id\":1,\"reason\":\"Credit
        score below minimum requirement\"}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2215,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":62,"service_tier":"standard"}}'
  recorded_at: Thu, 26 Jun 2025 05:27:06 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"user","content":"{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"context\":{\"command_log\":[{\"command_name\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"},\"outcome\":{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}},{\"command_name\":\"Foobara::Agent::ListCommands\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file_id\":1},\"errors_hash\":{\"data.loan_file.missing_required_attribute\":{\"key\":\"data.loan_file.missing_required_attribute\",\"path\":[\"loan_file\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute loan_file\",\"context\":{\"attribute_name\":\"loan_file\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextStartUnderwriterReviewCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"loan_file\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"id\":1},\"errors_hash\":{\"data.credit_policy.missing_required_attribute\":{\"key\":\"data.credit_policy.missing_required_attribute\",\"path\":[\"credit_policy\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute credit_policy\",\"context\":{\"attribute_name\":\"credit_policy\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextFindCreditPolicyCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"credit_policy\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"institutional_investor_name\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"required_pay_stub_quantity\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"errors_hash\":{\"data.value_not_valid\":{\"key\":\"data.value_not_valid\",\"path\":[],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"value_not_valid\",\"message\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand
        is not one of [\\\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\\\",
        \\\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\\\", \\\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\\\",
        \\\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\\\", \\\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\\\",
        \\\"FoobaraDemo::LoanOrigination::StartLoanApplication\\\", \\\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\\\",
        \\\"FoobaraDemo::LoanOrigination::FindCreditPolicy\\\", \\\"FoobaraDemo::LoanOrigination::ApproveLoanFile\\\",
        \\\"FoobaraDemo::LoanOrigination::AddCreditScore\\\", \\\"FoobaraDemo::LoanOrigination::FindLoanFile\\\",
        \\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\", \\\"FoobaraDemo::LoanOrigination::AddPayStub\\\",
        \\\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\\\", \\\"Foobara::Agent::DescribeCommand\\\",
        \\\"Foobara::Agent::DescribeType\\\", \\\"Foobara::Agent::GiveUp\\\", \\\"Foobara::Agent::ListCommands\\\",
        \\\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\\\"]\",\"context\":{\"value\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"valid_values\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\",\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]},\"is_fatal\":false}}}}]}}"}],"system":"You
        are implementing an API for a command named Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nAccepts the current goal, which might
        already be accomplished, and context of the work  so far and returns the inputs
        for the next command to run to make progress towards accomplishing the goal.
        If the goal has already been accomplished then choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.  \n\nHere is the inputs JSON schema for the data you will receive:\n\n{\"type\":\"object\",\"required\":[\"context\",\"goal\"],\"properties\":{\"goal\":{\"type\":\"string\",\"description\":\"The
        current goal to accomplish. If the goal has already been accomplished by the
        previous command runs then choose NotifyUserThatCurrentGoalHasBeenAccomplished
        to stop the loop.\"},\"context\":{\"type\":\"object\",\"properties\":{\"command_log\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"command_name\",\"outcome\"],\"properties\":{\"command_name\":{\"type\":\"string\",\"description\":\"Name
        of the command that was run\"},\"inputs\":{\"type\":[\"object\",\"null\"],\"description\":\"Inputs
        to the command\"},\"outcome\":{\"type\":\"object\",\"required\":[\"success\"],\"properties\":{\"success\":{\"type\":\"boolean\",\"description\":\"Whether
        the command succeeded or not\"},\"result\":{\"description\":\"Result of the
        command\"},\"errors_hash\":{\"description\":\"Errors that occurred during
        the command\"}}}}},\"description\":\"Log of all commands run so far and their
        outcomes\"}},\"description\":\"Context of the progress towards the goal so
        far\"}}}\n\nHere is the result JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command_name\"],\"properties\":{\"command_name\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will receive 1 message containing only JSON data according to the inputs JSON
        schema above\nand you will generate a JSON response that is a valid response
        according to the result JSON schema above.\n\nYou will reply with nothing
        more than the JSON you''ve generated so that the calling code\ncan successfully
        parse your answer.\n"}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Thu, 26 Jun 2025 05:27:10 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '39000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-26T05:27:11Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-26T05:27:10Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-26T05:27:06Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '47000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-26T05:27:10Z'
      Request-Id:
      - req_011CQWH7rR3v3jFfKjWGdHoz
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 955a4b2a6a62df9a-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_018iCtKstvMuniCgt7siB4xy","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":3215,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":34,"service_tier":"standard"}}'
  recorded_at: Thu, 26 Jun 2025 05:27:10 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"user","content":"{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"context\":{\"command_log\":[{\"command_name\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"},\"outcome\":{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}},{\"command_name\":\"Foobara::Agent::ListCommands\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file_id\":1},\"errors_hash\":{\"data.loan_file.missing_required_attribute\":{\"key\":\"data.loan_file.missing_required_attribute\",\"path\":[\"loan_file\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute loan_file\",\"context\":{\"attribute_name\":\"loan_file\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextStartUnderwriterReviewCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"loan_file\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"id\":1},\"errors_hash\":{\"data.credit_policy.missing_required_attribute\":{\"key\":\"data.credit_policy.missing_required_attribute\",\"path\":[\"credit_policy\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute credit_policy\",\"context\":{\"attribute_name\":\"credit_policy\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextFindCreditPolicyCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"credit_policy\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"institutional_investor_name\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"required_pay_stub_quantity\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"errors_hash\":{\"data.value_not_valid\":{\"key\":\"data.value_not_valid\",\"path\":[],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"value_not_valid\",\"message\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand
        is not one of [\\\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\\\",
        \\\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\\\", \\\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\\\",
        \\\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\\\", \\\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\\\",
        \\\"FoobaraDemo::LoanOrigination::StartLoanApplication\\\", \\\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\\\",
        \\\"FoobaraDemo::LoanOrigination::FindCreditPolicy\\\", \\\"FoobaraDemo::LoanOrigination::ApproveLoanFile\\\",
        \\\"FoobaraDemo::LoanOrigination::AddCreditScore\\\", \\\"FoobaraDemo::LoanOrigination::FindLoanFile\\\",
        \\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\", \\\"FoobaraDemo::LoanOrigination::AddPayStub\\\",
        \\\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\\\", \\\"Foobara::Agent::DescribeCommand\\\",
        \\\"Foobara::Agent::DescribeType\\\", \\\"Foobara::Agent::GiveUp\\\", \\\"Foobara::Agent::ListCommands\\\",
        \\\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\\\"]\",\"context\":{\"value\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"valid_values\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\",\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]},\"is_fatal\":false}}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file\":1},\"errors_hash\":{\"data.credit_score_used.missing_required_attribute\":{\"key\":\"data.credit_score_used.missing_required_attribute\",\"path\":[\"credit_score_used\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute credit_score_used\",\"context\":{\"attribute_name\":\"credit_score_used\"},\"is_fatal\":true},\"data.denied_reasons.missing_required_attribute\":{\"key\":\"data.denied_reasons.missing_required_attribute\",\"path\":[\"denied_reasons\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute denied_reasons\",\"context\":{\"attribute_name\":\"denied_reasons\"},\"is_fatal\":true}}}}]}}"}],"system":"You
        are implementing an API for a command named Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand
        which has the following description:\n\nAccepts a goal and context of the
        work so far and returns the inputs for the next DenyLoanFile command to run
        to make progress towards accomplishing the goal.  \n\nHere is the inputs JSON
        schema for the data you will receive:\n\n{\"type\":\"object\",\"required\":[\"context\",\"goal\"],\"properties\":{\"goal\":{\"type\":\"string\",\"description\":\"The
        current (possibly already accomplished) goal\"},\"context\":{\"type\":\"object\",\"properties\":{\"command_log\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"command_name\",\"outcome\"],\"properties\":{\"command_name\":{\"type\":\"string\",\"description\":\"Name
        of the command that was run\"},\"inputs\":{\"type\":[\"object\",\"null\"],\"description\":\"Inputs
        to the command\"},\"outcome\":{\"type\":\"object\",\"required\":[\"success\"],\"properties\":{\"success\":{\"type\":\"boolean\",\"description\":\"Whether
        the command succeeded or not\"},\"result\":{\"description\":\"Result of the
        command\"},\"errors_hash\":{\"description\":\"Errors that occurred during
        the command\"}}}}},\"description\":\"Log of all commands run so far and their
        outcomes\"}},\"description\":\"Context of the progress towards the goal so
        far\"}}}\n\nHere is the result JSON schema:\n\n{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}\n\nYou will receive 1 message containing only JSON data according
        to the inputs JSON schema above\nand you will generate a JSON response that
        is a valid response according to the result JSON schema above.\n\nYou will
        reply with nothing more than the JSON you''ve generated so that the calling
        code\ncan successfully parse your answer.\n"}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Thu, 26 Jun 2025 05:27:13 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '37000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-26T05:27:17Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-26T05:27:13Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-26T05:27:10Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '45000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-26T05:27:13Z'
      Request-Id:
      - req_011CQWH89QzyGfzLXDudYbVk
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 955a4b4368f3eb29-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01WHgpFvxZS7YRVF9gcinzph","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"],\"loan_file\":1}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":3528,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":30,"service_tier":"standard"}}'
  recorded_at: Thu, 26 Jun 2025 05:27:13 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"user","content":"{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"context\":{\"command_log\":[{\"command_name\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"},\"outcome\":{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}},{\"command_name\":\"Foobara::Agent::ListCommands\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file_id\":1},\"errors_hash\":{\"data.loan_file.missing_required_attribute\":{\"key\":\"data.loan_file.missing_required_attribute\",\"path\":[\"loan_file\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute loan_file\",\"context\":{\"attribute_name\":\"loan_file\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextStartUnderwriterReviewCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"loan_file\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"id\":1},\"errors_hash\":{\"data.credit_policy.missing_required_attribute\":{\"key\":\"data.credit_policy.missing_required_attribute\",\"path\":[\"credit_policy\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute credit_policy\",\"context\":{\"attribute_name\":\"credit_policy\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextFindCreditPolicyCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"credit_policy\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"institutional_investor_name\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"required_pay_stub_quantity\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"errors_hash\":{\"data.value_not_valid\":{\"key\":\"data.value_not_valid\",\"path\":[],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"value_not_valid\",\"message\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand
        is not one of [\\\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\\\",
        \\\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\\\", \\\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\\\",
        \\\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\\\", \\\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\\\",
        \\\"FoobaraDemo::LoanOrigination::StartLoanApplication\\\", \\\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\\\",
        \\\"FoobaraDemo::LoanOrigination::FindCreditPolicy\\\", \\\"FoobaraDemo::LoanOrigination::ApproveLoanFile\\\",
        \\\"FoobaraDemo::LoanOrigination::AddCreditScore\\\", \\\"FoobaraDemo::LoanOrigination::FindLoanFile\\\",
        \\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\", \\\"FoobaraDemo::LoanOrigination::AddPayStub\\\",
        \\\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\\\", \\\"Foobara::Agent::DescribeCommand\\\",
        \\\"Foobara::Agent::DescribeType\\\", \\\"Foobara::Agent::GiveUp\\\", \\\"Foobara::Agent::ListCommands\\\",
        \\\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\\\"]\",\"context\":{\"value\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"valid_values\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\",\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]},\"is_fatal\":false}}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file\":1},\"errors_hash\":{\"data.credit_score_used.missing_required_attribute\":{\"key\":\"data.credit_score_used.missing_required_attribute\",\"path\":[\"credit_score_used\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute credit_score_used\",\"context\":{\"attribute_name\":\"credit_score_used\"},\"is_fatal\":true},\"data.denied_reasons.missing_required_attribute\":{\"key\":\"data.denied_reasons.missing_required_attribute\",\"path\":[\"denied_reasons\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute denied_reasons\",\"context\":{\"attribute_name\":\"denied_reasons\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"],\"loan_file\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"],\"loan_file\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}}}]}}"}],"system":"You
        are implementing an API for a command named Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nAccepts the current goal, which might
        already be accomplished, and context of the work  so far and returns the inputs
        for the next command to run to make progress towards accomplishing the goal.
        If the goal has already been accomplished then choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.  \n\nHere is the inputs JSON schema for the data you will receive:\n\n{\"type\":\"object\",\"required\":[\"context\",\"goal\"],\"properties\":{\"goal\":{\"type\":\"string\",\"description\":\"The
        current goal to accomplish. If the goal has already been accomplished by the
        previous command runs then choose NotifyUserThatCurrentGoalHasBeenAccomplished
        to stop the loop.\"},\"context\":{\"type\":\"object\",\"properties\":{\"command_log\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"command_name\",\"outcome\"],\"properties\":{\"command_name\":{\"type\":\"string\",\"description\":\"Name
        of the command that was run\"},\"inputs\":{\"type\":[\"object\",\"null\"],\"description\":\"Inputs
        to the command\"},\"outcome\":{\"type\":\"object\",\"required\":[\"success\"],\"properties\":{\"success\":{\"type\":\"boolean\",\"description\":\"Whether
        the command succeeded or not\"},\"result\":{\"description\":\"Result of the
        command\"},\"errors_hash\":{\"description\":\"Errors that occurred during
        the command\"}}}}},\"description\":\"Log of all commands run so far and their
        outcomes\"}},\"description\":\"Context of the progress towards the goal so
        far\"}}}\n\nHere is the result JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command_name\"],\"properties\":{\"command_name\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will receive 1 message containing only JSON data according to the inputs JSON
        schema above\nand you will generate a JSON response that is a valid response
        according to the result JSON schema above.\n\nYou will reply with nothing
        more than the JSON you''ve generated so that the calling code\ncan successfully
        parse your answer.\n"}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Thu, 26 Jun 2025 05:27:17 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '36000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-26T05:27:23Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-26T05:27:17Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-26T05:27:13Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '44000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-26T05:27:17Z'
      Request-Id:
      - req_011CQWH8NfEUQxyV5dbtUA8J
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 955a4b56c99d7ac1-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01TomD4294QFak4o8fKmsg8r","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":3882,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":36,"service_tier":"standard"}}'
  recorded_at: Thu, 26 Jun 2025 05:27:17 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"user","content":"{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"context\":{\"command_log\":[{\"command_name\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"},\"outcome\":{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}},{\"command_name\":\"Foobara::Agent::ListCommands\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file_id\":1},\"errors_hash\":{\"data.loan_file.missing_required_attribute\":{\"key\":\"data.loan_file.missing_required_attribute\",\"path\":[\"loan_file\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute loan_file\",\"context\":{\"attribute_name\":\"loan_file\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextStartUnderwriterReviewCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"loan_file\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"id\":1},\"errors_hash\":{\"data.credit_policy.missing_required_attribute\":{\"key\":\"data.credit_policy.missing_required_attribute\",\"path\":[\"credit_policy\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute credit_policy\",\"context\":{\"attribute_name\":\"credit_policy\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextFindCreditPolicyCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"credit_policy\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"institutional_investor_name\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"required_pay_stub_quantity\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"errors_hash\":{\"data.value_not_valid\":{\"key\":\"data.value_not_valid\",\"path\":[],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"value_not_valid\",\"message\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand
        is not one of [\\\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\\\",
        \\\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\\\", \\\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\\\",
        \\\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\\\", \\\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\\\",
        \\\"FoobaraDemo::LoanOrigination::StartLoanApplication\\\", \\\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\\\",
        \\\"FoobaraDemo::LoanOrigination::FindCreditPolicy\\\", \\\"FoobaraDemo::LoanOrigination::ApproveLoanFile\\\",
        \\\"FoobaraDemo::LoanOrigination::AddCreditScore\\\", \\\"FoobaraDemo::LoanOrigination::FindLoanFile\\\",
        \\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\", \\\"FoobaraDemo::LoanOrigination::AddPayStub\\\",
        \\\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\\\", \\\"Foobara::Agent::DescribeCommand\\\",
        \\\"Foobara::Agent::DescribeType\\\", \\\"Foobara::Agent::GiveUp\\\", \\\"Foobara::Agent::ListCommands\\\",
        \\\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\\\"]\",\"context\":{\"value\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"valid_values\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\",\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]},\"is_fatal\":false}}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file\":1},\"errors_hash\":{\"data.credit_score_used.missing_required_attribute\":{\"key\":\"data.credit_score_used.missing_required_attribute\",\"path\":[\"credit_score_used\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute credit_score_used\",\"context\":{\"attribute_name\":\"credit_score_used\"},\"is_fatal\":true},\"data.denied_reasons.missing_required_attribute\":{\"key\":\"data.denied_reasons.missing_required_attribute\",\"path\":[\"denied_reasons\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute denied_reasons\",\"context\":{\"attribute_name\":\"denied_reasons\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"],\"loan_file\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"],\"loan_file\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}}]}}"}],"system":"You
        are implementing an API for a command named Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nAccepts the current goal, which might
        already be accomplished, and context of the work  so far and returns the inputs
        for the next command to run to make progress towards accomplishing the goal.
        If the goal has already been accomplished then choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.  \n\nHere is the inputs JSON schema for the data you will receive:\n\n{\"type\":\"object\",\"required\":[\"context\",\"goal\"],\"properties\":{\"goal\":{\"type\":\"string\",\"description\":\"The
        current goal to accomplish. If the goal has already been accomplished by the
        previous command runs then choose NotifyUserThatCurrentGoalHasBeenAccomplished
        to stop the loop.\"},\"context\":{\"type\":\"object\",\"properties\":{\"command_log\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"command_name\",\"outcome\"],\"properties\":{\"command_name\":{\"type\":\"string\",\"description\":\"Name
        of the command that was run\"},\"inputs\":{\"type\":[\"object\",\"null\"],\"description\":\"Inputs
        to the command\"},\"outcome\":{\"type\":\"object\",\"required\":[\"success\"],\"properties\":{\"success\":{\"type\":\"boolean\",\"description\":\"Whether
        the command succeeded or not\"},\"result\":{\"description\":\"Result of the
        command\"},\"errors_hash\":{\"description\":\"Errors that occurred during
        the command\"}}}}},\"description\":\"Log of all commands run so far and their
        outcomes\"}},\"description\":\"Context of the progress towards the goal so
        far\"}}}\n\nHere is the result JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command_name\"],\"properties\":{\"command_name\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will receive 1 message containing only JSON data according to the inputs JSON
        schema above\nand you will generate a JSON response that is a valid response
        according to the result JSON schema above.\n\nYou will reply with nothing
        more than the JSON you''ve generated so that the calling code\ncan successfully
        parse your answer.\n"}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Thu, 26 Jun 2025 05:28:17 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '37000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-26T05:28:19Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-26T05:28:17Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-26T05:28:13Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '45000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-26T05:28:17Z'
      Request-Id:
      - req_011CQWHCoGgaSKrZuKfs2w6M
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 955a4ccdeb7ffa22-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_014Vc5fKwN1NhDwJ3i3K2ihT","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":4033,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":36,"service_tier":"standard"}}'
  recorded_at: Thu, 26 Jun 2025 05:28:17 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"user","content":"{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"context\":{\"command_log\":[{\"command_name\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"},\"outcome\":{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}},{\"command_name\":\"Foobara::Agent::ListCommands\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file_id\":1},\"errors_hash\":{\"data.loan_file.missing_required_attribute\":{\"key\":\"data.loan_file.missing_required_attribute\",\"path\":[\"loan_file\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute loan_file\",\"context\":{\"attribute_name\":\"loan_file\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextStartUnderwriterReviewCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"loan_file\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"id\":1},\"errors_hash\":{\"data.credit_policy.missing_required_attribute\":{\"key\":\"data.credit_policy.missing_required_attribute\",\"path\":[\"credit_policy\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute credit_policy\",\"context\":{\"attribute_name\":\"credit_policy\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextFindCreditPolicyCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"credit_policy\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"institutional_investor_name\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"required_pay_stub_quantity\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"errors_hash\":{\"data.value_not_valid\":{\"key\":\"data.value_not_valid\",\"path\":[],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"value_not_valid\",\"message\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand
        is not one of [\\\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\\\",
        \\\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\\\", \\\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\\\",
        \\\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\\\", \\\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\\\",
        \\\"FoobaraDemo::LoanOrigination::StartLoanApplication\\\", \\\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\\\",
        \\\"FoobaraDemo::LoanOrigination::FindCreditPolicy\\\", \\\"FoobaraDemo::LoanOrigination::ApproveLoanFile\\\",
        \\\"FoobaraDemo::LoanOrigination::AddCreditScore\\\", \\\"FoobaraDemo::LoanOrigination::FindLoanFile\\\",
        \\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\", \\\"FoobaraDemo::LoanOrigination::AddPayStub\\\",
        \\\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\\\", \\\"Foobara::Agent::DescribeCommand\\\",
        \\\"Foobara::Agent::DescribeType\\\", \\\"Foobara::Agent::GiveUp\\\", \\\"Foobara::Agent::ListCommands\\\",
        \\\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\\\"]\",\"context\":{\"value\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"valid_values\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\",\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]},\"is_fatal\":false}}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file\":1},\"errors_hash\":{\"data.credit_score_used.missing_required_attribute\":{\"key\":\"data.credit_score_used.missing_required_attribute\",\"path\":[\"credit_score_used\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute credit_score_used\",\"context\":{\"attribute_name\":\"credit_score_used\"},\"is_fatal\":true},\"data.denied_reasons.missing_required_attribute\":{\"key\":\"data.denied_reasons.missing_required_attribute\",\"path\":[\"denied_reasons\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute denied_reasons\",\"context\":{\"attribute_name\":\"denied_reasons\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"],\"loan_file\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"],\"loan_file\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2},\"outcome\":{\"success\":true,\"result\":{\"id\":2,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2}}}]}}"}],"system":"You
        are implementing an API for a command named Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nAccepts the current goal, which might
        already be accomplished, and context of the work  so far and returns the inputs
        for the next command to run to make progress towards accomplishing the goal.
        If the goal has already been accomplished then choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.  \n\nHere is the inputs JSON schema for the data you will receive:\n\n{\"type\":\"object\",\"required\":[\"context\",\"goal\"],\"properties\":{\"goal\":{\"type\":\"string\",\"description\":\"The
        current goal to accomplish. If the goal has already been accomplished by the
        previous command runs then choose NotifyUserThatCurrentGoalHasBeenAccomplished
        to stop the loop.\"},\"context\":{\"type\":\"object\",\"properties\":{\"command_log\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"command_name\",\"outcome\"],\"properties\":{\"command_name\":{\"type\":\"string\",\"description\":\"Name
        of the command that was run\"},\"inputs\":{\"type\":[\"object\",\"null\"],\"description\":\"Inputs
        to the command\"},\"outcome\":{\"type\":\"object\",\"required\":[\"success\"],\"properties\":{\"success\":{\"type\":\"boolean\",\"description\":\"Whether
        the command succeeded or not\"},\"result\":{\"description\":\"Result of the
        command\"},\"errors_hash\":{\"description\":\"Errors that occurred during
        the command\"}}}}},\"description\":\"Log of all commands run so far and their
        outcomes\"}},\"description\":\"Context of the progress towards the goal so
        far\"}}}\n\nHere is the result JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command_name\"],\"properties\":{\"command_name\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will receive 1 message containing only JSON data according to the inputs JSON
        schema above\nand you will generate a JSON response that is a valid response
        according to the result JSON schema above.\n\nYou will reply with nothing
        more than the JSON you''ve generated so that the calling code\ncan successfully
        parse your answer.\n"}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Thu, 26 Jun 2025 05:28:20 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '35000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-26T05:28:26Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-26T05:28:20Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-26T05:28:17Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '43000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-26T05:28:20Z'
      Request-Id:
      - req_011CQWHD4h8GXHzrfg4ELAfe
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 955a4ce44c741694-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_0161t3thSiKXubYv1bk4WtyH","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":4339,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":33,"service_tier":"standard"}}'
  recorded_at: Thu, 26 Jun 2025 05:28:20 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"user","content":"{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"context\":{\"command_log\":[{\"command_name\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"},\"outcome\":{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}},{\"command_name\":\"Foobara::Agent::ListCommands\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file_id\":1},\"errors_hash\":{\"data.loan_file.missing_required_attribute\":{\"key\":\"data.loan_file.missing_required_attribute\",\"path\":[\"loan_file\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute loan_file\",\"context\":{\"attribute_name\":\"loan_file\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextStartUnderwriterReviewCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"loan_file\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"id\":1},\"errors_hash\":{\"data.credit_policy.missing_required_attribute\":{\"key\":\"data.credit_policy.missing_required_attribute\",\"path\":[\"credit_policy\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute credit_policy\",\"context\":{\"attribute_name\":\"credit_policy\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextFindCreditPolicyCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"credit_policy\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"institutional_investor_name\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"required_pay_stub_quantity\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"errors_hash\":{\"data.value_not_valid\":{\"key\":\"data.value_not_valid\",\"path\":[],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"value_not_valid\",\"message\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand
        is not one of [\\\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\\\",
        \\\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\\\", \\\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\\\",
        \\\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\\\", \\\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\\\",
        \\\"FoobaraDemo::LoanOrigination::StartLoanApplication\\\", \\\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\\\",
        \\\"FoobaraDemo::LoanOrigination::FindCreditPolicy\\\", \\\"FoobaraDemo::LoanOrigination::ApproveLoanFile\\\",
        \\\"FoobaraDemo::LoanOrigination::AddCreditScore\\\", \\\"FoobaraDemo::LoanOrigination::FindLoanFile\\\",
        \\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\", \\\"FoobaraDemo::LoanOrigination::AddPayStub\\\",
        \\\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\\\", \\\"Foobara::Agent::DescribeCommand\\\",
        \\\"Foobara::Agent::DescribeType\\\", \\\"Foobara::Agent::GiveUp\\\", \\\"Foobara::Agent::ListCommands\\\",
        \\\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\\\"]\",\"context\":{\"value\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"valid_values\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\",\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]},\"is_fatal\":false}}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file\":1},\"errors_hash\":{\"data.credit_score_used.missing_required_attribute\":{\"key\":\"data.credit_score_used.missing_required_attribute\",\"path\":[\"credit_score_used\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute credit_score_used\",\"context\":{\"attribute_name\":\"credit_score_used\"},\"is_fatal\":true},\"data.denied_reasons.missing_required_attribute\":{\"key\":\"data.denied_reasons.missing_required_attribute\",\"path\":[\"denied_reasons\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute denied_reasons\",\"context\":{\"attribute_name\":\"denied_reasons\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"],\"loan_file\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"],\"loan_file\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2},\"outcome\":{\"success\":true,\"result\":{\"id\":2,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2},\"outcome\":{\"success\":true,\"result\":{\"id\":2,\"institutional_investor_name\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"required_pay_stub_quantity\":2}}}]}}"}],"system":"You
        are implementing an API for a command named Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nAccepts the current goal, which might
        already be accomplished, and context of the work  so far and returns the inputs
        for the next command to run to make progress towards accomplishing the goal.
        If the goal has already been accomplished then choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.  \n\nHere is the inputs JSON schema for the data you will receive:\n\n{\"type\":\"object\",\"required\":[\"context\",\"goal\"],\"properties\":{\"goal\":{\"type\":\"string\",\"description\":\"The
        current goal to accomplish. If the goal has already been accomplished by the
        previous command runs then choose NotifyUserThatCurrentGoalHasBeenAccomplished
        to stop the loop.\"},\"context\":{\"type\":\"object\",\"properties\":{\"command_log\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"command_name\",\"outcome\"],\"properties\":{\"command_name\":{\"type\":\"string\",\"description\":\"Name
        of the command that was run\"},\"inputs\":{\"type\":[\"object\",\"null\"],\"description\":\"Inputs
        to the command\"},\"outcome\":{\"type\":\"object\",\"required\":[\"success\"],\"properties\":{\"success\":{\"type\":\"boolean\",\"description\":\"Whether
        the command succeeded or not\"},\"result\":{\"description\":\"Result of the
        command\"},\"errors_hash\":{\"description\":\"Errors that occurred during
        the command\"}}}}},\"description\":\"Log of all commands run so far and their
        outcomes\"}},\"description\":\"Context of the progress towards the goal so
        far\"}}}\n\nHere is the result JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command_name\"],\"properties\":{\"command_name\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will receive 1 message containing only JSON data according to the inputs JSON
        schema above\nand you will generate a JSON response that is a valid response
        according to the result JSON schema above.\n\nYou will reply with nothing
        more than the JSON you''ve generated so that the calling code\ncan successfully
        parse your answer.\n"}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Thu, 26 Jun 2025 05:28:23 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '33000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-26T05:28:33Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-26T05:28:24Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-26T05:28:20Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '41000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-26T05:28:24Z'
      Request-Id:
      - req_011CQWHDHNNUoRECrw29GpJG
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 955a4cf6ce08fc54-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01DzVrPwSqjADNtWVu5y3Vvx","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs\"]}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":4574,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":55,"service_tier":"standard"}}'
  recorded_at: Thu, 26 Jun 2025 05:28:24 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"user","content":"{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"context\":{\"command_log\":[{\"command_name\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"},\"outcome\":{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}},{\"command_name\":\"Foobara::Agent::ListCommands\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file_id\":1},\"errors_hash\":{\"data.loan_file.missing_required_attribute\":{\"key\":\"data.loan_file.missing_required_attribute\",\"path\":[\"loan_file\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute loan_file\",\"context\":{\"attribute_name\":\"loan_file\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextStartUnderwriterReviewCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"loan_file\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"id\":1},\"errors_hash\":{\"data.credit_policy.missing_required_attribute\":{\"key\":\"data.credit_policy.missing_required_attribute\",\"path\":[\"credit_policy\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute credit_policy\",\"context\":{\"attribute_name\":\"credit_policy\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextFindCreditPolicyCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"credit_policy\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"institutional_investor_name\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"required_pay_stub_quantity\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"errors_hash\":{\"data.value_not_valid\":{\"key\":\"data.value_not_valid\",\"path\":[],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"value_not_valid\",\"message\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand
        is not one of [\\\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\\\",
        \\\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\\\", \\\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\\\",
        \\\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\\\", \\\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\\\",
        \\\"FoobaraDemo::LoanOrigination::StartLoanApplication\\\", \\\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\\\",
        \\\"FoobaraDemo::LoanOrigination::FindCreditPolicy\\\", \\\"FoobaraDemo::LoanOrigination::ApproveLoanFile\\\",
        \\\"FoobaraDemo::LoanOrigination::AddCreditScore\\\", \\\"FoobaraDemo::LoanOrigination::FindLoanFile\\\",
        \\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\", \\\"FoobaraDemo::LoanOrigination::AddPayStub\\\",
        \\\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\\\", \\\"Foobara::Agent::DescribeCommand\\\",
        \\\"Foobara::Agent::DescribeType\\\", \\\"Foobara::Agent::GiveUp\\\", \\\"Foobara::Agent::ListCommands\\\",
        \\\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\\\"]\",\"context\":{\"value\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"valid_values\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\",\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]},\"is_fatal\":false}}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file\":1},\"errors_hash\":{\"data.credit_score_used.missing_required_attribute\":{\"key\":\"data.credit_score_used.missing_required_attribute\",\"path\":[\"credit_score_used\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute credit_score_used\",\"context\":{\"attribute_name\":\"credit_score_used\"},\"is_fatal\":true},\"data.denied_reasons.missing_required_attribute\":{\"key\":\"data.denied_reasons.missing_required_attribute\",\"path\":[\"denied_reasons\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute denied_reasons\",\"context\":{\"attribute_name\":\"denied_reasons\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"],\"loan_file\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"],\"loan_file\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2},\"outcome\":{\"success\":true,\"result\":{\"id\":2,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2},\"outcome\":{\"success\":true,\"result\":{\"id\":2,\"institutional_investor_name\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"required_pay_stub_quantity\":2}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs\"]},\"errors_hash\":{\"data.denied_reasons.0.value_not_valid\":{\"key\":\"data.denied_reasons.0.value_not_valid\",\"path\":[\"denied_reasons\",0],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"value_not_valid\",\"message\":\"insufficient_pay_stubs
        is not one of [\\\"insufficient_pay_stubs_provided\\\", \\\"low_credit_score\\\"]\",\"context\":{\"value\":\"insufficient_pay_stubs\",\"valid_values\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]},\"is_fatal\":false}}}}]}}"}],"system":"You
        are implementing an API for a command named Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand
        which has the following description:\n\nAccepts a goal and context of the
        work so far and returns the inputs for the next DenyLoanFile command to run
        to make progress towards accomplishing the goal.  \n\nHere is the inputs JSON
        schema for the data you will receive:\n\n{\"type\":\"object\",\"required\":[\"context\",\"goal\"],\"properties\":{\"goal\":{\"type\":\"string\",\"description\":\"The
        current (possibly already accomplished) goal\"},\"context\":{\"type\":\"object\",\"properties\":{\"command_log\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"command_name\",\"outcome\"],\"properties\":{\"command_name\":{\"type\":\"string\",\"description\":\"Name
        of the command that was run\"},\"inputs\":{\"type\":[\"object\",\"null\"],\"description\":\"Inputs
        to the command\"},\"outcome\":{\"type\":\"object\",\"required\":[\"success\"],\"properties\":{\"success\":{\"type\":\"boolean\",\"description\":\"Whether
        the command succeeded or not\"},\"result\":{\"description\":\"Result of the
        command\"},\"errors_hash\":{\"description\":\"Errors that occurred during
        the command\"}}}}},\"description\":\"Log of all commands run so far and their
        outcomes\"}},\"description\":\"Context of the progress towards the goal so
        far\"}}}\n\nHere is the result JSON schema:\n\n{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}\n\nYou will receive 1 message containing only JSON data according
        to the inputs JSON schema above\nand you will generate a JSON response that
        is a valid response according to the result JSON schema above.\n\nYou will
        reply with nothing more than the JSON you''ve generated so that the calling
        code\ncan successfully parse your answer.\n"}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Thu, 26 Jun 2025 05:28:28 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '32000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-26T05:28:40Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-26T05:28:28Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-26T05:28:24Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '40000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-26T05:28:28Z'
      Request-Id:
      - req_011CQWHDa8BnTny4gt88k8Yn
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 955a4d0f7947ebeb-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01QdU4KYmZtg4AD5hJ1mAJdx","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"```json\n{\n  \"credit_score_used\":
        750,\n  \"denied_reasons\": [\"insufficient_pay_stubs_provided\"],\n  \"loan_file\":
        2\n}\n```"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":4868,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":49,"service_tier":"standard"}}'
  recorded_at: Thu, 26 Jun 2025 05:28:28 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"user","content":"{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"context\":{\"command_log\":[{\"command_name\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"},\"outcome\":{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}},{\"command_name\":\"Foobara::Agent::ListCommands\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file_id\":1},\"errors_hash\":{\"data.loan_file.missing_required_attribute\":{\"key\":\"data.loan_file.missing_required_attribute\",\"path\":[\"loan_file\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute loan_file\",\"context\":{\"attribute_name\":\"loan_file\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextStartUnderwriterReviewCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"loan_file\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"id\":1},\"errors_hash\":{\"data.credit_policy.missing_required_attribute\":{\"key\":\"data.credit_policy.missing_required_attribute\",\"path\":[\"credit_policy\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute credit_policy\",\"context\":{\"attribute_name\":\"credit_policy\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextFindCreditPolicyCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"credit_policy\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"institutional_investor_name\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"required_pay_stub_quantity\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"errors_hash\":{\"data.value_not_valid\":{\"key\":\"data.value_not_valid\",\"path\":[],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"value_not_valid\",\"message\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand
        is not one of [\\\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\\\",
        \\\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\\\", \\\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\\\",
        \\\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\\\", \\\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\\\",
        \\\"FoobaraDemo::LoanOrigination::StartLoanApplication\\\", \\\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\\\",
        \\\"FoobaraDemo::LoanOrigination::FindCreditPolicy\\\", \\\"FoobaraDemo::LoanOrigination::ApproveLoanFile\\\",
        \\\"FoobaraDemo::LoanOrigination::AddCreditScore\\\", \\\"FoobaraDemo::LoanOrigination::FindLoanFile\\\",
        \\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\", \\\"FoobaraDemo::LoanOrigination::AddPayStub\\\",
        \\\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\\\", \\\"Foobara::Agent::DescribeCommand\\\",
        \\\"Foobara::Agent::DescribeType\\\", \\\"Foobara::Agent::GiveUp\\\", \\\"Foobara::Agent::ListCommands\\\",
        \\\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\\\"]\",\"context\":{\"value\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"valid_values\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\",\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]},\"is_fatal\":false}}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file\":1},\"errors_hash\":{\"data.credit_score_used.missing_required_attribute\":{\"key\":\"data.credit_score_used.missing_required_attribute\",\"path\":[\"credit_score_used\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute credit_score_used\",\"context\":{\"attribute_name\":\"credit_score_used\"},\"is_fatal\":true},\"data.denied_reasons.missing_required_attribute\":{\"key\":\"data.denied_reasons.missing_required_attribute\",\"path\":[\"denied_reasons\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute denied_reasons\",\"context\":{\"attribute_name\":\"denied_reasons\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"],\"loan_file\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"],\"loan_file\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2},\"outcome\":{\"success\":true,\"result\":{\"id\":2,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2},\"outcome\":{\"success\":true,\"result\":{\"id\":2,\"institutional_investor_name\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"required_pay_stub_quantity\":2}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs\"]},\"errors_hash\":{\"data.denied_reasons.0.value_not_valid\":{\"key\":\"data.denied_reasons.0.value_not_valid\",\"path\":[\"denied_reasons\",0],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"value_not_valid\",\"message\":\"insufficient_pay_stubs
        is not one of [\\\"insufficient_pay_stubs_provided\\\", \\\"low_credit_score\\\"]\",\"context\":{\"value\":\"insufficient_pay_stubs\",\"valid_values\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]},\"is_fatal\":false}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"],\"loan_file\":2}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"],\"loan_file\":2},\"outcome\":{\"success\":true,\"result\":{\"id\":2,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}}}]}}"}],"system":"You
        are implementing an API for a command named Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nAccepts the current goal, which might
        already be accomplished, and context of the work  so far and returns the inputs
        for the next command to run to make progress towards accomplishing the goal.
        If the goal has already been accomplished then choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.  \n\nHere is the inputs JSON schema for the data you will receive:\n\n{\"type\":\"object\",\"required\":[\"context\",\"goal\"],\"properties\":{\"goal\":{\"type\":\"string\",\"description\":\"The
        current goal to accomplish. If the goal has already been accomplished by the
        previous command runs then choose NotifyUserThatCurrentGoalHasBeenAccomplished
        to stop the loop.\"},\"context\":{\"type\":\"object\",\"properties\":{\"command_log\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"command_name\",\"outcome\"],\"properties\":{\"command_name\":{\"type\":\"string\",\"description\":\"Name
        of the command that was run\"},\"inputs\":{\"type\":[\"object\",\"null\"],\"description\":\"Inputs
        to the command\"},\"outcome\":{\"type\":\"object\",\"required\":[\"success\"],\"properties\":{\"success\":{\"type\":\"boolean\",\"description\":\"Whether
        the command succeeded or not\"},\"result\":{\"description\":\"Result of the
        command\"},\"errors_hash\":{\"description\":\"Errors that occurred during
        the command\"}}}}},\"description\":\"Log of all commands run so far and their
        outcomes\"}},\"description\":\"Context of the progress towards the goal so
        far\"}}}\n\nHere is the result JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command_name\"],\"properties\":{\"command_name\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will receive 1 message containing only JSON data according to the inputs JSON
        schema above\nand you will generate a JSON response that is a valid response
        according to the result JSON schema above.\n\nYou will reply with nothing
        more than the JSON you''ve generated so that the calling code\ncan successfully
        parse your answer.\n"}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Thu, 26 Jun 2025 05:29:28 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '37000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-26T05:29:32Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-26T05:29:28Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-26T05:29:24Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '45000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-26T05:29:28Z'
      Request-Id:
      - req_011CQWHHzs5rgs3udcq2r4yP
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 955a4e869bd715ba-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01RgQbwH6QeQfhT4uVHVRhk2","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":5233,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":36,"service_tier":"standard"}}'
  recorded_at: Thu, 26 Jun 2025 05:29:28 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"user","content":"{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"context\":{\"command_log\":[{\"command_name\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"},\"outcome\":{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}},{\"command_name\":\"Foobara::Agent::ListCommands\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file_id\":1},\"errors_hash\":{\"data.loan_file.missing_required_attribute\":{\"key\":\"data.loan_file.missing_required_attribute\",\"path\":[\"loan_file\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute loan_file\",\"context\":{\"attribute_name\":\"loan_file\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextStartUnderwriterReviewCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"loan_file\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"id\":1},\"errors_hash\":{\"data.credit_policy.missing_required_attribute\":{\"key\":\"data.credit_policy.missing_required_attribute\",\"path\":[\"credit_policy\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute credit_policy\",\"context\":{\"attribute_name\":\"credit_policy\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextFindCreditPolicyCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"credit_policy\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"institutional_investor_name\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"required_pay_stub_quantity\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"errors_hash\":{\"data.value_not_valid\":{\"key\":\"data.value_not_valid\",\"path\":[],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"value_not_valid\",\"message\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand
        is not one of [\\\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\\\",
        \\\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\\\", \\\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\\\",
        \\\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\\\", \\\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\\\",
        \\\"FoobaraDemo::LoanOrigination::StartLoanApplication\\\", \\\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\\\",
        \\\"FoobaraDemo::LoanOrigination::FindCreditPolicy\\\", \\\"FoobaraDemo::LoanOrigination::ApproveLoanFile\\\",
        \\\"FoobaraDemo::LoanOrigination::AddCreditScore\\\", \\\"FoobaraDemo::LoanOrigination::FindLoanFile\\\",
        \\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\", \\\"FoobaraDemo::LoanOrigination::AddPayStub\\\",
        \\\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\\\", \\\"Foobara::Agent::DescribeCommand\\\",
        \\\"Foobara::Agent::DescribeType\\\", \\\"Foobara::Agent::GiveUp\\\", \\\"Foobara::Agent::ListCommands\\\",
        \\\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\\\"]\",\"context\":{\"value\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"valid_values\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\",\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]},\"is_fatal\":false}}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file\":1},\"errors_hash\":{\"data.credit_score_used.missing_required_attribute\":{\"key\":\"data.credit_score_used.missing_required_attribute\",\"path\":[\"credit_score_used\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute credit_score_used\",\"context\":{\"attribute_name\":\"credit_score_used\"},\"is_fatal\":true},\"data.denied_reasons.missing_required_attribute\":{\"key\":\"data.denied_reasons.missing_required_attribute\",\"path\":[\"denied_reasons\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute denied_reasons\",\"context\":{\"attribute_name\":\"denied_reasons\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"],\"loan_file\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"],\"loan_file\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2},\"outcome\":{\"success\":true,\"result\":{\"id\":2,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2},\"outcome\":{\"success\":true,\"result\":{\"id\":2,\"institutional_investor_name\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"required_pay_stub_quantity\":2}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs\"]},\"errors_hash\":{\"data.denied_reasons.0.value_not_valid\":{\"key\":\"data.denied_reasons.0.value_not_valid\",\"path\":[\"denied_reasons\",0],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"value_not_valid\",\"message\":\"insufficient_pay_stubs
        is not one of [\\\"insufficient_pay_stubs_provided\\\", \\\"low_credit_score\\\"]\",\"context\":{\"value\":\"insufficient_pay_stubs\",\"valid_values\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]},\"is_fatal\":false}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"],\"loan_file\":2}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"],\"loan_file\":2},\"outcome\":{\"success\":true,\"result\":{\"id\":2,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"id\":3}}}]}}"}],"system":"You
        are implementing an API for a command named Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nAccepts the current goal, which might
        already be accomplished, and context of the work  so far and returns the inputs
        for the next command to run to make progress towards accomplishing the goal.
        If the goal has already been accomplished then choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.  \n\nHere is the inputs JSON schema for the data you will receive:\n\n{\"type\":\"object\",\"required\":[\"context\",\"goal\"],\"properties\":{\"goal\":{\"type\":\"string\",\"description\":\"The
        current goal to accomplish. If the goal has already been accomplished by the
        previous command runs then choose NotifyUserThatCurrentGoalHasBeenAccomplished
        to stop the loop.\"},\"context\":{\"type\":\"object\",\"properties\":{\"command_log\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"command_name\",\"outcome\"],\"properties\":{\"command_name\":{\"type\":\"string\",\"description\":\"Name
        of the command that was run\"},\"inputs\":{\"type\":[\"object\",\"null\"],\"description\":\"Inputs
        to the command\"},\"outcome\":{\"type\":\"object\",\"required\":[\"success\"],\"properties\":{\"success\":{\"type\":\"boolean\",\"description\":\"Whether
        the command succeeded or not\"},\"result\":{\"description\":\"Result of the
        command\"},\"errors_hash\":{\"description\":\"Errors that occurred during
        the command\"}}}}},\"description\":\"Log of all commands run so far and their
        outcomes\"}},\"description\":\"Context of the progress towards the goal so
        far\"}}}\n\nHere is the result JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command_name\"],\"properties\":{\"command_name\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will receive 1 message containing only JSON data according to the inputs JSON
        schema above\nand you will generate a JSON response that is a valid response
        according to the result JSON schema above.\n\nYou will reply with nothing
        more than the JSON you''ve generated so that the calling code\ncan successfully
        parse your answer.\n"}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Thu, 26 Jun 2025 05:29:32 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '34000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-26T05:29:40Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-26T05:29:32Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-26T05:29:28Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '42000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-26T05:29:32Z'
      Request-Id:
      - req_011CQWHJL5UgGLY29SbbmNMp
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 955a4ea2debe67f5-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01R2cTfzEoxSPcXA6NFNUwRL","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":3}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":5384,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":36,"service_tier":"standard"}}'
  recorded_at: Thu, 26 Jun 2025 05:29:32 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"user","content":"{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"context\":{\"command_log\":[{\"command_name\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"},\"outcome\":{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}},{\"command_name\":\"Foobara::Agent::ListCommands\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file_id\":1},\"errors_hash\":{\"data.loan_file.missing_required_attribute\":{\"key\":\"data.loan_file.missing_required_attribute\",\"path\":[\"loan_file\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute loan_file\",\"context\":{\"attribute_name\":\"loan_file\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextStartUnderwriterReviewCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"loan_file\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"id\":1},\"errors_hash\":{\"data.credit_policy.missing_required_attribute\":{\"key\":\"data.credit_policy.missing_required_attribute\",\"path\":[\"credit_policy\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute credit_policy\",\"context\":{\"attribute_name\":\"credit_policy\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextFindCreditPolicyCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"credit_policy\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"institutional_investor_name\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"required_pay_stub_quantity\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"errors_hash\":{\"data.value_not_valid\":{\"key\":\"data.value_not_valid\",\"path\":[],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"value_not_valid\",\"message\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand
        is not one of [\\\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\\\",
        \\\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\\\", \\\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\\\",
        \\\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\\\", \\\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\\\",
        \\\"FoobaraDemo::LoanOrigination::StartLoanApplication\\\", \\\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\\\",
        \\\"FoobaraDemo::LoanOrigination::FindCreditPolicy\\\", \\\"FoobaraDemo::LoanOrigination::ApproveLoanFile\\\",
        \\\"FoobaraDemo::LoanOrigination::AddCreditScore\\\", \\\"FoobaraDemo::LoanOrigination::FindLoanFile\\\",
        \\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\", \\\"FoobaraDemo::LoanOrigination::AddPayStub\\\",
        \\\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\\\", \\\"Foobara::Agent::DescribeCommand\\\",
        \\\"Foobara::Agent::DescribeType\\\", \\\"Foobara::Agent::GiveUp\\\", \\\"Foobara::Agent::ListCommands\\\",
        \\\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\\\"]\",\"context\":{\"value\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"valid_values\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\",\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]},\"is_fatal\":false}}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file\":1},\"errors_hash\":{\"data.credit_score_used.missing_required_attribute\":{\"key\":\"data.credit_score_used.missing_required_attribute\",\"path\":[\"credit_score_used\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute credit_score_used\",\"context\":{\"attribute_name\":\"credit_score_used\"},\"is_fatal\":true},\"data.denied_reasons.missing_required_attribute\":{\"key\":\"data.denied_reasons.missing_required_attribute\",\"path\":[\"denied_reasons\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute denied_reasons\",\"context\":{\"attribute_name\":\"denied_reasons\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"],\"loan_file\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"],\"loan_file\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2},\"outcome\":{\"success\":true,\"result\":{\"id\":2,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2},\"outcome\":{\"success\":true,\"result\":{\"id\":2,\"institutional_investor_name\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"required_pay_stub_quantity\":2}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs\"]},\"errors_hash\":{\"data.denied_reasons.0.value_not_valid\":{\"key\":\"data.denied_reasons.0.value_not_valid\",\"path\":[\"denied_reasons\",0],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"value_not_valid\",\"message\":\"insufficient_pay_stubs
        is not one of [\\\"insufficient_pay_stubs_provided\\\", \\\"low_credit_score\\\"]\",\"context\":{\"value\":\"insufficient_pay_stubs\",\"valid_values\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]},\"is_fatal\":false}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"],\"loan_file\":2}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"],\"loan_file\":2},\"outcome\":{\"success\":true,\"result\":{\"id\":2,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"id\":3}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":3}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":3},\"outcome\":{\"success\":true,\"result\":{\"id\":3,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3}}}]}}"}],"system":"You
        are implementing an API for a command named Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nAccepts the current goal, which might
        already be accomplished, and context of the work  so far and returns the inputs
        for the next command to run to make progress towards accomplishing the goal.
        If the goal has already been accomplished then choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.  \n\nHere is the inputs JSON schema for the data you will receive:\n\n{\"type\":\"object\",\"required\":[\"context\",\"goal\"],\"properties\":{\"goal\":{\"type\":\"string\",\"description\":\"The
        current goal to accomplish. If the goal has already been accomplished by the
        previous command runs then choose NotifyUserThatCurrentGoalHasBeenAccomplished
        to stop the loop.\"},\"context\":{\"type\":\"object\",\"properties\":{\"command_log\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"command_name\",\"outcome\"],\"properties\":{\"command_name\":{\"type\":\"string\",\"description\":\"Name
        of the command that was run\"},\"inputs\":{\"type\":[\"object\",\"null\"],\"description\":\"Inputs
        to the command\"},\"outcome\":{\"type\":\"object\",\"required\":[\"success\"],\"properties\":{\"success\":{\"type\":\"boolean\",\"description\":\"Whether
        the command succeeded or not\"},\"result\":{\"description\":\"Result of the
        command\"},\"errors_hash\":{\"description\":\"Errors that occurred during
        the command\"}}}}},\"description\":\"Log of all commands run so far and their
        outcomes\"}},\"description\":\"Context of the progress towards the goal so
        far\"}}}\n\nHere is the result JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command_name\"],\"properties\":{\"command_name\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will receive 1 message containing only JSON data according to the inputs JSON
        schema above\nand you will generate a JSON response that is a valid response
        according to the result JSON schema above.\n\nYou will reply with nothing
        more than the JSON you''ve generated so that the calling code\ncan successfully
        parse your answer.\n"}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Thu, 26 Jun 2025 05:29:36 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '31000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-26T05:29:48Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-26T05:29:36Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-26T05:29:32Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '39000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-26T05:29:36Z'
      Request-Id:
      - req_011CQWHJd8u224hzMNyxkU4U
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 955a4ebbc8c03023-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_011LA7QoMv5LCySqpsJtidHa","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":3}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":5690,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":33,"service_tier":"standard"}}'
  recorded_at: Thu, 26 Jun 2025 05:29:36 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"user","content":"{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"context\":{\"command_log\":[{\"command_name\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"},\"outcome\":{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}},{\"command_name\":\"Foobara::Agent::ListCommands\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file_id\":1},\"errors_hash\":{\"data.loan_file.missing_required_attribute\":{\"key\":\"data.loan_file.missing_required_attribute\",\"path\":[\"loan_file\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute loan_file\",\"context\":{\"attribute_name\":\"loan_file\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextStartUnderwriterReviewCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"loan_file\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"id\":1},\"errors_hash\":{\"data.credit_policy.missing_required_attribute\":{\"key\":\"data.credit_policy.missing_required_attribute\",\"path\":[\"credit_policy\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute credit_policy\",\"context\":{\"attribute_name\":\"credit_policy\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextFindCreditPolicyCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"credit_policy\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"institutional_investor_name\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"required_pay_stub_quantity\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"errors_hash\":{\"data.value_not_valid\":{\"key\":\"data.value_not_valid\",\"path\":[],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"value_not_valid\",\"message\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand
        is not one of [\\\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\\\",
        \\\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\\\", \\\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\\\",
        \\\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\\\", \\\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\\\",
        \\\"FoobaraDemo::LoanOrigination::StartLoanApplication\\\", \\\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\\\",
        \\\"FoobaraDemo::LoanOrigination::FindCreditPolicy\\\", \\\"FoobaraDemo::LoanOrigination::ApproveLoanFile\\\",
        \\\"FoobaraDemo::LoanOrigination::AddCreditScore\\\", \\\"FoobaraDemo::LoanOrigination::FindLoanFile\\\",
        \\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\", \\\"FoobaraDemo::LoanOrigination::AddPayStub\\\",
        \\\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\\\", \\\"Foobara::Agent::DescribeCommand\\\",
        \\\"Foobara::Agent::DescribeType\\\", \\\"Foobara::Agent::GiveUp\\\", \\\"Foobara::Agent::ListCommands\\\",
        \\\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\\\"]\",\"context\":{\"value\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"valid_values\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\",\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]},\"is_fatal\":false}}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file\":1},\"errors_hash\":{\"data.credit_score_used.missing_required_attribute\":{\"key\":\"data.credit_score_used.missing_required_attribute\",\"path\":[\"credit_score_used\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute credit_score_used\",\"context\":{\"attribute_name\":\"credit_score_used\"},\"is_fatal\":true},\"data.denied_reasons.missing_required_attribute\":{\"key\":\"data.denied_reasons.missing_required_attribute\",\"path\":[\"denied_reasons\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute denied_reasons\",\"context\":{\"attribute_name\":\"denied_reasons\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"],\"loan_file\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"],\"loan_file\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2},\"outcome\":{\"success\":true,\"result\":{\"id\":2,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2},\"outcome\":{\"success\":true,\"result\":{\"id\":2,\"institutional_investor_name\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"required_pay_stub_quantity\":2}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs\"]},\"errors_hash\":{\"data.denied_reasons.0.value_not_valid\":{\"key\":\"data.denied_reasons.0.value_not_valid\",\"path\":[\"denied_reasons\",0],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"value_not_valid\",\"message\":\"insufficient_pay_stubs
        is not one of [\\\"insufficient_pay_stubs_provided\\\", \\\"low_credit_score\\\"]\",\"context\":{\"value\":\"insufficient_pay_stubs\",\"valid_values\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]},\"is_fatal\":false}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"],\"loan_file\":2}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"],\"loan_file\":2},\"outcome\":{\"success\":true,\"result\":{\"id\":2,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"id\":3}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":3}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":3},\"outcome\":{\"success\":true,\"result\":{\"id\":3,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":3}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":3},\"outcome\":{\"success\":true,\"result\":{\"id\":3,\"institutional_investor_name\":\"Bank
        C\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"required_pay_stub_quantity\":1}}}]}}"}],"system":"You
        are implementing an API for a command named Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nAccepts the current goal, which might
        already be accomplished, and context of the work  so far and returns the inputs
        for the next command to run to make progress towards accomplishing the goal.
        If the goal has already been accomplished then choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.  \n\nHere is the inputs JSON schema for the data you will receive:\n\n{\"type\":\"object\",\"required\":[\"context\",\"goal\"],\"properties\":{\"goal\":{\"type\":\"string\",\"description\":\"The
        current goal to accomplish. If the goal has already been accomplished by the
        previous command runs then choose NotifyUserThatCurrentGoalHasBeenAccomplished
        to stop the loop.\"},\"context\":{\"type\":\"object\",\"properties\":{\"command_log\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"command_name\",\"outcome\"],\"properties\":{\"command_name\":{\"type\":\"string\",\"description\":\"Name
        of the command that was run\"},\"inputs\":{\"type\":[\"object\",\"null\"],\"description\":\"Inputs
        to the command\"},\"outcome\":{\"type\":\"object\",\"required\":[\"success\"],\"properties\":{\"success\":{\"type\":\"boolean\",\"description\":\"Whether
        the command succeeded or not\"},\"result\":{\"description\":\"Result of the
        command\"},\"errors_hash\":{\"description\":\"Errors that occurred during
        the command\"}}}}},\"description\":\"Log of all commands run so far and their
        outcomes\"}},\"description\":\"Context of the progress towards the goal so
        far\"}}}\n\nHere is the result JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command_name\"],\"properties\":{\"command_name\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will receive 1 message containing only JSON data according to the inputs JSON
        schema above\nand you will generate a JSON response that is a valid response
        according to the result JSON schema above.\n\nYou will reply with nothing
        more than the JSON you''ve generated so that the calling code\ncan successfully
        parse your answer.\n"}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Thu, 26 Jun 2025 05:29:42 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '29000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-26T05:29:57Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-26T05:29:42Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-26T05:29:36Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '37000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-26T05:29:42Z'
      Request-Id:
      - req_011CQWHJvD4snBvVea6xLXyU
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 955a4ed4bfb21686-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_018ozkE2CEXVSk5epWGBmaPp","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"inputs\":{\"loan_file\":3,\"credit_score_used\":750}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":5925,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":42,"service_tier":"standard"}}'
  recorded_at: Thu, 26 Jun 2025 05:29:42 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"user","content":"{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"context\":{\"command_log\":[{\"command_name\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"},\"outcome\":{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}},{\"command_name\":\"Foobara::Agent::ListCommands\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file_id\":1},\"errors_hash\":{\"data.loan_file.missing_required_attribute\":{\"key\":\"data.loan_file.missing_required_attribute\",\"path\":[\"loan_file\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute loan_file\",\"context\":{\"attribute_name\":\"loan_file\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextStartUnderwriterReviewCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"loan_file\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"id\":1},\"errors_hash\":{\"data.credit_policy.missing_required_attribute\":{\"key\":\"data.credit_policy.missing_required_attribute\",\"path\":[\"credit_policy\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute credit_policy\",\"context\":{\"attribute_name\":\"credit_policy\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextFindCreditPolicyCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"credit_policy\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"institutional_investor_name\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"required_pay_stub_quantity\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"errors_hash\":{\"data.value_not_valid\":{\"key\":\"data.value_not_valid\",\"path\":[],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"value_not_valid\",\"message\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand
        is not one of [\\\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\\\",
        \\\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\\\", \\\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\\\",
        \\\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\\\", \\\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\\\",
        \\\"FoobaraDemo::LoanOrigination::StartLoanApplication\\\", \\\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\\\",
        \\\"FoobaraDemo::LoanOrigination::FindCreditPolicy\\\", \\\"FoobaraDemo::LoanOrigination::ApproveLoanFile\\\",
        \\\"FoobaraDemo::LoanOrigination::AddCreditScore\\\", \\\"FoobaraDemo::LoanOrigination::FindLoanFile\\\",
        \\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\", \\\"FoobaraDemo::LoanOrigination::AddPayStub\\\",
        \\\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\\\", \\\"Foobara::Agent::DescribeCommand\\\",
        \\\"Foobara::Agent::DescribeType\\\", \\\"Foobara::Agent::GiveUp\\\", \\\"Foobara::Agent::ListCommands\\\",
        \\\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\\\"]\",\"context\":{\"value\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"valid_values\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\",\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]},\"is_fatal\":false}}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file\":1},\"errors_hash\":{\"data.credit_score_used.missing_required_attribute\":{\"key\":\"data.credit_score_used.missing_required_attribute\",\"path\":[\"credit_score_used\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute credit_score_used\",\"context\":{\"attribute_name\":\"credit_score_used\"},\"is_fatal\":true},\"data.denied_reasons.missing_required_attribute\":{\"key\":\"data.denied_reasons.missing_required_attribute\",\"path\":[\"denied_reasons\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute denied_reasons\",\"context\":{\"attribute_name\":\"denied_reasons\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"],\"loan_file\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"],\"loan_file\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2},\"outcome\":{\"success\":true,\"result\":{\"id\":2,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2},\"outcome\":{\"success\":true,\"result\":{\"id\":2,\"institutional_investor_name\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"required_pay_stub_quantity\":2}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs\"]},\"errors_hash\":{\"data.denied_reasons.0.value_not_valid\":{\"key\":\"data.denied_reasons.0.value_not_valid\",\"path\":[\"denied_reasons\",0],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"value_not_valid\",\"message\":\"insufficient_pay_stubs
        is not one of [\\\"insufficient_pay_stubs_provided\\\", \\\"low_credit_score\\\"]\",\"context\":{\"value\":\"insufficient_pay_stubs\",\"valid_values\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]},\"is_fatal\":false}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"],\"loan_file\":2}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"],\"loan_file\":2},\"outcome\":{\"success\":true,\"result\":{\"id\":2,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"id\":3}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":3}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":3},\"outcome\":{\"success\":true,\"result\":{\"id\":3,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":3}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":3},\"outcome\":{\"success\":true,\"result\":{\"id\":3,\"institutional_investor_name\":\"Bank
        C\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"required_pay_stub_quantity\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"inputs\":{\"loan_file\":3,\"credit_score_used\":750}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"inputs\":{\"loan_file\":3,\"credit_score_used\":750},\"outcome\":{\"success\":true,\"result\":{\"id\":3,\"state\":\"drafting_docs\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"underwriter_decision\":{\"decision\":\"approved\",\"credit_score_used\":750}}}}]}}"}],"system":"You
        are implementing an API for a command named Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nAccepts the current goal, which might
        already be accomplished, and context of the work  so far and returns the inputs
        for the next command to run to make progress towards accomplishing the goal.
        If the goal has already been accomplished then choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.  \n\nHere is the inputs JSON schema for the data you will receive:\n\n{\"type\":\"object\",\"required\":[\"context\",\"goal\"],\"properties\":{\"goal\":{\"type\":\"string\",\"description\":\"The
        current goal to accomplish. If the goal has already been accomplished by the
        previous command runs then choose NotifyUserThatCurrentGoalHasBeenAccomplished
        to stop the loop.\"},\"context\":{\"type\":\"object\",\"properties\":{\"command_log\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"command_name\",\"outcome\"],\"properties\":{\"command_name\":{\"type\":\"string\",\"description\":\"Name
        of the command that was run\"},\"inputs\":{\"type\":[\"object\",\"null\"],\"description\":\"Inputs
        to the command\"},\"outcome\":{\"type\":\"object\",\"required\":[\"success\"],\"properties\":{\"success\":{\"type\":\"boolean\",\"description\":\"Whether
        the command succeeded or not\"},\"result\":{\"description\":\"Result of the
        command\"},\"errors_hash\":{\"description\":\"Errors that occurred during
        the command\"}}}}},\"description\":\"Log of all commands run so far and their
        outcomes\"}},\"description\":\"Context of the progress towards the goal so
        far\"}}}\n\nHere is the result JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command_name\"],\"properties\":{\"command_name\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will receive 1 message containing only JSON data according to the inputs JSON
        schema above\nand you will generate a JSON response that is a valid response
        according to the result JSON schema above.\n\nYou will reply with nothing
        more than the JSON you''ve generated so that the calling code\ncan successfully
        parse your answer.\n"}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Thu, 26 Jun 2025 05:30:39 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '35000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-26T05:30:46Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-26T05:30:39Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-26T05:30:36Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '43000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-26T05:30:39Z'
      Request-Id:
      - req_011CQWHPLqm7JZoPzA8zTZVq
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 955a504bebface7c-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01MXdPWhuyk47XihhrJuWZuh","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":6262,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":36,"service_tier":"standard"}}'
  recorded_at: Thu, 26 Jun 2025 05:30:39 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"user","content":"{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"context\":{\"command_log\":[{\"command_name\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"},\"outcome\":{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}},{\"command_name\":\"Foobara::Agent::ListCommands\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file_id\":1},\"errors_hash\":{\"data.loan_file.missing_required_attribute\":{\"key\":\"data.loan_file.missing_required_attribute\",\"path\":[\"loan_file\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute loan_file\",\"context\":{\"attribute_name\":\"loan_file\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextStartUnderwriterReviewCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"loan_file\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"id\":1},\"errors_hash\":{\"data.credit_policy.missing_required_attribute\":{\"key\":\"data.credit_policy.missing_required_attribute\",\"path\":[\"credit_policy\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute credit_policy\",\"context\":{\"attribute_name\":\"credit_policy\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextFindCreditPolicyCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"credit_policy\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"institutional_investor_name\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"required_pay_stub_quantity\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"errors_hash\":{\"data.value_not_valid\":{\"key\":\"data.value_not_valid\",\"path\":[],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"value_not_valid\",\"message\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand
        is not one of [\\\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\\\",
        \\\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\\\", \\\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\\\",
        \\\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\\\", \\\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\\\",
        \\\"FoobaraDemo::LoanOrigination::StartLoanApplication\\\", \\\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\\\",
        \\\"FoobaraDemo::LoanOrigination::FindCreditPolicy\\\", \\\"FoobaraDemo::LoanOrigination::ApproveLoanFile\\\",
        \\\"FoobaraDemo::LoanOrigination::AddCreditScore\\\", \\\"FoobaraDemo::LoanOrigination::FindLoanFile\\\",
        \\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\", \\\"FoobaraDemo::LoanOrigination::AddPayStub\\\",
        \\\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\\\", \\\"Foobara::Agent::DescribeCommand\\\",
        \\\"Foobara::Agent::DescribeType\\\", \\\"Foobara::Agent::GiveUp\\\", \\\"Foobara::Agent::ListCommands\\\",
        \\\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\\\"]\",\"context\":{\"value\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"valid_values\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\",\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]},\"is_fatal\":false}}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file\":1},\"errors_hash\":{\"data.credit_score_used.missing_required_attribute\":{\"key\":\"data.credit_score_used.missing_required_attribute\",\"path\":[\"credit_score_used\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute credit_score_used\",\"context\":{\"attribute_name\":\"credit_score_used\"},\"is_fatal\":true},\"data.denied_reasons.missing_required_attribute\":{\"key\":\"data.denied_reasons.missing_required_attribute\",\"path\":[\"denied_reasons\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute denied_reasons\",\"context\":{\"attribute_name\":\"denied_reasons\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"],\"loan_file\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"],\"loan_file\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2},\"outcome\":{\"success\":true,\"result\":{\"id\":2,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2},\"outcome\":{\"success\":true,\"result\":{\"id\":2,\"institutional_investor_name\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"required_pay_stub_quantity\":2}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs\"]},\"errors_hash\":{\"data.denied_reasons.0.value_not_valid\":{\"key\":\"data.denied_reasons.0.value_not_valid\",\"path\":[\"denied_reasons\",0],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"value_not_valid\",\"message\":\"insufficient_pay_stubs
        is not one of [\\\"insufficient_pay_stubs_provided\\\", \\\"low_credit_score\\\"]\",\"context\":{\"value\":\"insufficient_pay_stubs\",\"valid_values\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]},\"is_fatal\":false}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"],\"loan_file\":2}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"],\"loan_file\":2},\"outcome\":{\"success\":true,\"result\":{\"id\":2,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"id\":3}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":3}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":3},\"outcome\":{\"success\":true,\"result\":{\"id\":3,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":3}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":3},\"outcome\":{\"success\":true,\"result\":{\"id\":3,\"institutional_investor_name\":\"Bank
        C\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"required_pay_stub_quantity\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"inputs\":{\"loan_file\":3,\"credit_score_used\":750}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"inputs\":{\"loan_file\":3,\"credit_score_used\":750},\"outcome\":{\"success\":true,\"result\":{\"id\":3,\"state\":\"drafting_docs\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"underwriter_decision\":{\"decision\":\"approved\",\"credit_score_used\":750}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":null}}]}}"}],"system":"You
        are implementing an API for a command named Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nAccepts the current goal, which might
        already be accomplished, and context of the work  so far and returns the inputs
        for the next command to run to make progress towards accomplishing the goal.
        If the goal has already been accomplished then choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.  \n\nHere is the inputs JSON schema for the data you will receive:\n\n{\"type\":\"object\",\"required\":[\"context\",\"goal\"],\"properties\":{\"goal\":{\"type\":\"string\",\"description\":\"The
        current goal to accomplish. If the goal has already been accomplished by the
        previous command runs then choose NotifyUserThatCurrentGoalHasBeenAccomplished
        to stop the loop.\"},\"context\":{\"type\":\"object\",\"properties\":{\"command_log\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"command_name\",\"outcome\"],\"properties\":{\"command_name\":{\"type\":\"string\",\"description\":\"Name
        of the command that was run\"},\"inputs\":{\"type\":[\"object\",\"null\"],\"description\":\"Inputs
        to the command\"},\"outcome\":{\"type\":\"object\",\"required\":[\"success\"],\"properties\":{\"success\":{\"type\":\"boolean\",\"description\":\"Whether
        the command succeeded or not\"},\"result\":{\"description\":\"Result of the
        command\"},\"errors_hash\":{\"description\":\"Errors that occurred during
        the command\"}}}}},\"description\":\"Log of all commands run so far and their
        outcomes\"}},\"description\":\"Context of the progress towards the goal so
        far\"}}}\n\nHere is the result JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command_name\"],\"properties\":{\"command_name\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will receive 1 message containing only JSON data according to the inputs JSON
        schema above\nand you will generate a JSON response that is a valid response
        according to the result JSON schema above.\n\nYou will reply with nothing
        more than the JSON you''ve generated so that the calling code\ncan successfully
        parse your answer.\n"}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Thu, 26 Jun 2025 05:30:42 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '30000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-26T05:30:55Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-26T05:30:42Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-26T05:30:39Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '38000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-26T05:30:42Z'
      Request-Id:
      - req_011CQWHPY6gDm3dYcsTFbDqq
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 955a505c4ba6689a-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01KU6ScycmietQjSKqGbm4CD","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\",\"inputs\":{}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":6307,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":48,"service_tier":"standard"}}'
  recorded_at: Thu, 26 Jun 2025 05:30:42 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"user","content":"{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"context\":{\"command_log\":[{\"command_name\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"},\"outcome\":{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}},{\"command_name\":\"Foobara::Agent::ListCommands\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file_id\":1},\"errors_hash\":{\"data.loan_file.missing_required_attribute\":{\"key\":\"data.loan_file.missing_required_attribute\",\"path\":[\"loan_file\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute loan_file\",\"context\":{\"attribute_name\":\"loan_file\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextStartUnderwriterReviewCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"loan_file\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"id\":1},\"errors_hash\":{\"data.credit_policy.missing_required_attribute\":{\"key\":\"data.credit_policy.missing_required_attribute\",\"path\":[\"credit_policy\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute credit_policy\",\"context\":{\"attribute_name\":\"credit_policy\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextFindCreditPolicyCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"credit_policy\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"institutional_investor_name\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"required_pay_stub_quantity\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"errors_hash\":{\"data.value_not_valid\":{\"key\":\"data.value_not_valid\",\"path\":[],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"value_not_valid\",\"message\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand
        is not one of [\\\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\\\",
        \\\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\\\", \\\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\\\",
        \\\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\\\", \\\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\\\",
        \\\"FoobaraDemo::LoanOrigination::StartLoanApplication\\\", \\\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\\\",
        \\\"FoobaraDemo::LoanOrigination::FindCreditPolicy\\\", \\\"FoobaraDemo::LoanOrigination::ApproveLoanFile\\\",
        \\\"FoobaraDemo::LoanOrigination::AddCreditScore\\\", \\\"FoobaraDemo::LoanOrigination::FindLoanFile\\\",
        \\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\", \\\"FoobaraDemo::LoanOrigination::AddPayStub\\\",
        \\\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\\\", \\\"Foobara::Agent::DescribeCommand\\\",
        \\\"Foobara::Agent::DescribeType\\\", \\\"Foobara::Agent::GiveUp\\\", \\\"Foobara::Agent::ListCommands\\\",
        \\\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\\\"]\",\"context\":{\"value\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"valid_values\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\",\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]},\"is_fatal\":false}}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file\":1},\"errors_hash\":{\"data.credit_score_used.missing_required_attribute\":{\"key\":\"data.credit_score_used.missing_required_attribute\",\"path\":[\"credit_score_used\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute credit_score_used\",\"context\":{\"attribute_name\":\"credit_score_used\"},\"is_fatal\":true},\"data.denied_reasons.missing_required_attribute\":{\"key\":\"data.denied_reasons.missing_required_attribute\",\"path\":[\"denied_reasons\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute denied_reasons\",\"context\":{\"attribute_name\":\"denied_reasons\"},\"is_fatal\":true}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"],\"loan_file\":1}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"],\"loan_file\":1},\"outcome\":{\"success\":true,\"result\":{\"id\":1,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2},\"outcome\":{\"success\":true,\"result\":{\"id\":2,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2},\"outcome\":{\"success\":true,\"result\":{\"id\":2,\"institutional_investor_name\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"required_pay_stub_quantity\":2}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs\"]},\"errors_hash\":{\"data.denied_reasons.0.value_not_valid\":{\"key\":\"data.denied_reasons.0.value_not_valid\",\"path\":[\"denied_reasons\",0],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"value_not_valid\",\"message\":\"insufficient_pay_stubs
        is not one of [\\\"insufficient_pay_stubs_provided\\\", \\\"low_credit_score\\\"]\",\"context\":{\"value\":\"insufficient_pay_stubs\",\"valid_values\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]},\"is_fatal\":false}}}},{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextDenyLoanFileCommand\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"],\"loan_file\":2}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"],\"loan_file\":2},\"outcome\":{\"success\":true,\"result\":{\"id\":2,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"id\":3}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":3}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":3},\"outcome\":{\"success\":true,\"result\":{\"id\":3,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":3}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":3},\"outcome\":{\"success\":true,\"result\":{\"id\":3,\"institutional_investor_name\":\"Bank
        C\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"required_pay_stub_quantity\":1}}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":true,\"result\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"inputs\":{\"loan_file\":3,\"credit_score_used\":750}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"inputs\":{\"loan_file\":3,\"credit_score_used\":750},\"outcome\":{\"success\":true,\"result\":{\"id\":3,\"state\":\"drafting_docs\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"underwriter_decision\":{\"decision\":\"approved\",\"credit_score_used\":750}}}},{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"inputs\":{},\"outcome\":{\"success\":true,\"result\":null}},{\"command_name\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"goal\":\"You
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: For each loan file needing review, it will approve or deny the loan file
        based on its credit policy rules.. Accomplish this goal.\",\"llm_model\":\"claude-opus-4-20250514\"},\"outcome\":{\"success\":false,\"result\":{},\"errors_hash\":{\"data.result.missing_required_attribute\":{\"key\":\"data.result.missing_required_attribute\",\"path\":[\"result\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"missing_required_attribute\",\"message\":\"Missing
        required attribute result\",\"context\":{\"attribute_name\":\"result\"},\"is_fatal\":true}}}}]}}"}],"system":"You
        are implementing an API for a command named Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::DetermineInputsForNextNotifyUserThatCurrentGoalHasBeenAccomplishedCommand
        which has the following description:\n\nAccepts a goal and context of the
        work so far and returns the inputs for the next NotifyUserThatCurrentGoalHasBeenAccomplished
        command to run to make progress towards accomplishing the goal.  \n\nHere
        is the inputs JSON schema for the data you will receive:\n\n{\"type\":\"object\",\"required\":[\"context\",\"goal\"],\"properties\":{\"goal\":{\"type\":\"string\",\"description\":\"The
        current (possibly already accomplished) goal\"},\"context\":{\"type\":\"object\",\"properties\":{\"command_log\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"command_name\",\"outcome\"],\"properties\":{\"command_name\":{\"type\":\"string\",\"description\":\"Name
        of the command that was run\"},\"inputs\":{\"type\":[\"object\",\"null\"],\"description\":\"Inputs
        to the command\"},\"outcome\":{\"type\":\"object\",\"required\":[\"success\"],\"properties\":{\"success\":{\"type\":\"boolean\",\"description\":\"Whether
        the command succeeded or not\"},\"result\":{\"description\":\"Result of the
        command\"},\"errors_hash\":{\"description\":\"Errors that occurred during
        the command\"}}}}},\"description\":\"Log of all commands run so far and their
        outcomes\"}},\"description\":\"Context of the progress towards the goal so
        far\"}}}\n\nHere is the result JSON schema:\n\n{\"type\":\"object\",\"required\":[\"result\"],\"properties\":{\"result\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"applicant_name\",\"underwriter_decision\"],\"properties\":{\"applicant_name\":{\"type\":\"string\"},\"underwriter_decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]}}}}}}\n\nYou
        will receive 1 message containing only JSON data according to the inputs JSON
        schema above\nand you will generate a JSON response that is a valid response
        according to the result JSON schema above.\n\nYou will reply with nothing
        more than the JSON you''ve generated so that the calling code\ncan successfully
        parse your answer.\n"}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Thu, 26 Jun 2025 05:30:47 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '27000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-26T05:31:05Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-26T05:30:47Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-26T05:30:43Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '35000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-26T05:30:47Z'
      Request-Id:
      - req_011CQWHPpaNdtho38DvChxwu
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 955a50745c23fa49-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_013ZqXEWmo8t9rbbxiS62q49","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"result\":[{\"applicant_name\":\"Barbara\",\"underwriter_decision\":\"denied\"},{\"applicant_name\":\"Basil\",\"underwriter_decision\":\"denied\"},{\"applicant_name\":\"Fumiko\",\"underwriter_decision\":\"approved\"}]}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":6519,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":57,"service_tier":"standard"}}'
  recorded_at: Thu, 26 Jun 2025 05:30:47 GMT
recorded_with: VCR 6.3.1
