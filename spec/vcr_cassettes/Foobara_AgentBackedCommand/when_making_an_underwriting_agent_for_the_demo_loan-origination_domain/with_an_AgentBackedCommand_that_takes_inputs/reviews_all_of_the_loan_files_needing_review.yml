---
http_interactions:
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review.\n\nYour response should match the
        following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:00:17 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:00:16Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:00:17Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:00:15Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '48000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:00:16Z'
      Request-Id:
      - req_011CQrSNADdfx7Tux24csrex
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b207d27c56fa01-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_016axR5DnSaWDrUeb3odYbsN","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":580,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":50,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:00:17 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review.\n\nYour response should match the
        following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:00:20 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:00:19Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:00:20Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:00:17Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '48000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:00:19Z'
      Request-Id:
      - req_011CQrSNLp7sQEZvMHtd2Z6z
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b207e1f91cdf9a-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01RZDUT11L8deQnjFnQhEyFT","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":1070,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":30,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:00:20 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review.\n\nYour response should match the
        following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:00:23 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:00:22Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:00:23Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:00:20Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '48000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:00:22Z'
      Request-Id:
      - req_011CQrSNZqwwaDKcszCJLRT5
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b207f4fb212523-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_012rEmPuNMnUiSDgG3PCfTEp","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":1215,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":42,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:00:23 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"description\":\"Checks
        the LoanFile against all requirements in its CreditPolicy. Denies the LoanFile
        that has any unsatisfied requirements.\",\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"agent_options\":{\"type\":\"object\",\"properties\":{\"verbose\":{\"type\":\"boolean\"},\"io_out\":{},\"io_err\":{},\"context\":{\"type\":[\"object\",\"null\"],\"required\":[\"current_goal\"],\"properties\":{\"current_goal\":{\"type\":\"string\",\"description\":\"The
        current goal the agent needs to accomplish\"},\"previous_goals\":{\"type\":\"array\",\"items\":{\"type\":\"string\"}},\"command_log\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"command_name\",\"outcome\"],\"properties\":{\"command_name\":{\"type\":\"string\",\"description\":\"Name
        of the command that was run\"},\"inputs\":{\"type\":[\"object\",\"null\"],\"description\":\"Inputs
        to the command\"},\"outcome\":{\"type\":\"object\",\"required\":[\"success\"],\"properties\":{\"success\":{\"type\":\"boolean\",\"description\":\"Whether
        the command succeeded or not\"},\"result\":{\"description\":\"Result of the
        command\"},\"errors_hash\":{\"description\":\"Errors that occurred during
        the command\"}}}}},\"description\":\"Log of all commands run so far and their
        outcomes\"}},\"description\":\"The current context of the agent\"},\"agent_name\":{\"type\":[\"string\",\"null\"]},\"llm_model\":{\"type\":[\"string\",\"null\"],\"enum\":[\"babbage-002\",\"chatgpt-4o-latest\",\"claude-2.0\",\"claude-2.1\",\"claude-3-5-haiku-20241022\",\"claude-3-5-sonnet-20240620\",\"claude-3-5-sonnet-20241022\",\"claude-3-7-sonnet-20250219\",\"claude-3-haiku-20240307\",\"claude-3-opus-20240229\",\"claude-3-sonnet-20240229\",\"claude-opus-4-20250514\",\"claude-sonnet-4-20250514\",\"codex-mini-latest\",\"dall-e-2\",\"dall-e-3\",\"davinci-002\",\"gpt-3.5-turbo\",\"gpt-3.5-turbo-0125\",\"gpt-3.5-turbo-1106\",\"gpt-3.5-turbo-16k\",\"gpt-3.5-turbo-instruct\",\"gpt-3.5-turbo-instruct-0914\",\"gpt-4\",\"gpt-4-0125-preview\",\"gpt-4-0613\",\"gpt-4-1106-preview\",\"gpt-4-turbo\",\"gpt-4-turbo-2024-04-09\",\"gpt-4-turbo-preview\",\"gpt-4.1\",\"gpt-4.1-2025-04-14\",\"gpt-4.1-mini\",\"gpt-4.1-mini-2025-04-14\",\"gpt-4.1-nano\",\"gpt-4.1-nano-2025-04-14\",\"gpt-4.5-preview\",\"gpt-4.5-preview-2025-02-27\",\"gpt-4o\",\"gpt-4o-2024-05-13\",\"gpt-4o-2024-08-06\",\"gpt-4o-2024-11-20\",\"gpt-4o-audio-preview\",\"gpt-4o-audio-preview-2024-10-01\",\"gpt-4o-audio-preview-2024-12-17\",\"gpt-4o-audio-preview-2025-06-03\",\"gpt-4o-mini\",\"gpt-4o-mini-2024-07-18\",\"gpt-4o-mini-audio-preview\",\"gpt-4o-mini-audio-preview-2024-12-17\",\"gpt-4o-mini-realtime-preview\",\"gpt-4o-mini-realtime-preview-2024-12-17\",\"gpt-4o-mini-search-preview\",\"gpt-4o-mini-search-preview-2025-03-11\",\"gpt-4o-mini-transcribe\",\"gpt-4o-mini-tts\",\"gpt-4o-realtime-preview\",\"gpt-4o-realtime-preview-2024-10-01\",\"gpt-4o-realtime-preview-2024-12-17\",\"gpt-4o-realtime-preview-2025-06-03\",\"gpt-4o-search-preview\",\"gpt-4o-search-preview-2025-03-11\",\"gpt-4o-transcribe\",\"gpt-image-1\",\"o1\",\"o1-2024-12-17\",\"o1-mini\",\"o1-mini-2024-09-12\",\"o1-preview\",\"o1-preview-2024-09-12\",\"o1-pro\",\"o1-pro-2025-03-19\",\"o3-mini\",\"o3-mini-2025-01-31\",\"o4-mini\",\"o4-mini-2025-04-16\",\"omni-moderation-2024-09-26\",\"omni-moderation-latest\",\"text-embedding-3-large\",\"text-embedding-3-small\",\"text-embedding-ada-002\",\"tts-1\",\"tts-1-1106\",\"tts-1-hd\",\"tts-1-hd-1106\",\"whisper-1\"],\"description\":\"The
        model to use for the LLM\"},\"max_llm_calls_per_minute\":{\"type\":[\"number\",\"null\"]}}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}}}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review.\n\nYour response should match the
        following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:00:26 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '38000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:00:27Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:00:26Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:00:23Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '46000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:00:26Z'
      Request-Id:
      - req_011CQrSNnaASjuw94z8WoKHm
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b2080799b0235c-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01FESf9sgXhKeukgk6XaKp8r","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"inputs\":{\"loan_file\":1}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2695,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":31,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:00:26 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewLoanFile. Your goal is: Review loan
        file. The command description is: Checks the LoanFile against all requirements
        in its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements..
        The inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}\n\nYou
        have been ran with the following inputs:\n\n{\"loan_file\":{\"id\":1,\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}\n\nYour
        response should match the following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:00:29 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '39000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:00:29Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:00:29Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:00:27Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '47000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:00:29Z'
      Request-Id:
      - req_011CQrSP2XZMDqwSNAkqkpcP
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b2081c0a2acf2f-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_018LwhMBFsm3ceQxK8MAtFPp","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":1147,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":42,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:00:29 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"}],"temperature":0.0,"system":"You are the implementation
        of a command called Foobara::Agent::DetermineNextCommandNameAndInputs which
        has the following description:\n\nReturns the name of the next command to
        run and its inputs given the progress  towards accomplishing the current goal.
        If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewLoanFile. Your goal is: Review loan
        file. The command description is: Checks the LoanFile against all requirements
        in its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements..
        The inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}\n\nYou
        have been ran with the following inputs:\n\n{\"loan_file\":{\"id\":1,\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}\n\nYour
        response should match the following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:00:32 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:00:32Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:00:32Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:00:29Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '48000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:00:32Z'
      Request-Id:
      - req_011CQrSPE5LYiF53faCDQd1e
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b2082baad8173a-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_019GgRvA3xAfqsv7J2vdMXQ4","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":1433,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":31,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:00:32 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewLoanFile. Your goal is: Review loan
        file. The command description is: Checks the LoanFile against all requirements
        in its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements..
        The inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}\n\nYou
        have been ran with the following inputs:\n\n{\"loan_file\":{\"id\":1,\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}\n\nYour
        response should match the following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:00:36 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:00:35Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:00:36Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:00:33Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '48000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:00:35Z'
      Request-Id:
      - req_011CQrSPVW2b3jqD7QEWDyrB
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b208435a977abb-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01VcgHaKjpUn6rx5HEE6TaRY","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":1512,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":45,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:00:36 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewLoanFile. Your goal is: Review loan
        file. The command description is: Checks the LoanFile against all requirements
        in its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements..
        The inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}\n\nYou
        have been ran with the following inputs:\n\n{\"loan_file\":{\"id\":1,\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}\n\nYour
        response should match the following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:00:39 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '39000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:00:39Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:00:39Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:00:36Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '47000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:00:39Z'
      Request-Id:
      - req_011CQrSPj7as4NxA4KC278Et
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b208572aab15ba-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01Jsb9pTdT65A29aS2Efwk8A","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2008,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":34,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:00:39 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewLoanFile. Your goal is: Review loan
        file. The command description is: Checks the LoanFile against all requirements
        in its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements..
        The inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}\n\nYou
        have been ran with the following inputs:\n\n{\"loan_file\":{\"id\":1,\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}\n\nYour
        response should match the following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:00:41 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '39000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:00:42Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:00:41Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:00:39Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '47000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:00:41Z'
      Request-Id:
      - req_011CQrSPxYUPh3wFQxCxkHeJ
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b2086af81006ad-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01SQcGimgLZBPrQgVee2HDPB","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2157,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":43,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:00:41 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewLoanFile. Your goal is: Review loan
        file. The command description is: Checks the LoanFile against all requirements
        in its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements..
        The inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}\n\nYou
        have been ran with the following inputs:\n\n{\"loan_file\":{\"id\":1,\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}\n\nYour
        response should match the following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:00:46 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '39000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:00:47Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:00:46Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:00:42Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '47000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:00:46Z'
      Request-Id:
      - req_011CQrSQ9cyggEJdbV7LYTrx
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b2087b1f98679d-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01P4tWC7Xq7GPxRxgGZQSPG6","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2707,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":52,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:00:46 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewLoanFile. Your goal is: Review loan
        file. The command description is: Checks the LoanFile against all requirements
        in its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements..
        The inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}\n\nYou
        have been ran with the following inputs:\n\n{\"loan_file\":{\"id\":1,\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}\n\nYour
        response should match the following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:00:49 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '38000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:00:51Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:00:49Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:00:46Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '46000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:00:49Z'
      Request-Id:
      - req_011CQrSQUv5qSB4t1SfA6ALA
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b208975ca6eb1e-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01GhjckLdRksHtaEmJvG3nfk","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2932,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":35,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:00:49 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\",\"description\":\"Notifies
        the user that the current goal has been accomplished and returns a final result
        formatted according to the result schema. The user might issue a new goal.\",\"inputs_type\":{\"type\":\"object\",\"required\":[\"result\"],\"properties\":{\"result\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}}}}}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewLoanFile. Your goal is: Review loan
        file. The command description is: Checks the LoanFile against all requirements
        in its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements..
        The inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}\n\nYou
        have been ran with the following inputs:\n\n{\"loan_file\":{\"id\":1,\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}\n\nYour
        response should match the following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:00:52 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '37000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:00:56Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:00:53Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:00:50Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '45000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:00:53Z'
      Request-Id:
      - req_011CQrSQjA6KTV3ewkE23XVw
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b208ac2b8617f4-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01MfKnx46S3xbQPC2FzdQDo5","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\",\"inputs\":{\"result\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":3174,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":66,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:00:53 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"description\":\"Checks
        the LoanFile against all requirements in its CreditPolicy. Denies the LoanFile
        that has any unsatisfied requirements.\",\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"agent_options\":{\"type\":\"object\",\"properties\":{\"verbose\":{\"type\":\"boolean\"},\"io_out\":{},\"io_err\":{},\"context\":{\"type\":[\"object\",\"null\"],\"required\":[\"current_goal\"],\"properties\":{\"current_goal\":{\"type\":\"string\",\"description\":\"The
        current goal the agent needs to accomplish\"},\"previous_goals\":{\"type\":\"array\",\"items\":{\"type\":\"string\"}},\"command_log\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"command_name\",\"outcome\"],\"properties\":{\"command_name\":{\"type\":\"string\",\"description\":\"Name
        of the command that was run\"},\"inputs\":{\"type\":[\"object\",\"null\"],\"description\":\"Inputs
        to the command\"},\"outcome\":{\"type\":\"object\",\"required\":[\"success\"],\"properties\":{\"success\":{\"type\":\"boolean\",\"description\":\"Whether
        the command succeeded or not\"},\"result\":{\"description\":\"Result of the
        command\"},\"errors_hash\":{\"description\":\"Errors that occurred during
        the command\"}}}}},\"description\":\"Log of all commands run so far and their
        outcomes\"}},\"description\":\"The current context of the agent\"},\"agent_name\":{\"type\":[\"string\",\"null\"]},\"llm_model\":{\"type\":[\"string\",\"null\"],\"enum\":[\"babbage-002\",\"chatgpt-4o-latest\",\"claude-2.0\",\"claude-2.1\",\"claude-3-5-haiku-20241022\",\"claude-3-5-sonnet-20240620\",\"claude-3-5-sonnet-20241022\",\"claude-3-7-sonnet-20250219\",\"claude-3-haiku-20240307\",\"claude-3-opus-20240229\",\"claude-3-sonnet-20240229\",\"claude-opus-4-20250514\",\"claude-sonnet-4-20250514\",\"codex-mini-latest\",\"dall-e-2\",\"dall-e-3\",\"davinci-002\",\"gpt-3.5-turbo\",\"gpt-3.5-turbo-0125\",\"gpt-3.5-turbo-1106\",\"gpt-3.5-turbo-16k\",\"gpt-3.5-turbo-instruct\",\"gpt-3.5-turbo-instruct-0914\",\"gpt-4\",\"gpt-4-0125-preview\",\"gpt-4-0613\",\"gpt-4-1106-preview\",\"gpt-4-turbo\",\"gpt-4-turbo-2024-04-09\",\"gpt-4-turbo-preview\",\"gpt-4.1\",\"gpt-4.1-2025-04-14\",\"gpt-4.1-mini\",\"gpt-4.1-mini-2025-04-14\",\"gpt-4.1-nano\",\"gpt-4.1-nano-2025-04-14\",\"gpt-4.5-preview\",\"gpt-4.5-preview-2025-02-27\",\"gpt-4o\",\"gpt-4o-2024-05-13\",\"gpt-4o-2024-08-06\",\"gpt-4o-2024-11-20\",\"gpt-4o-audio-preview\",\"gpt-4o-audio-preview-2024-10-01\",\"gpt-4o-audio-preview-2024-12-17\",\"gpt-4o-audio-preview-2025-06-03\",\"gpt-4o-mini\",\"gpt-4o-mini-2024-07-18\",\"gpt-4o-mini-audio-preview\",\"gpt-4o-mini-audio-preview-2024-12-17\",\"gpt-4o-mini-realtime-preview\",\"gpt-4o-mini-realtime-preview-2024-12-17\",\"gpt-4o-mini-search-preview\",\"gpt-4o-mini-search-preview-2025-03-11\",\"gpt-4o-mini-transcribe\",\"gpt-4o-mini-tts\",\"gpt-4o-realtime-preview\",\"gpt-4o-realtime-preview-2024-10-01\",\"gpt-4o-realtime-preview-2024-12-17\",\"gpt-4o-realtime-preview-2025-06-03\",\"gpt-4o-search-preview\",\"gpt-4o-search-preview-2025-03-11\",\"gpt-4o-transcribe\",\"gpt-image-1\",\"o1\",\"o1-2024-12-17\",\"o1-mini\",\"o1-mini-2024-09-12\",\"o1-preview\",\"o1-preview-2024-09-12\",\"o1-pro\",\"o1-pro-2025-03-19\",\"o3-mini\",\"o3-mini-2025-01-31\",\"o4-mini\",\"o4-mini-2025-04-16\",\"omni-moderation-2024-09-26\",\"omni-moderation-latest\",\"text-embedding-3-large\",\"text-embedding-3-small\",\"text-embedding-ada-002\",\"tts-1\",\"tts-1-1106\",\"tts-1-hd\",\"tts-1-hd-1106\",\"whisper-1\"],\"description\":\"The
        model to use for the LLM\"},\"max_llm_calls_per_minute\":{\"type\":[\"number\",\"null\"]}}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review.\n\nYour response should match the
        following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:00:56 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '37000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:01:00Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:00:56Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:00:53Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '45000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:00:56Z'
      Request-Id:
      - req_011CQrSQymvHt2cCq7r5YfvV
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b208c198279e5c-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01LexQ6JgUhfZYvUbppytfWy","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2761,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":30,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:00:56 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"description\":\"Checks
        the LoanFile against all requirements in its CreditPolicy. Denies the LoanFile
        that has any unsatisfied requirements.\",\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"agent_options\":{\"type\":\"object\",\"properties\":{\"verbose\":{\"type\":\"boolean\"},\"io_out\":{},\"io_err\":{},\"context\":{\"type\":[\"object\",\"null\"],\"required\":[\"current_goal\"],\"properties\":{\"current_goal\":{\"type\":\"string\",\"description\":\"The
        current goal the agent needs to accomplish\"},\"previous_goals\":{\"type\":\"array\",\"items\":{\"type\":\"string\"}},\"command_log\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"command_name\",\"outcome\"],\"properties\":{\"command_name\":{\"type\":\"string\",\"description\":\"Name
        of the command that was run\"},\"inputs\":{\"type\":[\"object\",\"null\"],\"description\":\"Inputs
        to the command\"},\"outcome\":{\"type\":\"object\",\"required\":[\"success\"],\"properties\":{\"success\":{\"type\":\"boolean\",\"description\":\"Whether
        the command succeeded or not\"},\"result\":{\"description\":\"Result of the
        command\"},\"errors_hash\":{\"description\":\"Errors that occurred during
        the command\"}}}}},\"description\":\"Log of all commands run so far and their
        outcomes\"}},\"description\":\"The current context of the agent\"},\"agent_name\":{\"type\":[\"string\",\"null\"]},\"llm_model\":{\"type\":[\"string\",\"null\"],\"enum\":[\"babbage-002\",\"chatgpt-4o-latest\",\"claude-2.0\",\"claude-2.1\",\"claude-3-5-haiku-20241022\",\"claude-3-5-sonnet-20240620\",\"claude-3-5-sonnet-20241022\",\"claude-3-7-sonnet-20250219\",\"claude-3-haiku-20240307\",\"claude-3-opus-20240229\",\"claude-3-sonnet-20240229\",\"claude-opus-4-20250514\",\"claude-sonnet-4-20250514\",\"codex-mini-latest\",\"dall-e-2\",\"dall-e-3\",\"davinci-002\",\"gpt-3.5-turbo\",\"gpt-3.5-turbo-0125\",\"gpt-3.5-turbo-1106\",\"gpt-3.5-turbo-16k\",\"gpt-3.5-turbo-instruct\",\"gpt-3.5-turbo-instruct-0914\",\"gpt-4\",\"gpt-4-0125-preview\",\"gpt-4-0613\",\"gpt-4-1106-preview\",\"gpt-4-turbo\",\"gpt-4-turbo-2024-04-09\",\"gpt-4-turbo-preview\",\"gpt-4.1\",\"gpt-4.1-2025-04-14\",\"gpt-4.1-mini\",\"gpt-4.1-mini-2025-04-14\",\"gpt-4.1-nano\",\"gpt-4.1-nano-2025-04-14\",\"gpt-4.5-preview\",\"gpt-4.5-preview-2025-02-27\",\"gpt-4o\",\"gpt-4o-2024-05-13\",\"gpt-4o-2024-08-06\",\"gpt-4o-2024-11-20\",\"gpt-4o-audio-preview\",\"gpt-4o-audio-preview-2024-10-01\",\"gpt-4o-audio-preview-2024-12-17\",\"gpt-4o-audio-preview-2025-06-03\",\"gpt-4o-mini\",\"gpt-4o-mini-2024-07-18\",\"gpt-4o-mini-audio-preview\",\"gpt-4o-mini-audio-preview-2024-12-17\",\"gpt-4o-mini-realtime-preview\",\"gpt-4o-mini-realtime-preview-2024-12-17\",\"gpt-4o-mini-search-preview\",\"gpt-4o-mini-search-preview-2025-03-11\",\"gpt-4o-mini-transcribe\",\"gpt-4o-mini-tts\",\"gpt-4o-realtime-preview\",\"gpt-4o-realtime-preview-2024-10-01\",\"gpt-4o-realtime-preview-2024-12-17\",\"gpt-4o-realtime-preview-2025-06-03\",\"gpt-4o-search-preview\",\"gpt-4o-search-preview-2025-03-11\",\"gpt-4o-transcribe\",\"gpt-image-1\",\"o1\",\"o1-2024-12-17\",\"o1-mini\",\"o1-mini-2024-09-12\",\"o1-preview\",\"o1-preview-2024-09-12\",\"o1-pro\",\"o1-pro-2025-03-19\",\"o3-mini\",\"o3-mini-2025-01-31\",\"o4-mini\",\"o4-mini-2025-04-16\",\"omni-moderation-2024-09-26\",\"omni-moderation-latest\",\"text-embedding-3-large\",\"text-embedding-3-small\",\"text-embedding-ada-002\",\"tts-1\",\"tts-1-1106\",\"tts-1-hd\",\"tts-1-hd-1106\",\"whisper-1\"],\"description\":\"The
        model to use for the LLM\"},\"max_llm_calls_per_minute\":{\"type\":[\"number\",\"null\"]}}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review.\n\nYour response should match the
        following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:00:59 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '36000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:01:04Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:00:59Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:00:57Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '44000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:00:59Z'
      Request-Id:
      - req_011CQrSRGXyf3eUa7ikDyPuk
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b208d9fb00169c-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01Lz94rxV31wirCS6PVXZFGi","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"inputs\":{\"loan_file\":2}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2908,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":31,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:00:59 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewLoanFile. Your goal is: Review loan
        file. The command description is: Checks the LoanFile against all requirements
        in its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements..
        The inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}\n\nYou
        have been ran with the following inputs:\n\n{\"loan_file\":{\"id\":2,\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2}}\n\nYour
        response should match the following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:01:02 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '37000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:01:06Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:01:02Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:00:59Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '45000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:01:02Z'
      Request-Id:
      - req_011CQrSRSAfe2LJMYwt2KsAh
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b208e82f684705-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01EtJLe1WgB3xXiPB3EZLoCm","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":1149,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":42,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:01:02 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"}],"temperature":0.0,"system":"You are the implementation
        of a command called Foobara::Agent::DetermineNextCommandNameAndInputs which
        has the following description:\n\nReturns the name of the next command to
        run and its inputs given the progress  towards accomplishing the current goal.
        If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewLoanFile. Your goal is: Review loan
        file. The command description is: Checks the LoanFile against all requirements
        in its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements..
        The inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}\n\nYou
        have been ran with the following inputs:\n\n{\"loan_file\":{\"id\":2,\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2}}\n\nYour
        response should match the following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:01:04 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '37000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:01:08Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:01:04Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:01:02Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '45000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:01:04Z'
      Request-Id:
      - req_011CQrSRgBXTRzfsp4szzZWN
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b208fca85467f9-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_016ogfm1VFfD8rVCznuQWFaa","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":1435,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":31,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:01:04 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"institution\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":2}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewLoanFile. Your goal is: Review loan
        file. The command description is: Checks the LoanFile against all requirements
        in its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements..
        The inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}\n\nYou
        have been ran with the following inputs:\n\n{\"loan_file\":{\"id\":2,\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2}}\n\nYour
        response should match the following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:01:07 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '37000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:01:10Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:01:07Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:01:05Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '45000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:01:07Z'
      Request-Id:
      - req_011CQrSRpyrprHGm5wRivwdR
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b209097ba91736-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01WsJpu1TZL6fbosQfeuruqg","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":1514,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":45,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:01:07 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"institution\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":2}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewLoanFile. Your goal is: Review loan
        file. The command description is: Checks the LoanFile against all requirements
        in its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements..
        The inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}\n\nYou
        have been ran with the following inputs:\n\n{\"loan_file\":{\"id\":2,\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2}}\n\nYour
        response should match the following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:01:09 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '37000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:01:13Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:01:09Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:01:07Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '45000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:01:09Z'
      Request-Id:
      - req_011CQrSS3hLRf1PsSHFk9QKP
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b2091c1ffacf27-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_0122CCKkv5UaRfgLTnrmSfUt","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2010,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":34,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:01:09 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"institution\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":2}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewLoanFile. Your goal is: Review loan
        file. The command description is: Checks the LoanFile against all requirements
        in its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements..
        The inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}\n\nYou
        have been ran with the following inputs:\n\n{\"loan_file\":{\"id\":2,\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2}}\n\nYour
        response should match the following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:01:12 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '37000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:01:17Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:01:13Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:01:10Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '45000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:01:13Z'
      Request-Id:
      - req_011CQrSSDRym4rQdT2m8kHQW
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b2092a4c31944d-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01KyDhxNava15Zbyy4FPqCEB","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2161,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":43,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:01:13 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"institution\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":2}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewLoanFile. Your goal is: Review loan
        file. The command description is: Checks the LoanFile against all requirements
        in its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements..
        The inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}\n\nYou
        have been ran with the following inputs:\n\n{\"loan_file\":{\"id\":2,\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2}}\n\nYour
        response should match the following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:01:15 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '36000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:01:21Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:01:15Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:01:13Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '44000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:01:15Z'
      Request-Id:
      - req_011CQrSSSmfKRXbU1Rv5czeg
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b2093dc94ececd-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01RGmtHDp1o3jsruxdaoGrjm","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2711,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":55,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:01:15 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"institution\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":2}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewLoanFile. Your goal is: Review loan
        file. The command description is: Checks the LoanFile against all requirements
        in its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements..
        The inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}\n\nYou
        have been ran with the following inputs:\n\n{\"loan_file\":{\"id\":2,\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2}}\n\nYour
        response should match the following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:01:19 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '35000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:01:25Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:01:18Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:01:15Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '43000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:01:18Z'
      Request-Id:
      - req_011CQrSSdsecuEsZ7MM3pnMG
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b2094dfc031690-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_014asu2Jkt4S4TWXzRhhPiFQ","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2947,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":35,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:01:19 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"institution\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":2}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\",\"description\":\"Notifies
        the user that the current goal has been accomplished and returns a final result
        formatted according to the result schema. The user might issue a new goal.\",\"inputs_type\":{\"type\":\"object\",\"required\":[\"result\"],\"properties\":{\"result\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}}}}}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewLoanFile. Your goal is: Review loan
        file. The command description is: Checks the LoanFile against all requirements
        in its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements..
        The inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}\n\nYou
        have been ran with the following inputs:\n\n{\"loan_file\":{\"id\":2,\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2}}\n\nYour
        response should match the following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:01:22 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '34000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:01:30Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:01:22Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:01:19Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '42000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:01:22Z'
      Request-Id:
      - req_011CQrSSuP3z8we2i3E773Da
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b209648d48ce50-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_014pVUCMdDhHxUKotdegbjbp","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\",\"inputs\":{\"result\":{\"decision\":\"denied\",\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":3189,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":69,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:01:22 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"description\":\"Checks
        the LoanFile against all requirements in its CreditPolicy. Denies the LoanFile
        that has any unsatisfied requirements.\",\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"agent_options\":{\"type\":\"object\",\"properties\":{\"verbose\":{\"type\":\"boolean\"},\"io_out\":{},\"io_err\":{},\"context\":{\"type\":[\"object\",\"null\"],\"required\":[\"current_goal\"],\"properties\":{\"current_goal\":{\"type\":\"string\",\"description\":\"The
        current goal the agent needs to accomplish\"},\"previous_goals\":{\"type\":\"array\",\"items\":{\"type\":\"string\"}},\"command_log\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"command_name\",\"outcome\"],\"properties\":{\"command_name\":{\"type\":\"string\",\"description\":\"Name
        of the command that was run\"},\"inputs\":{\"type\":[\"object\",\"null\"],\"description\":\"Inputs
        to the command\"},\"outcome\":{\"type\":\"object\",\"required\":[\"success\"],\"properties\":{\"success\":{\"type\":\"boolean\",\"description\":\"Whether
        the command succeeded or not\"},\"result\":{\"description\":\"Result of the
        command\"},\"errors_hash\":{\"description\":\"Errors that occurred during
        the command\"}}}}},\"description\":\"Log of all commands run so far and their
        outcomes\"}},\"description\":\"The current context of the agent\"},\"agent_name\":{\"type\":[\"string\",\"null\"]},\"llm_model\":{\"type\":[\"string\",\"null\"],\"enum\":[\"babbage-002\",\"chatgpt-4o-latest\",\"claude-2.0\",\"claude-2.1\",\"claude-3-5-haiku-20241022\",\"claude-3-5-sonnet-20240620\",\"claude-3-5-sonnet-20241022\",\"claude-3-7-sonnet-20250219\",\"claude-3-haiku-20240307\",\"claude-3-opus-20240229\",\"claude-3-sonnet-20240229\",\"claude-opus-4-20250514\",\"claude-sonnet-4-20250514\",\"codex-mini-latest\",\"dall-e-2\",\"dall-e-3\",\"davinci-002\",\"gpt-3.5-turbo\",\"gpt-3.5-turbo-0125\",\"gpt-3.5-turbo-1106\",\"gpt-3.5-turbo-16k\",\"gpt-3.5-turbo-instruct\",\"gpt-3.5-turbo-instruct-0914\",\"gpt-4\",\"gpt-4-0125-preview\",\"gpt-4-0613\",\"gpt-4-1106-preview\",\"gpt-4-turbo\",\"gpt-4-turbo-2024-04-09\",\"gpt-4-turbo-preview\",\"gpt-4.1\",\"gpt-4.1-2025-04-14\",\"gpt-4.1-mini\",\"gpt-4.1-mini-2025-04-14\",\"gpt-4.1-nano\",\"gpt-4.1-nano-2025-04-14\",\"gpt-4.5-preview\",\"gpt-4.5-preview-2025-02-27\",\"gpt-4o\",\"gpt-4o-2024-05-13\",\"gpt-4o-2024-08-06\",\"gpt-4o-2024-11-20\",\"gpt-4o-audio-preview\",\"gpt-4o-audio-preview-2024-10-01\",\"gpt-4o-audio-preview-2024-12-17\",\"gpt-4o-audio-preview-2025-06-03\",\"gpt-4o-mini\",\"gpt-4o-mini-2024-07-18\",\"gpt-4o-mini-audio-preview\",\"gpt-4o-mini-audio-preview-2024-12-17\",\"gpt-4o-mini-realtime-preview\",\"gpt-4o-mini-realtime-preview-2024-12-17\",\"gpt-4o-mini-search-preview\",\"gpt-4o-mini-search-preview-2025-03-11\",\"gpt-4o-mini-transcribe\",\"gpt-4o-mini-tts\",\"gpt-4o-realtime-preview\",\"gpt-4o-realtime-preview-2024-10-01\",\"gpt-4o-realtime-preview-2024-12-17\",\"gpt-4o-realtime-preview-2025-06-03\",\"gpt-4o-search-preview\",\"gpt-4o-search-preview-2025-03-11\",\"gpt-4o-transcribe\",\"gpt-image-1\",\"o1\",\"o1-2024-12-17\",\"o1-mini\",\"o1-mini-2024-09-12\",\"o1-preview\",\"o1-preview-2024-09-12\",\"o1-pro\",\"o1-pro-2025-03-19\",\"o3-mini\",\"o3-mini-2025-01-31\",\"o4-mini\",\"o4-mini-2025-04-16\",\"omni-moderation-2024-09-26\",\"omni-moderation-latest\",\"text-embedding-3-large\",\"text-embedding-3-small\",\"text-embedding-ada-002\",\"tts-1\",\"tts-1-1106\",\"tts-1-hd\",\"tts-1-hd-1106\",\"whisper-1\"],\"description\":\"The
        model to use for the LLM\"},\"max_llm_calls_per_minute\":{\"type\":[\"number\",\"null\"]}}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"inputs\":{\"loan_file\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"decision\":\"denied\",\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review.\n\nYour response should match the
        following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:01:24 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '33000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:01:34Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:01:24Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:01:22Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '41000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:01:24Z'
      Request-Id:
      - req_011CQrST964Mz4pfWogYUYRD
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b20978cceecf2d-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01Fbrjn4fBv9yLPBxGryRkJQ","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2977,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":30,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:01:24 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"description\":\"Checks
        the LoanFile against all requirements in its CreditPolicy. Denies the LoanFile
        that has any unsatisfied requirements.\",\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"agent_options\":{\"type\":\"object\",\"properties\":{\"verbose\":{\"type\":\"boolean\"},\"io_out\":{},\"io_err\":{},\"context\":{\"type\":[\"object\",\"null\"],\"required\":[\"current_goal\"],\"properties\":{\"current_goal\":{\"type\":\"string\",\"description\":\"The
        current goal the agent needs to accomplish\"},\"previous_goals\":{\"type\":\"array\",\"items\":{\"type\":\"string\"}},\"command_log\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"command_name\",\"outcome\"],\"properties\":{\"command_name\":{\"type\":\"string\",\"description\":\"Name
        of the command that was run\"},\"inputs\":{\"type\":[\"object\",\"null\"],\"description\":\"Inputs
        to the command\"},\"outcome\":{\"type\":\"object\",\"required\":[\"success\"],\"properties\":{\"success\":{\"type\":\"boolean\",\"description\":\"Whether
        the command succeeded or not\"},\"result\":{\"description\":\"Result of the
        command\"},\"errors_hash\":{\"description\":\"Errors that occurred during
        the command\"}}}}},\"description\":\"Log of all commands run so far and their
        outcomes\"}},\"description\":\"The current context of the agent\"},\"agent_name\":{\"type\":[\"string\",\"null\"]},\"llm_model\":{\"type\":[\"string\",\"null\"],\"enum\":[\"babbage-002\",\"chatgpt-4o-latest\",\"claude-2.0\",\"claude-2.1\",\"claude-3-5-haiku-20241022\",\"claude-3-5-sonnet-20240620\",\"claude-3-5-sonnet-20241022\",\"claude-3-7-sonnet-20250219\",\"claude-3-haiku-20240307\",\"claude-3-opus-20240229\",\"claude-3-sonnet-20240229\",\"claude-opus-4-20250514\",\"claude-sonnet-4-20250514\",\"codex-mini-latest\",\"dall-e-2\",\"dall-e-3\",\"davinci-002\",\"gpt-3.5-turbo\",\"gpt-3.5-turbo-0125\",\"gpt-3.5-turbo-1106\",\"gpt-3.5-turbo-16k\",\"gpt-3.5-turbo-instruct\",\"gpt-3.5-turbo-instruct-0914\",\"gpt-4\",\"gpt-4-0125-preview\",\"gpt-4-0613\",\"gpt-4-1106-preview\",\"gpt-4-turbo\",\"gpt-4-turbo-2024-04-09\",\"gpt-4-turbo-preview\",\"gpt-4.1\",\"gpt-4.1-2025-04-14\",\"gpt-4.1-mini\",\"gpt-4.1-mini-2025-04-14\",\"gpt-4.1-nano\",\"gpt-4.1-nano-2025-04-14\",\"gpt-4.5-preview\",\"gpt-4.5-preview-2025-02-27\",\"gpt-4o\",\"gpt-4o-2024-05-13\",\"gpt-4o-2024-08-06\",\"gpt-4o-2024-11-20\",\"gpt-4o-audio-preview\",\"gpt-4o-audio-preview-2024-10-01\",\"gpt-4o-audio-preview-2024-12-17\",\"gpt-4o-audio-preview-2025-06-03\",\"gpt-4o-mini\",\"gpt-4o-mini-2024-07-18\",\"gpt-4o-mini-audio-preview\",\"gpt-4o-mini-audio-preview-2024-12-17\",\"gpt-4o-mini-realtime-preview\",\"gpt-4o-mini-realtime-preview-2024-12-17\",\"gpt-4o-mini-search-preview\",\"gpt-4o-mini-search-preview-2025-03-11\",\"gpt-4o-mini-transcribe\",\"gpt-4o-mini-tts\",\"gpt-4o-realtime-preview\",\"gpt-4o-realtime-preview-2024-10-01\",\"gpt-4o-realtime-preview-2024-12-17\",\"gpt-4o-realtime-preview-2025-06-03\",\"gpt-4o-search-preview\",\"gpt-4o-search-preview-2025-03-11\",\"gpt-4o-transcribe\",\"gpt-image-1\",\"o1\",\"o1-2024-12-17\",\"o1-mini\",\"o1-mini-2024-09-12\",\"o1-preview\",\"o1-preview-2024-09-12\",\"o1-pro\",\"o1-pro-2025-03-19\",\"o3-mini\",\"o3-mini-2025-01-31\",\"o4-mini\",\"o4-mini-2025-04-16\",\"omni-moderation-2024-09-26\",\"omni-moderation-latest\",\"text-embedding-3-large\",\"text-embedding-3-small\",\"text-embedding-ada-002\",\"tts-1\",\"tts-1-1106\",\"tts-1-hd\",\"tts-1-hd-1106\",\"whisper-1\"],\"description\":\"The
        model to use for the LLM\"},\"max_llm_calls_per_minute\":{\"type\":[\"number\",\"null\"]}}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"inputs\":{\"loan_file\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"decision\":\"denied\",\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"id\":3}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review.\n\nYour response should match the
        following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:01:27 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '32000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:01:39Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:01:27Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:01:25Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '40000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:01:27Z'
      Request-Id:
      - req_011CQrSTKPgKDmCda4aGwLer
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b20987cdf1cf19-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_016vkvqc8iKSYUNmJGxeeh1j","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"inputs\":{\"loan_file\":3}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":3124,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":31,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:01:27 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewLoanFile. Your goal is: Review loan
        file. The command description is: Checks the LoanFile against all requirements
        in its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements..
        The inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}\n\nYou
        have been ran with the following inputs:\n\n{\"loan_file\":{\"id\":3,\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3}}\n\nYour
        response should match the following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:01:30 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '32000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:01:41Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:01:30Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:01:28Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '40000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:01:30Z'
      Request-Id:
      - req_011CQrSTY2waQ7pNMKkvPn1T
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b2099a29dccfb0-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_013479xDqQhu9kosTuEGxVf7","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":1149,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":42,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:01:30 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"}],"temperature":0.0,"system":"You are the implementation
        of a command called Foobara::Agent::DetermineNextCommandNameAndInputs which
        has the following description:\n\nReturns the name of the next command to
        run and its inputs given the progress  towards accomplishing the current goal.
        If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewLoanFile. Your goal is: Review loan
        file. The command description is: Checks the LoanFile against all requirements
        in its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements..
        The inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}\n\nYou
        have been ran with the following inputs:\n\n{\"loan_file\":{\"id\":3,\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3}}\n\nYour
        response should match the following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:01:33 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '33000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:01:43Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:01:33Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:01:31Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '41000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:01:33Z'
      Request-Id:
      - req_011CQrSTjFP5BqKcZFJwZBhy
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b209aaaeaded3a-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01G1ddhpbnHajEdDV72xTTpn","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":3}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":1435,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":31,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:01:33 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":3,\"institution\":\"Bank
        C\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":1}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewLoanFile. Your goal is: Review loan
        file. The command description is: Checks the LoanFile against all requirements
        in its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements..
        The inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}\n\nYou
        have been ran with the following inputs:\n\n{\"loan_file\":{\"id\":3,\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3}}\n\nYour
        response should match the following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:01:36 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '33000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:01:45Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:01:36Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:01:33Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '41000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:01:36Z'
      Request-Id:
      - req_011CQrSTxMvSoqNt5DciaePM
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b209bdec53cf27-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01Vju4KfMQvioxD3gShCoN5n","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":1514,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":43,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:01:36 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":3,\"institution\":\"Bank
        C\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewLoanFile. Your goal is: Review loan
        file. The command description is: Checks the LoanFile against all requirements
        in its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements..
        The inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}\n\nYou
        have been ran with the following inputs:\n\n{\"loan_file\":{\"id\":3,\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3}}\n\nYour
        response should match the following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:01:39 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '33000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:01:48Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:01:39Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:01:37Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '41000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:01:39Z'
      Request-Id:
      - req_011CQrSUD9AhJcuUgavnRtsm
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b209d28bb267eb-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01Xiq12C9WRdibH9WUUSaqgw","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2064,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":43,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:01:39 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":3,\"institution\":\"Bank
        C\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewLoanFile. Your goal is: Review loan
        file. The command description is: Checks the LoanFile against all requirements
        in its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements..
        The inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}\n\nYou
        have been ran with the following inputs:\n\n{\"loan_file\":{\"id\":3,\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3}}\n\nYour
        response should match the following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:01:44 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '34000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:01:52Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:01:44Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:01:40Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '42000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:01:44Z'
      Request-Id:
      - req_011CQrSURqQciVP7hunAxawH
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b209e5eb5f5c22-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01G86ZcANE1ECnBbPqRokSRF","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"inputs\":{\"loan_file\":3,\"credit_score_used\":750}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2574,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":40,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:01:44 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":3,\"institution\":\"Bank
        C\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"inputs\":{\"loan_file\":3,\"credit_score_used\":750}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"data.loan_file.cannot_transition_state\":{\"key\":\"data.loan_file.cannot_transition_state\",\"path\":[\"loan_file\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"cannot_transition_state\",\"message\":\"Cannot
        perform approve transition for loan file 3 from needs_review. Expected state
        to be one of: [:in_review]. Did you forget to start the review?\",\"context\":{\"loan_file_id\":3,\"current_state\":\"needs_review\",\"required_states\":[\"in_review\"],\"attempted_transition\":\"approve\"},\"is_fatal\":false}}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewLoanFile. Your goal is: Review loan
        file. The command description is: Checks the LoanFile against all requirements
        in its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements..
        The inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}\n\nYou
        have been ran with the following inputs:\n\n{\"loan_file\":{\"id\":3,\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3}}\n\nYour
        response should match the following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:01:47 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '33000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:01:56Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:01:47Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:01:45Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '41000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:01:47Z'
      Request-Id:
      - req_011CQrSUnC1dJL5Vo3A1HtdY
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b20a03bb7615a2-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_013u5e2zdo66mZ3jgrc1tNt6","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":3}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2761,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":34,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:01:47 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":3,\"institution\":\"Bank
        C\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"inputs\":{\"loan_file\":3,\"credit_score_used\":750}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"data.loan_file.cannot_transition_state\":{\"key\":\"data.loan_file.cannot_transition_state\",\"path\":[\"loan_file\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"cannot_transition_state\",\"message\":\"Cannot
        perform approve transition for loan file 3 from needs_review. Expected state
        to be one of: [:in_review]. Did you forget to start the review?\",\"context\":{\"loan_file_id\":3,\"current_state\":\"needs_review\",\"required_states\":[\"in_review\"],\"attempted_transition\":\"approve\"},\"is_fatal\":false}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewLoanFile. Your goal is: Review loan
        file. The command description is: Checks the LoanFile against all requirements
        in its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements..
        The inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}\n\nYou
        have been ran with the following inputs:\n\n{\"loan_file\":{\"id\":3,\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3}}\n\nYour
        response should match the following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:01:50 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '32000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:02:01Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:01:50Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:01:47Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '40000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:01:50Z'
      Request-Id:
      - req_011CQrSUzUhRjWBFXUfm2C1X
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b20a1599f0cf9f-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01WiHYLYAepp9ZKS98ZkKAGE","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":3}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":3257,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":34,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:01:50 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":3,\"institution\":\"Bank
        C\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"inputs\":{\"loan_file\":3,\"credit_score_used\":750}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"data.loan_file.cannot_transition_state\":{\"key\":\"data.loan_file.cannot_transition_state\",\"path\":[\"loan_file\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"cannot_transition_state\",\"message\":\"Cannot
        perform approve transition for loan file 3 from needs_review. Expected state
        to be one of: [:in_review]. Did you forget to start the review?\",\"context\":{\"loan_file_id\":3,\"current_state\":\"needs_review\",\"required_states\":[\"in_review\"],\"attempted_transition\":\"approve\"},\"is_fatal\":false}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":3,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewLoanFile. Your goal is: Review loan
        file. The command description is: Checks the LoanFile against all requirements
        in its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements..
        The inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}\n\nYou
        have been ran with the following inputs:\n\n{\"loan_file\":{\"id\":3,\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3}}\n\nYour
        response should match the following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:01:53 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '30000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:02:06Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:01:53Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:01:50Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '38000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:01:53Z'
      Request-Id:
      - req_011CQrSVC6SSxGY5farVUft2
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b20a26ba196cd4-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01YW6Z5mSt53RHwoxQscJC9N","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"inputs\":{\"loan_file\":3,\"credit_score_used\":750}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":3408,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":40,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:01:53 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":3,\"institution\":\"Bank
        C\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":3,\"state\":\"drafting_docs\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"underwriter_decision\":{\"decision\":\"approved\",\"credit_score_used\":750}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"inputs\":{\"loan_file\":3,\"credit_score_used\":750}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":3,\"state\":\"drafting_docs\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"underwriter_decision\":{\"decision\":\"approved\",\"credit_score_used\":750}}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewLoanFile. Your goal is: Review loan
        file. The command description is: Checks the LoanFile against all requirements
        in its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements..
        The inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}\n\nYou
        have been ran with the following inputs:\n\n{\"loan_file\":{\"id\":3,\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3}}\n\nYour
        response should match the following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:01:57 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '30000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:02:11Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:01:57Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:01:53Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '38000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:01:57Z'
      Request-Id:
      - req_011CQrSVRNA5vDPhXZdNUX25
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b20a3a1f1edc0d-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_019mZUm6gpwCBhba2zW19KuT","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":3418,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":35,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:01:57 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":3,\"institution\":\"Bank
        C\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":3,\"state\":\"drafting_docs\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"underwriter_decision\":{\"decision\":\"approved\",\"credit_score_used\":750}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"inputs\":{\"loan_file\":3,\"credit_score_used\":750}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":3,\"state\":\"drafting_docs\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"underwriter_decision\":{\"decision\":\"approved\",\"credit_score_used\":750}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\",\"description\":\"Notifies
        the user that the current goal has been accomplished and returns a final result
        formatted according to the result schema. The user might issue a new goal.\",\"inputs_type\":{\"type\":\"object\",\"required\":[\"result\"],\"properties\":{\"result\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}}}}}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewLoanFile. Your goal is: Review loan
        file. The command description is: Checks the LoanFile against all requirements
        in its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements..
        The inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}\n\nYou
        have been ran with the following inputs:\n\n{\"loan_file\":{\"id\":3,\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3}}\n\nYour
        response should match the following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:02:00 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '28000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:02:17Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:02:00Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:01:58Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '36000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:02:00Z'
      Request-Id:
      - req_011CQrSVjd1QRRGCjFas4PAR
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b20a548879fa16-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_016eMkHZS5Dwb8LSJxaP85ez","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::ReviewLoanFileAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\",\"inputs\":{\"result\":{\"decision\":\"approved\",\"credit_score_used\":750}}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":3660,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":54,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:02:00 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"description\":\"Checks
        the LoanFile against all requirements in its CreditPolicy. Denies the LoanFile
        that has any unsatisfied requirements.\",\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"agent_options\":{\"type\":\"object\",\"properties\":{\"verbose\":{\"type\":\"boolean\"},\"io_out\":{},\"io_err\":{},\"context\":{\"type\":[\"object\",\"null\"],\"required\":[\"current_goal\"],\"properties\":{\"current_goal\":{\"type\":\"string\",\"description\":\"The
        current goal the agent needs to accomplish\"},\"previous_goals\":{\"type\":\"array\",\"items\":{\"type\":\"string\"}},\"command_log\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"command_name\",\"outcome\"],\"properties\":{\"command_name\":{\"type\":\"string\",\"description\":\"Name
        of the command that was run\"},\"inputs\":{\"type\":[\"object\",\"null\"],\"description\":\"Inputs
        to the command\"},\"outcome\":{\"type\":\"object\",\"required\":[\"success\"],\"properties\":{\"success\":{\"type\":\"boolean\",\"description\":\"Whether
        the command succeeded or not\"},\"result\":{\"description\":\"Result of the
        command\"},\"errors_hash\":{\"description\":\"Errors that occurred during
        the command\"}}}}},\"description\":\"Log of all commands run so far and their
        outcomes\"}},\"description\":\"The current context of the agent\"},\"agent_name\":{\"type\":[\"string\",\"null\"]},\"llm_model\":{\"type\":[\"string\",\"null\"],\"enum\":[\"babbage-002\",\"chatgpt-4o-latest\",\"claude-2.0\",\"claude-2.1\",\"claude-3-5-haiku-20241022\",\"claude-3-5-sonnet-20240620\",\"claude-3-5-sonnet-20241022\",\"claude-3-7-sonnet-20250219\",\"claude-3-haiku-20240307\",\"claude-3-opus-20240229\",\"claude-3-sonnet-20240229\",\"claude-opus-4-20250514\",\"claude-sonnet-4-20250514\",\"codex-mini-latest\",\"dall-e-2\",\"dall-e-3\",\"davinci-002\",\"gpt-3.5-turbo\",\"gpt-3.5-turbo-0125\",\"gpt-3.5-turbo-1106\",\"gpt-3.5-turbo-16k\",\"gpt-3.5-turbo-instruct\",\"gpt-3.5-turbo-instruct-0914\",\"gpt-4\",\"gpt-4-0125-preview\",\"gpt-4-0613\",\"gpt-4-1106-preview\",\"gpt-4-turbo\",\"gpt-4-turbo-2024-04-09\",\"gpt-4-turbo-preview\",\"gpt-4.1\",\"gpt-4.1-2025-04-14\",\"gpt-4.1-mini\",\"gpt-4.1-mini-2025-04-14\",\"gpt-4.1-nano\",\"gpt-4.1-nano-2025-04-14\",\"gpt-4.5-preview\",\"gpt-4.5-preview-2025-02-27\",\"gpt-4o\",\"gpt-4o-2024-05-13\",\"gpt-4o-2024-08-06\",\"gpt-4o-2024-11-20\",\"gpt-4o-audio-preview\",\"gpt-4o-audio-preview-2024-10-01\",\"gpt-4o-audio-preview-2024-12-17\",\"gpt-4o-audio-preview-2025-06-03\",\"gpt-4o-mini\",\"gpt-4o-mini-2024-07-18\",\"gpt-4o-mini-audio-preview\",\"gpt-4o-mini-audio-preview-2024-12-17\",\"gpt-4o-mini-realtime-preview\",\"gpt-4o-mini-realtime-preview-2024-12-17\",\"gpt-4o-mini-search-preview\",\"gpt-4o-mini-search-preview-2025-03-11\",\"gpt-4o-mini-transcribe\",\"gpt-4o-mini-tts\",\"gpt-4o-realtime-preview\",\"gpt-4o-realtime-preview-2024-10-01\",\"gpt-4o-realtime-preview-2024-12-17\",\"gpt-4o-realtime-preview-2025-06-03\",\"gpt-4o-search-preview\",\"gpt-4o-search-preview-2025-03-11\",\"gpt-4o-transcribe\",\"gpt-image-1\",\"o1\",\"o1-2024-12-17\",\"o1-mini\",\"o1-mini-2024-09-12\",\"o1-preview\",\"o1-preview-2024-09-12\",\"o1-pro\",\"o1-pro-2025-03-19\",\"o3-mini\",\"o3-mini-2025-01-31\",\"o4-mini\",\"o4-mini-2025-04-16\",\"omni-moderation-2024-09-26\",\"omni-moderation-latest\",\"text-embedding-3-large\",\"text-embedding-3-small\",\"text-embedding-ada-002\",\"tts-1\",\"tts-1-1106\",\"tts-1-hd\",\"tts-1-hd-1106\",\"whisper-1\"],\"description\":\"The
        model to use for the LLM\"},\"max_llm_calls_per_minute\":{\"type\":[\"number\",\"null\"]}}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"inputs\":{\"loan_file\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"decision\":\"denied\",\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"id\":3}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"inputs\":{\"loan_file\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"decision\":\"approved\",\"credit_score_used\":750}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review.\n\nYour response should match the
        following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:02:02 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '27000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:02:22Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:02:02Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:02:00Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '35000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:02:02Z'
      Request-Id:
      - req_011CQrSVvS951PRLLaWpZLmT
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b20a649b906899-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01Vb9fRt3KxXfFVZXrmaF4fV","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":3178,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":30,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:02:02 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"description\":\"Checks
        the LoanFile against all requirements in its CreditPolicy. Denies the LoanFile
        that has any unsatisfied requirements.\",\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"agent_options\":{\"type\":\"object\",\"properties\":{\"verbose\":{\"type\":\"boolean\"},\"io_out\":{},\"io_err\":{},\"context\":{\"type\":[\"object\",\"null\"],\"required\":[\"current_goal\"],\"properties\":{\"current_goal\":{\"type\":\"string\",\"description\":\"The
        current goal the agent needs to accomplish\"},\"previous_goals\":{\"type\":\"array\",\"items\":{\"type\":\"string\"}},\"command_log\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"command_name\",\"outcome\"],\"properties\":{\"command_name\":{\"type\":\"string\",\"description\":\"Name
        of the command that was run\"},\"inputs\":{\"type\":[\"object\",\"null\"],\"description\":\"Inputs
        to the command\"},\"outcome\":{\"type\":\"object\",\"required\":[\"success\"],\"properties\":{\"success\":{\"type\":\"boolean\",\"description\":\"Whether
        the command succeeded or not\"},\"result\":{\"description\":\"Result of the
        command\"},\"errors_hash\":{\"description\":\"Errors that occurred during
        the command\"}}}}},\"description\":\"Log of all commands run so far and their
        outcomes\"}},\"description\":\"The current context of the agent\"},\"agent_name\":{\"type\":[\"string\",\"null\"]},\"llm_model\":{\"type\":[\"string\",\"null\"],\"enum\":[\"babbage-002\",\"chatgpt-4o-latest\",\"claude-2.0\",\"claude-2.1\",\"claude-3-5-haiku-20241022\",\"claude-3-5-sonnet-20240620\",\"claude-3-5-sonnet-20241022\",\"claude-3-7-sonnet-20250219\",\"claude-3-haiku-20240307\",\"claude-3-opus-20240229\",\"claude-3-sonnet-20240229\",\"claude-opus-4-20250514\",\"claude-sonnet-4-20250514\",\"codex-mini-latest\",\"dall-e-2\",\"dall-e-3\",\"davinci-002\",\"gpt-3.5-turbo\",\"gpt-3.5-turbo-0125\",\"gpt-3.5-turbo-1106\",\"gpt-3.5-turbo-16k\",\"gpt-3.5-turbo-instruct\",\"gpt-3.5-turbo-instruct-0914\",\"gpt-4\",\"gpt-4-0125-preview\",\"gpt-4-0613\",\"gpt-4-1106-preview\",\"gpt-4-turbo\",\"gpt-4-turbo-2024-04-09\",\"gpt-4-turbo-preview\",\"gpt-4.1\",\"gpt-4.1-2025-04-14\",\"gpt-4.1-mini\",\"gpt-4.1-mini-2025-04-14\",\"gpt-4.1-nano\",\"gpt-4.1-nano-2025-04-14\",\"gpt-4.5-preview\",\"gpt-4.5-preview-2025-02-27\",\"gpt-4o\",\"gpt-4o-2024-05-13\",\"gpt-4o-2024-08-06\",\"gpt-4o-2024-11-20\",\"gpt-4o-audio-preview\",\"gpt-4o-audio-preview-2024-10-01\",\"gpt-4o-audio-preview-2024-12-17\",\"gpt-4o-audio-preview-2025-06-03\",\"gpt-4o-mini\",\"gpt-4o-mini-2024-07-18\",\"gpt-4o-mini-audio-preview\",\"gpt-4o-mini-audio-preview-2024-12-17\",\"gpt-4o-mini-realtime-preview\",\"gpt-4o-mini-realtime-preview-2024-12-17\",\"gpt-4o-mini-search-preview\",\"gpt-4o-mini-search-preview-2025-03-11\",\"gpt-4o-mini-transcribe\",\"gpt-4o-mini-tts\",\"gpt-4o-realtime-preview\",\"gpt-4o-realtime-preview-2024-10-01\",\"gpt-4o-realtime-preview-2024-12-17\",\"gpt-4o-realtime-preview-2025-06-03\",\"gpt-4o-search-preview\",\"gpt-4o-search-preview-2025-03-11\",\"gpt-4o-transcribe\",\"gpt-image-1\",\"o1\",\"o1-2024-12-17\",\"o1-mini\",\"o1-mini-2024-09-12\",\"o1-preview\",\"o1-preview-2024-09-12\",\"o1-pro\",\"o1-pro-2025-03-19\",\"o3-mini\",\"o3-mini-2025-01-31\",\"o4-mini\",\"o4-mini-2025-04-16\",\"omni-moderation-2024-09-26\",\"omni-moderation-latest\",\"text-embedding-3-large\",\"text-embedding-3-small\",\"text-embedding-ada-002\",\"tts-1\",\"tts-1-1106\",\"tts-1-hd\",\"tts-1-hd-1106\",\"whisper-1\"],\"description\":\"The
        model to use for the LLM\"},\"max_llm_calls_per_minute\":{\"type\":[\"number\",\"null\"]}}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"inputs\":{\"loan_file\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"decision\":\"denied\",\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"id\":3}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"inputs\":{\"loan_file\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"decision\":\"approved\",\"credit_score_used\":750}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":null}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review.\n\nYour response should match the
        following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:02:06 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '25000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:02:26Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:02:06Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:02:02Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '33000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:02:06Z'
      Request-Id:
      - req_011CQrSW6fYV3Zr1qB5j3nsx
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b20a734b64ebe2-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01Ee1k6gswg6hMGY6qBYmpzz","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":3220,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":42,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:02:06 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"description\":\"Checks
        the LoanFile against all requirements in its CreditPolicy. Denies the LoanFile
        that has any unsatisfied requirements.\",\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"agent_options\":{\"type\":\"object\",\"properties\":{\"verbose\":{\"type\":\"boolean\"},\"io_out\":{},\"io_err\":{},\"context\":{\"type\":[\"object\",\"null\"],\"required\":[\"current_goal\"],\"properties\":{\"current_goal\":{\"type\":\"string\",\"description\":\"The
        current goal the agent needs to accomplish\"},\"previous_goals\":{\"type\":\"array\",\"items\":{\"type\":\"string\"}},\"command_log\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"command_name\",\"outcome\"],\"properties\":{\"command_name\":{\"type\":\"string\",\"description\":\"Name
        of the command that was run\"},\"inputs\":{\"type\":[\"object\",\"null\"],\"description\":\"Inputs
        to the command\"},\"outcome\":{\"type\":\"object\",\"required\":[\"success\"],\"properties\":{\"success\":{\"type\":\"boolean\",\"description\":\"Whether
        the command succeeded or not\"},\"result\":{\"description\":\"Result of the
        command\"},\"errors_hash\":{\"description\":\"Errors that occurred during
        the command\"}}}}},\"description\":\"Log of all commands run so far and their
        outcomes\"}},\"description\":\"The current context of the agent\"},\"agent_name\":{\"type\":[\"string\",\"null\"]},\"llm_model\":{\"type\":[\"string\",\"null\"],\"enum\":[\"babbage-002\",\"chatgpt-4o-latest\",\"claude-2.0\",\"claude-2.1\",\"claude-3-5-haiku-20241022\",\"claude-3-5-sonnet-20240620\",\"claude-3-5-sonnet-20241022\",\"claude-3-7-sonnet-20250219\",\"claude-3-haiku-20240307\",\"claude-3-opus-20240229\",\"claude-3-sonnet-20240229\",\"claude-opus-4-20250514\",\"claude-sonnet-4-20250514\",\"codex-mini-latest\",\"dall-e-2\",\"dall-e-3\",\"davinci-002\",\"gpt-3.5-turbo\",\"gpt-3.5-turbo-0125\",\"gpt-3.5-turbo-1106\",\"gpt-3.5-turbo-16k\",\"gpt-3.5-turbo-instruct\",\"gpt-3.5-turbo-instruct-0914\",\"gpt-4\",\"gpt-4-0125-preview\",\"gpt-4-0613\",\"gpt-4-1106-preview\",\"gpt-4-turbo\",\"gpt-4-turbo-2024-04-09\",\"gpt-4-turbo-preview\",\"gpt-4.1\",\"gpt-4.1-2025-04-14\",\"gpt-4.1-mini\",\"gpt-4.1-mini-2025-04-14\",\"gpt-4.1-nano\",\"gpt-4.1-nano-2025-04-14\",\"gpt-4.5-preview\",\"gpt-4.5-preview-2025-02-27\",\"gpt-4o\",\"gpt-4o-2024-05-13\",\"gpt-4o-2024-08-06\",\"gpt-4o-2024-11-20\",\"gpt-4o-audio-preview\",\"gpt-4o-audio-preview-2024-10-01\",\"gpt-4o-audio-preview-2024-12-17\",\"gpt-4o-audio-preview-2025-06-03\",\"gpt-4o-mini\",\"gpt-4o-mini-2024-07-18\",\"gpt-4o-mini-audio-preview\",\"gpt-4o-mini-audio-preview-2024-12-17\",\"gpt-4o-mini-realtime-preview\",\"gpt-4o-mini-realtime-preview-2024-12-17\",\"gpt-4o-mini-search-preview\",\"gpt-4o-mini-search-preview-2025-03-11\",\"gpt-4o-mini-transcribe\",\"gpt-4o-mini-tts\",\"gpt-4o-realtime-preview\",\"gpt-4o-realtime-preview-2024-10-01\",\"gpt-4o-realtime-preview-2024-12-17\",\"gpt-4o-realtime-preview-2025-06-03\",\"gpt-4o-search-preview\",\"gpt-4o-search-preview-2025-03-11\",\"gpt-4o-transcribe\",\"gpt-image-1\",\"o1\",\"o1-2024-12-17\",\"o1-mini\",\"o1-mini-2024-09-12\",\"o1-preview\",\"o1-preview-2024-09-12\",\"o1-pro\",\"o1-pro-2025-03-19\",\"o3-mini\",\"o3-mini-2025-01-31\",\"o4-mini\",\"o4-mini-2025-04-16\",\"omni-moderation-2024-09-26\",\"omni-moderation-latest\",\"text-embedding-3-large\",\"text-embedding-3-small\",\"text-embedding-ada-002\",\"tts-1\",\"tts-1-1106\",\"tts-1-hd\",\"tts-1-hd-1106\",\"whisper-1\"],\"description\":\"The
        model to use for the LLM\"},\"max_llm_calls_per_minute\":{\"type\":[\"number\",\"null\"]}}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"inputs\":{\"loan_file\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"decision\":\"denied\",\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"id\":3}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"inputs\":{\"loan_file\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"decision\":\"approved\",\"credit_score_used\":750}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\",\"description\":\"Notifies
        the user that the current goal has been accomplished and returns a final result
        formatted according to the result schema. The user might issue a new goal.\",\"inputs_type\":{\"type\":\"object\",\"required\":[\"approved_count\",\"denied_count\"],\"properties\":{\"approved_count\":{\"type\":\"number\"},\"denied_count\":{\"type\":\"number\"}}}}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review.\n\nYour response should match the
        following JSON schema: \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Sun, 06 Jul 2025 21:02:09 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '24000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-06T21:02:32Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-06T21:02:09Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-06T21:02:06Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '32000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-06T21:02:09Z'
      Request-Id:
      - req_011CQrSWNqsxVkLKjATHTiGm
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 95b20a8b2be567be-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01ABvJ7UPxwj4oenrdiCVsTV","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\",\"inputs\":{\"approved_count\":1,\"denied_count\":2}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":3415,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":57,"service_tier":"standard"}}'
  recorded_at: Sun, 06 Jul 2025 21:02:09 GMT
recorded_with: VCR 6.3.1
