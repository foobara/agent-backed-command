---
http_interactions:
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: Checks each LoanFile needing review against all requirements in its CreditPolicy.
        If any requirement is not satisfied, it will be denied. Otherwise, approved.
        Accomplish this goal.\n\nYour response should match the following JSON schema:
        \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Mon, 30 Jun 2025 18:06:39 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-30T18:06:39Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-30T18:06:40Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-30T18:06:36Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '48000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-30T18:06:39Z'
      Request-Id:
      - req_011CQerGfcJ3nqotntQoQWX6
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 957f99363ef008d1-LAX
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01UjL2e2ByFjeZ2mBaDGn3wx","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":839,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":50,"service_tier":"standard"}}'
  recorded_at: Mon, 30 Jun 2025 18:06:40 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: Checks each LoanFile needing review against all requirements in its CreditPolicy.
        If any requirement is not satisfied, it will be denied. Otherwise, approved.
        Accomplish this goal.\n\nYour response should match the following JSON schema:
        \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Mon, 30 Jun 2025 18:06:43 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-30T18:06:43Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-30T18:06:43Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-30T18:06:40Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '48000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-30T18:06:43Z'
      Request-Id:
      - req_011CQerGy7W6YYkdcQznWxbr
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 957f994f9d45091e-LAX
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01JUTe6UWbtiZw9GgynKfbgu","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":1329,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":30,"service_tier":"standard"}}'
  recorded_at: Mon, 30 Jun 2025 18:06:44 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: Checks each LoanFile needing review against all requirements in its CreditPolicy.
        If any requirement is not satisfied, it will be denied. Otherwise, approved.
        Accomplish this goal.\n\nYour response should match the following JSON schema:
        \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Mon, 30 Jun 2025 18:06:48 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-30T18:06:47Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-30T18:06:48Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-30T18:06:44Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '48000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-30T18:06:47Z'
      Request-Id:
      - req_011CQerHGP5a6SAm5R3FRiFV
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 957f99689f65cba6-LAX
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_018LxY6yWhbh9m9W68DRfMh2","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":1474,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":42,"service_tier":"standard"}}'
  recorded_at: Mon, 30 Jun 2025 18:06:48 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"}],"temperature":0.0,"system":"You are the implementation
        of a command called Foobara::Agent::DetermineNextCommandNameAndInputs which
        has the following description:\n\nReturns the name of the next command to
        run and its inputs given the progress  towards accomplishing the current goal.
        If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: Checks each LoanFile needing review against all requirements in its CreditPolicy.
        If any requirement is not satisfied, it will be denied. Otherwise, approved.
        Accomplish this goal.\n\nYour response should match the following JSON schema:
        \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Mon, 30 Jun 2025 18:06:51 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '39000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-30T18:06:51Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-30T18:06:51Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-30T18:06:48Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '47000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-30T18:06:51Z'
      Request-Id:
      - req_011CQerHZCcDakVGUyBaTnqK
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 957f998189ae7d74-LAX
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01DCEbzsrXDopayvEx2AQ3Jf","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":1760,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":31,"service_tier":"standard"}}'
  recorded_at: Mon, 30 Jun 2025 18:06:51 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: Checks each LoanFile needing review against all requirements in its CreditPolicy.
        If any requirement is not satisfied, it will be denied. Otherwise, approved.
        Accomplish this goal.\n\nYour response should match the following JSON schema:
        \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Mon, 30 Jun 2025 18:06:55 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-30T18:06:55Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-30T18:06:55Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-30T18:06:52Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '48000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-30T18:06:55Z'
      Request-Id:
      - req_011CQerHoU6zwFEXtjKhW9Zx
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 957f9996496e08fe-LAX
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01EPrU6xjbWfN9YSftxmGmJG","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":1839,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":43,"service_tier":"standard"}}'
  recorded_at: Mon, 30 Jun 2025 18:06:55 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: Checks each LoanFile needing review against all requirements in its CreditPolicy.
        If any requirement is not satisfied, it will be denied. Otherwise, approved.
        Accomplish this goal.\n\nYour response should match the following JSON schema:
        \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Mon, 30 Jun 2025 18:07:06 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-30T18:07:03Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-30T18:07:06Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-30T18:06:59Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '48000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-30T18:07:03Z'
      Request-Id:
      - req_011CQerJBhZxodifLM8hufZe
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 957f99b51b0fb7fd-LAX
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_016fbV7DpXBPwAj5k3evVPxw","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2389,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":52,"service_tier":"standard"}}'
  recorded_at: Mon, 30 Jun 2025 18:07:07 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"data.loan_file.cannot_transition_state\":{\"key\":\"data.loan_file.cannot_transition_state\",\"path\":[\"loan_file\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"cannot_transition_state\",\"message\":\"Cannot
        perform deny transition for loan file 1 from needs_review. Expected state
        to be one of: [:in_review]. Did you forget to start the review?\",\"context\":{\"loan_file_id\":1,\"current_state\":\"needs_review\",\"required_states\":[\"in_review\"],\"attempted_transition\":\"deny\"},\"is_fatal\":false}}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: Checks each LoanFile needing review against all requirements in its CreditPolicy.
        If any requirement is not satisfied, it will be denied. Otherwise, approved.
        Accomplish this goal.\n\nYour response should match the following JSON schema:
        \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Mon, 30 Jun 2025 18:07:10 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '38000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-30T18:07:12Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-30T18:07:10Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-30T18:07:08Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '46000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-30T18:07:10Z'
      Request-Id:
      - req_011CQerJyXN7SjWKVmi82fPt
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 957f99f97a2af0e0-LAX
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01UzW3XCGJobCxEBF1EmJgJJ","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2588,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":45,"service_tier":"standard"}}'
  recorded_at: Mon, 30 Jun 2025 18:07:10 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"data.loan_file.cannot_transition_state\":{\"key\":\"data.loan_file.cannot_transition_state\",\"path\":[\"loan_file\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"cannot_transition_state\",\"message\":\"Cannot
        perform deny transition for loan file 1 from needs_review. Expected state
        to be one of: [:in_review]. Did you forget to start the review?\",\"context\":{\"loan_file_id\":1,\"current_state\":\"needs_review\",\"required_states\":[\"in_review\"],\"attempted_transition\":\"deny\"},\"is_fatal\":false}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: Checks each LoanFile needing review against all requirements in its CreditPolicy.
        If any requirement is not satisfied, it will be denied. Otherwise, approved.
        Accomplish this goal.\n\nYour response should match the following JSON schema:
        \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Mon, 30 Jun 2025 18:07:14 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '38000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-30T18:07:16Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-30T18:07:14Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-30T18:07:10Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '46000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-30T18:07:14Z'
      Request-Id:
      - req_011CQerKBoYtVjHH85jsgxeD
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 957f9a0b99dc2ecc-LAX
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01EzGS8BsbMAngy1kzarPmuD","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":3084,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":34,"service_tier":"standard"}}'
  recorded_at: Mon, 30 Jun 2025 18:07:14 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"data.loan_file.cannot_transition_state\":{\"key\":\"data.loan_file.cannot_transition_state\",\"path\":[\"loan_file\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"cannot_transition_state\",\"message\":\"Cannot
        perform deny transition for loan file 1 from needs_review. Expected state
        to be one of: [:in_review]. Did you forget to start the review?\",\"context\":{\"loan_file_id\":1,\"current_state\":\"needs_review\",\"required_states\":[\"in_review\"],\"attempted_transition\":\"deny\"},\"is_fatal\":false}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: Checks each LoanFile needing review against all requirements in its CreditPolicy.
        If any requirement is not satisfied, it will be denied. Otherwise, approved.
        Accomplish this goal.\n\nYour response should match the following JSON schema:
        \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Mon, 30 Jun 2025 18:07:25 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '39000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-30T18:07:26Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-30T18:07:25Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-30T18:07:22Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '47000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-30T18:07:25Z'
      Request-Id:
      - req_011CQerL1na6wU4m5pnb6hnP
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 957f9a290c505269-LAX
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01Nof5CbK1bwVXUwZ21p3Wxr","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":3233,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":52,"service_tier":"standard"}}'
  recorded_at: Mon, 30 Jun 2025 18:07:25 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: Checks each LoanFile needing review against all requirements in its CreditPolicy.
        If any requirement is not satisfied, it will be denied. Otherwise, approved.
        Accomplish this goal.\n\nYour response should match the following JSON schema:
        \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Mon, 30 Jun 2025 18:07:33 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '38000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-30T18:07:35Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-30T18:07:33Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-30T18:07:30Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '46000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-30T18:07:33Z'
      Request-Id:
      - req_011CQerLdyBb9prmChKUSdWA
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 957f9a70ef0a5287-LAX
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_012TVmmV7AoRmXudh9EiDQbm","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":3230,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":30,"service_tier":"standard"}}'
  recorded_at: Mon, 30 Jun 2025 18:07:33 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: Checks each LoanFile needing review against all requirements in its CreditPolicy.
        If any requirement is not satisfied, it will be denied. Otherwise, approved.
        Accomplish this goal.\n\nYour response should match the following JSON schema:
        \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Mon, 30 Jun 2025 18:07:38 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '38000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-30T18:07:40Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-30T18:07:38Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-30T18:07:35Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '46000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-30T18:07:38Z'
      Request-Id:
      - req_011CQerLySTuLcLQNqdfLuGm
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 957f9aa23875cdfb-LAX
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01S1XNJcqF1MRLxBi2dLMjX9","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":3377,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":31,"service_tier":"standard"}}'
  recorded_at: Mon, 30 Jun 2025 18:07:38 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"institution\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":2}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: Checks each LoanFile needing review against all requirements in its CreditPolicy.
        If any requirement is not satisfied, it will be denied. Otherwise, approved.
        Accomplish this goal.\n\nYour response should match the following JSON schema:
        \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Mon, 30 Jun 2025 18:07:41 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '37000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-30T18:07:45Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-30T18:07:41Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-30T18:07:38Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '45000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-30T18:07:41Z'
      Request-Id:
      - req_011CQerMFpheUbTbViRnT6Kc
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 957f9abafb21d7cc-LAX
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_013VuYA88eGQSDXYB4DrtSdL","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":3456,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":34,"service_tier":"standard"}}'
  recorded_at: Mon, 30 Jun 2025 18:07:41 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"institution\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: Checks each LoanFile needing review against all requirements in its CreditPolicy.
        If any requirement is not satisfied, it will be denied. Otherwise, approved.
        Accomplish this goal.\n\nYour response should match the following JSON schema:
        \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Mon, 30 Jun 2025 18:07:46 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '36000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-30T18:07:50Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-30T18:07:46Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-30T18:07:42Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '44000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-30T18:07:46Z'
      Request-Id:
      - req_011CQerMUddiUo2pewC9S7BU
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 957f9acdcf576a2b-LAX
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01SKqf22co2dXbEur8xMErAX","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":3607,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":55,"service_tier":"standard"}}'
  recorded_at: Mon, 30 Jun 2025 18:07:46 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"institution\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: Checks each LoanFile needing review against all requirements in its CreditPolicy.
        If any requirement is not satisfied, it will be denied. Otherwise, approved.
        Accomplish this goal.\n\nYour response should match the following JSON schema:
        \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Mon, 30 Jun 2025 18:07:50 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '36000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-30T18:07:56Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-30T18:07:50Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-30T18:07:47Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '44000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-30T18:07:50Z'
      Request-Id:
      - req_011CQerMsEgEtLLyd4Lg2HvT
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 957f9aeeaa0e7d27-LAX
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01FqJ64gPLPmtb13wnZJd8Nj","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":3811,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":30,"service_tier":"standard"}}'
  recorded_at: Mon, 30 Jun 2025 18:07:50 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"institution\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"id\":3}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: Checks each LoanFile needing review against all requirements in its CreditPolicy.
        If any requirement is not satisfied, it will be denied. Otherwise, approved.
        Accomplish this goal.\n\nYour response should match the following JSON schema:
        \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Mon, 30 Jun 2025 18:07:59 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '37000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-30T18:08:02Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-30T18:07:59Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-30T18:07:51Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '45000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-30T18:07:59Z'
      Request-Id:
      - req_011CQerNCVZLS87vroq6YNVe
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 957f9b096dbddb92-LAX
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01MsewHkZUnupCeV2LXLNwqr","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":3}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":3958,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":31,"service_tier":"standard"}}'
  recorded_at: Mon, 30 Jun 2025 18:07:59 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"institution\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"id\":3}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":3,\"institution\":\"Bank
        C\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":1}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: Checks each LoanFile needing review against all requirements in its CreditPolicy.
        If any requirement is not satisfied, it will be denied. Otherwise, approved.
        Accomplish this goal.\n\nYour response should match the following JSON schema:
        \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Mon, 30 Jun 2025 18:08:05 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '37000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-30T18:08:08Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-30T18:08:05Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-30T18:08:02Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '45000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-30T18:08:05Z'
      Request-Id:
      - req_011CQerNzYF6qtodP1fBB1ZR
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 957f9b42ed1a2ad8-LAX
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01M9uBiCdLPLGYVm6TmxN1ma","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":3}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":4037,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":34,"service_tier":"standard"}}'
  recorded_at: Mon, 30 Jun 2025 18:08:05 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"institution\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"id\":3}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":3,\"institution\":\"Bank
        C\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":3,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: Checks each LoanFile needing review against all requirements in its CreditPolicy.
        If any requirement is not satisfied, it will be denied. Otherwise, approved.
        Accomplish this goal.\n\nYour response should match the following JSON schema:
        \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Mon, 30 Jun 2025 18:08:14 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '38000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-30T18:08:14Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-30T18:08:14Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-30T18:08:08Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '46000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-30T18:08:14Z'
      Request-Id:
      - req_011CQerPSFpJ2p1CFiYi7rhs
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 957f9b666cdb0926-LAX
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_017LXRrKY8a8yvaQqroe7YjW","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":4188,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":43,"service_tier":"standard"}}'
  recorded_at: Mon, 30 Jun 2025 18:08:14 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"institution\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"id\":3}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":3,\"institution\":\"Bank
        C\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":3,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: Checks each LoanFile needing review against all requirements in its CreditPolicy.
        If any requirement is not satisfied, it will be denied. Otherwise, approved.
        Accomplish this goal.\n\nYour response should match the following JSON schema:
        \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Mon, 30 Jun 2025 18:08:23 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '38000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-30T18:08:23Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-30T18:08:23Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-30T18:08:16Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '46000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-30T18:08:23Z'
      Request-Id:
      - req_011CQerPzJtG9zEXCnGyipJi
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 957f9ba1da4c2f44-LAX
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01VjtB1L2E9YJPEsbUQsWJBe","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"inputs\":{\"loan_file\":3,\"credit_score_used\":750}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":4698,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":40,"service_tier":"standard"}}'
  recorded_at: Mon, 30 Jun 2025 18:08:24 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"institution\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"id\":3}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":3,\"institution\":\"Bank
        C\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":3,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"inputs\":{\"loan_file\":3,\"credit_score_used\":750}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":3,\"state\":\"drafting_docs\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"underwriter_decision\":{\"decision\":\"approved\",\"credit_score_used\":750}}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: Checks each LoanFile needing review against all requirements in its CreditPolicy.
        If any requirement is not satisfied, it will be denied. Otherwise, approved.
        Accomplish this goal.\n\nYour response should match the following JSON schema:
        \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Mon, 30 Jun 2025 18:08:28 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '37000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-30T18:08:32Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-30T18:08:28Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-30T18:08:25Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '45000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-30T18:08:28Z'
      Request-Id:
      - req_011CQerQfQN8uazrmNHuadVv
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 957f9bdb882c7c2a-LAX
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01JSFs1MNwDX2zaeJzXLjUqF","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":4875,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":30,"service_tier":"standard"}}'
  recorded_at: Mon, 30 Jun 2025 18:08:28 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"institution\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"id\":3}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":3,\"institution\":\"Bank
        C\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":3,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"inputs\":{\"loan_file\":3,\"credit_score_used\":750}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":3,\"state\":\"drafting_docs\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"underwriter_decision\":{\"decision\":\"approved\",\"credit_score_used\":750}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":null}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: Checks each LoanFile needing review against all requirements in its CreditPolicy.
        If any requirement is not satisfied, it will be denied. Otherwise, approved.
        Accomplish this goal.\n\nYour response should match the following JSON schema:
        \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Mon, 30 Jun 2025 18:08:33 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '35000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-30T18:08:39Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-30T18:08:33Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-30T18:08:30Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '43000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-30T18:08:33Z'
      Request-Id:
      - req_011CQerR1FxnDG8LtJm4EaYa
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 957f9bf8ac267c24-LAX
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01ME9z6YFy6nz18e5A34t7JS","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":4917,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":42,"service_tier":"standard"}}'
  recorded_at: Mon, 30 Jun 2025 18:08:33 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"institution\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"id\":3}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":3,\"institution\":\"Bank
        C\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":3,\"state\":\"in_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"inputs\":{\"loan_file\":3,\"credit_score_used\":750}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":3,\"state\":\"drafting_docs\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"underwriter_decision\":{\"decision\":\"approved\",\"credit_score_used\":750}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"data.cannot_cast\":{\"key\":\"data.cannot_cast\",\"path\":[],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"cannot_cast\",\"message\":\"Cannot
        cast nil to an attributes. Expected it to be a an array of pairs, or be a
        hash with symbolizable keys\",\"context\":{\"cast_to\":{\"type\":\"attributes\",\"element_type_declarations\":{\"result\":{\"type\":\"attributes\",\"element_type_declarations\":{\"approved_count\":{\"type\":\"integer\"},\"denied_count\":{\"type\":\"integer\"}},\"required\":[\"approved_count\",\"denied_count\"]},\"message_to_user\":{\"description\":\"Message
        to the user about what was done\",\"type\":\"string\"}},\"required\":[\"message_to_user\",\"result\"]},\"value\":null},\"is_fatal\":true}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\",\"description\":\"Notifies
        the user that the current goal has been accomplished and returns a final result
        formatted according to the result schema and a message to the user. The user
        might issue a new goal.\",\"inputs_type\":{\"type\":\"object\",\"required\":[\"message_to_user\",\"result\"],\"properties\":{\"result\":{\"type\":\"object\",\"required\":[\"approved_count\",\"denied_count\"],\"properties\":{\"approved_count\":{\"type\":\"number\"},\"denied_count\":{\"type\":\"number\"}}},\"message_to_user\":{\"type\":\"string\",\"description\":\"Message
        to the user about what was done\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"message_to_user\",\"result\"],\"properties\":{\"result\":{\"type\":\"object\",\"required\":[\"approved_count\",\"denied_count\"],\"properties\":{\"approved_count\":{\"type\":\"number\"},\"denied_count\":{\"type\":\"number\"}}},\"message_to_user\":{\"type\":\"string\",\"description\":\"Message
        to the user about what was done\"}}}}}"}],"temperature":0.0,"system":"You
        are the implementation of a command called Foobara::Agent::DetermineNextCommandNameAndInputs
        which has the following description:\n\nReturns the name of the next command
        to run and its inputs given the progress  towards accomplishing the current
        goal. If the goal has been accomplished it will choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command.\n\nYou are working towards accomplishing the following goal:\n\nYou
        are an agent backed command named ReviewAllLoanFilesNeedingReview. Your goal
        is: Review all loan files needing review. If helpful, the command description
        is: Checks each LoanFile needing review against all requirements in its CreditPolicy.
        If any requirement is not satisfied, it will be denied. Otherwise, approved.
        Accomplish this goal.\n\nYour response should match the following JSON schema:
        \n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        can get more details about the result schema for a specific command by choosing
        the DescribeCommand command. You will reply with nothing more than the JSON
        you''ve generated so that the calling code can successfully parse your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Mon, 30 Jun 2025 18:08:40 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '40000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '33000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-06-30T18:08:48Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '8000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-06-30T18:08:41Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '1000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-06-30T18:08:35Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '48000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '41000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-06-30T18:08:41Z'
      Request-Id:
      - req_011CQerRQbQpTAGrEa6FEM7C
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 957f9c18cde4135e-LAX
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01GbKJoQr9KK6gag1pVsFx3Z","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReviewAgent::NotifyUserThatCurrentGoalHasBeenAccomplished\",\"inputs\":{\"message_to_user\":\"I
        have completed reviewing all loan files that needed review. Out of 3 loan
        files reviewed:\\n- 1 was approved (Fumiko''s loan file met all requirements
        for Bank C)\\n- 2 were denied (Barbara''s loan file had insufficient credit
        score for Bank A, and Basil''s loan file had insufficient pay stubs for Bank
        B)\",\"result\":{\"approved_count\":1,\"denied_count\":2}}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":5489,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":145,"service_tier":"standard"}}'
  recorded_at: Mon, 30 Jun 2025 18:08:40 GMT
recorded_with: VCR 6.3.1
