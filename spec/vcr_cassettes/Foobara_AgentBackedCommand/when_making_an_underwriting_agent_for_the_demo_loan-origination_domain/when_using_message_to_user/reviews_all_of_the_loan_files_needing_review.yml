---
http_interactions:
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-3-7-sonnet-20250219","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review all loan files needing review\n\nYour behavior has been described to
        the person or agent that chose to run you as: Checks each LoanFile needing
        review against all requirements in its CreditPolicy. If any requirement is
        not satisfied, it will be denied. Otherwise, approved\n\nYou will answer with
        the name of the next command to run and, if needed, its inputs. Choose whichever
        command is best to make progress towards accomplishing the current goal based
        on the progress made so far. If the goal has been accomplished then choose
        the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you are stuck
        either due to errors or because you do not have the command you need to accomplish
        the goal, then choose GiveUp.\n\nYou can get more details about the inputs
        and result schemas for a specific command by choosing the DescribeCommand
        command.\n\nYour result type is described by the following JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:29:50 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:29:49Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:29:50Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:29:49Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '112000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '112000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:29:49Z'
      Request-Id:
      - req_011CRQao8HJjiZoEfpkuM75d
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963dee9e2c47ebed-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01KtYU5eXXYQxxWzDymdemff","type":"message","role":"assistant","model":"claude-3-7-sonnet-20250219","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":868,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":50,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:29:50 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-3-7-sonnet-20250219","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}}}}"}],"temperature":0.0,"system":"You are part of an agent implementation.
        Your task is to decide which command to run next.\n\nYou are working towards
        accomplishing the following goal: Review all loan files needing review\n\nYour
        behavior has been described to the person or agent that chose to run you as:
        Checks each LoanFile needing review against all requirements in its CreditPolicy.
        If any requirement is not satisfied, it will be denied. Otherwise, approved\n\nYou
        will answer with the name of the next command to run and, if needed, its inputs.
        Choose whichever command is best to make progress towards accomplishing the
        current goal based on the progress made so far. If the goal has been accomplished
        then choose the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you
        are stuck either due to errors or because you do not have the command you
        need to accomplish the goal, then choose GiveUp.\n\nYou can get more details
        about the inputs and result schemas for a specific command by choosing the
        DescribeCommand command.\n\nYour result type is described by the following
        JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:29:58 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:29:58Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:29:58Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:29:57Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '112000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '112000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:29:58Z'
      Request-Id:
      - req_011CRQaom1f18uPcF5321esr
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963deed3cd1aeb2a-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01Sk2W74dMaz6VguyE91VN12","type":"message","role":"assistant","model":"claude-3-7-sonnet-20250219","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":1365,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":30,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:29:58 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-3-7-sonnet-20250219","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review all loan files needing review\n\nYour behavior has been described to
        the person or agent that chose to run you as: Checks each LoanFile needing
        review against all requirements in its CreditPolicy. If any requirement is
        not satisfied, it will be denied. Otherwise, approved\n\nYou will answer with
        the name of the next command to run and, if needed, its inputs. Choose whichever
        command is best to make progress towards accomplishing the current goal based
        on the progress made so far. If the goal has been accomplished then choose
        the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you are stuck
        either due to errors or because you do not have the command you need to accomplish
        the goal, then choose GiveUp.\n\nYou can get more details about the inputs
        and result schemas for a specific command by choosing the DescribeCommand
        command.\n\nYour result type is described by the following JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:30:00 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:30:00Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:30:00Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:29:59Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '112000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '112000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:30:00Z'
      Request-Id:
      - req_011CRQaorMsKuujAHRCbN2CB
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963deedbaa6fed3c-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01D1PT3JNBHXav7TTYrTE2gH","type":"message","role":"assistant","model":"claude-3-7-sonnet-20250219","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":1510,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":42,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:30:00 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-3-7-sonnet-20250219","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"}],"temperature":0.0,"system":"You are part of
        an agent implementation. Your task is to decide which command to run next.\n\nYou
        are working towards accomplishing the following goal: Review all loan files
        needing review\n\nYour behavior has been described to the person or agent
        that chose to run you as: Checks each LoanFile needing review against all
        requirements in its CreditPolicy. If any requirement is not satisfied, it
        will be denied. Otherwise, approved\n\nYou will answer with the name of the
        next command to run and, if needed, its inputs. Choose whichever command is
        best to make progress towards accomplishing the current goal based on the
        progress made so far. If the goal has been accomplished then choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command. If you are stuck either due to errors or because you do not have
        the command you need to accomplish the goal, then choose GiveUp.\n\nYou can
        get more details about the inputs and result schemas for a specific command
        by choosing the DescribeCommand command.\n\nYour result type is described
        by the following JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:30:01 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '79000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:30:01Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:30:01Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:30:00Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '112000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '111000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:30:01Z'
      Request-Id:
      - req_011CRQaoy4ChjZ4ssNfyJENz
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963deee55a20cedd-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_011ttU1dboMRxtsVJEcmqyzx","type":"message","role":"assistant","model":"claude-3-7-sonnet-20250219","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":1796,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":31,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:30:01 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-3-7-sonnet-20250219","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review all loan files needing review\n\nYour behavior has been described to
        the person or agent that chose to run you as: Checks each LoanFile needing
        review against all requirements in its CreditPolicy. If any requirement is
        not satisfied, it will be denied. Otherwise, approved\n\nYou will answer with
        the name of the next command to run and, if needed, its inputs. Choose whichever
        command is best to make progress towards accomplishing the current goal based
        on the progress made so far. If the goal has been accomplished then choose
        the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you are stuck
        either due to errors or because you do not have the command you need to accomplish
        the goal, then choose GiveUp.\n\nYou can get more details about the inputs
        and result schemas for a specific command by choosing the DescribeCommand
        command.\n\nYour result type is described by the following JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:30:04 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:30:04Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:30:04Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:30:02Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '112000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '112000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:30:04Z'
      Request-Id:
      - req_011CRQap4pirbbHDbuGXrYHk
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963deeedcf98ce40-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01W5rBzF3wR2nXgmbsoN594h","type":"message","role":"assistant","model":"claude-3-7-sonnet-20250219","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":1875,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":43,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:30:04 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-3-7-sonnet-20250219","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"}],"temperature":0.0,"system":"You are part of an agent implementation.
        Your task is to decide which command to run next.\n\nYou are working towards
        accomplishing the following goal: Review all loan files needing review\n\nYour
        behavior has been described to the person or agent that chose to run you as:
        Checks each LoanFile needing review against all requirements in its CreditPolicy.
        If any requirement is not satisfied, it will be denied. Otherwise, approved\n\nYou
        will answer with the name of the next command to run and, if needed, its inputs.
        Choose whichever command is best to make progress towards accomplishing the
        current goal based on the progress made so far. If the goal has been accomplished
        then choose the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you
        are stuck either due to errors or because you do not have the command you
        need to accomplish the goal, then choose GiveUp.\n\nYou can get more details
        about the inputs and result schemas for a specific command by choosing the
        DescribeCommand command.\n\nYour result type is described by the following
        JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:30:06 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '79000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:30:06Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:30:06Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:30:05Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '112000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '111000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:30:06Z'
      Request-Id:
      - req_011CRQapJ7vDqaRif5prGN7E
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963def014a54ebe3-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01FV8znjz6aXxLqvMXZupjTp","type":"message","role":"assistant","model":"claude-3-7-sonnet-20250219","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2052,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":52,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:30:06 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-3-7-sonnet-20250219","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"data.loan_file.cannot_transition_state\":{\"key\":\"data.loan_file.cannot_transition_state\",\"path\":[\"loan_file\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"cannot_transition_state\",\"message\":\"Cannot
        perform deny transition for loan file 1 from needs_review. Expected state
        to be one of: [:in_review]. Did you forget to start the review?\",\"context\":{\"loan_file_id\":1,\"current_state\":\"needs_review\",\"required_states\":[\"in_review\"],\"attempted_transition\":\"deny\"},\"is_fatal\":false}}}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review all loan files needing review\n\nYour behavior has been described to
        the person or agent that chose to run you as: Checks each LoanFile needing
        review against all requirements in its CreditPolicy. If any requirement is
        not satisfied, it will be denied. Otherwise, approved\n\nYou will answer with
        the name of the next command to run and, if needed, its inputs. Choose whichever
        command is best to make progress towards accomplishing the current goal based
        on the progress made so far. If the goal has been accomplished then choose
        the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you are stuck
        either due to errors or because you do not have the command you need to accomplish
        the goal, then choose GiveUp.\n\nYou can get more details about the inputs
        and result schemas for a specific command by choosing the DescribeCommand
        command.\n\nYour result type is described by the following JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:30:07 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '78000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:30:08Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:30:07Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:30:06Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '112000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '110000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:30:07Z'
      Request-Id:
      - req_011CRQapQqVA8NNerqXiyMHE
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963def0b3fcbcf17-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01RUN853DBLwUHQBV4eUz4aa","type":"message","role":"assistant","model":"claude-3-7-sonnet-20250219","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2251,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":45,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:30:07 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-3-7-sonnet-20250219","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"data.loan_file.cannot_transition_state\":{\"key\":\"data.loan_file.cannot_transition_state\",\"path\":[\"loan_file\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"cannot_transition_state\",\"message\":\"Cannot
        perform deny transition for loan file 1 from needs_review. Expected state
        to be one of: [:in_review]. Did you forget to start the review?\",\"context\":{\"loan_file_id\":1,\"current_state\":\"needs_review\",\"required_states\":[\"in_review\"],\"attempted_transition\":\"deny\"},\"is_fatal\":false}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"}],"temperature":0.0,"system":"You are part of an agent implementation.
        Your task is to decide which command to run next.\n\nYou are working towards
        accomplishing the following goal: Review all loan files needing review\n\nYour
        behavior has been described to the person or agent that chose to run you as:
        Checks each LoanFile needing review against all requirements in its CreditPolicy.
        If any requirement is not satisfied, it will be denied. Otherwise, approved\n\nYou
        will answer with the name of the next command to run and, if needed, its inputs.
        Choose whichever command is best to make progress towards accomplishing the
        current goal based on the progress made so far. If the goal has been accomplished
        then choose the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you
        are stuck either due to errors or because you do not have the command you
        need to accomplish the goal, then choose GiveUp.\n\nYou can get more details
        about the inputs and result schemas for a specific command by choosing the
        DescribeCommand command.\n\nYour result type is described by the following
        JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:30:09 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '78000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:30:10Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:30:09Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:30:08Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '112000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '110000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:30:09Z'
      Request-Id:
      - req_011CRQapXDTxC2PqeTdLzxMC
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963def146ef83ad4-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01WmQqQ7V7SF9b63Wzng2PVS","type":"message","role":"assistant","model":"claude-3-7-sonnet-20250219","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2374,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":34,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:30:09 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-3-7-sonnet-20250219","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"data.loan_file.cannot_transition_state\":{\"key\":\"data.loan_file.cannot_transition_state\",\"path\":[\"loan_file\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"cannot_transition_state\",\"message\":\"Cannot
        perform deny transition for loan file 1 from needs_review. Expected state
        to be one of: [:in_review]. Did you forget to start the review?\",\"context\":{\"loan_file_id\":1,\"current_state\":\"needs_review\",\"required_states\":[\"in_review\"],\"attempted_transition\":\"deny\"},\"is_fatal\":false}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review all loan files needing review\n\nYour behavior has been described to
        the person or agent that chose to run you as: Checks each LoanFile needing
        review against all requirements in its CreditPolicy. If any requirement is
        not satisfied, it will be denied. Otherwise, approved\n\nYou will answer with
        the name of the next command to run and, if needed, its inputs. Choose whichever
        command is best to make progress towards accomplishing the current goal based
        on the progress made so far. If the goal has been accomplished then choose
        the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you are stuck
        either due to errors or because you do not have the command you need to accomplish
        the goal, then choose GiveUp.\n\nYou can get more details about the inputs
        and result schemas for a specific command by choosing the DescribeCommand
        command.\n\nYour result type is described by the following JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:30:10 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '78000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:30:11Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:30:10Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:30:09Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '112000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '110000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:30:10Z'
      Request-Id:
      - req_011CRQapdor2pCQikjKs3mAd
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963def1e1ea92511-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01V5hUPUipUfNpSVSrAdLq1j","type":"message","role":"assistant","model":"claude-3-7-sonnet-20250219","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2420,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":52,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:30:10 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-3-7-sonnet-20250219","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review all loan files needing review\n\nYour behavior has been described to
        the person or agent that chose to run you as: Checks each LoanFile needing
        review against all requirements in its CreditPolicy. If any requirement is
        not satisfied, it will be denied. Otherwise, approved\n\nYou will answer with
        the name of the next command to run and, if needed, its inputs. Choose whichever
        command is best to make progress towards accomplishing the current goal based
        on the progress made so far. If the goal has been accomplished then choose
        the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you are stuck
        either due to errors or because you do not have the command you need to accomplish
        the goal, then choose GiveUp.\n\nYou can get more details about the inputs
        and result schemas for a specific command by choosing the DescribeCommand
        command.\n\nYour result type is described by the following JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:30:11 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '77000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:30:13Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:30:11Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:30:11Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '112000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '109000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:30:11Z'
      Request-Id:
      - req_011CRQapk29zgCUeKh89TEpR
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963def272f37ed3c-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01CbJfgN8TDFBraz426TQ5bD","type":"message","role":"assistant","model":"claude-3-7-sonnet-20250219","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2285,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":30,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:30:12 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-3-7-sonnet-20250219","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review all loan files needing review\n\nYour behavior has been described to
        the person or agent that chose to run you as: Checks each LoanFile needing
        review against all requirements in its CreditPolicy. If any requirement is
        not satisfied, it will be denied. Otherwise, approved\n\nYou will answer with
        the name of the next command to run and, if needed, its inputs. Choose whichever
        command is best to make progress towards accomplishing the current goal based
        on the progress made so far. If the goal has been accomplished then choose
        the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you are stuck
        either due to errors or because you do not have the command you need to accomplish
        the goal, then choose GiveUp.\n\nYou can get more details about the inputs
        and result schemas for a specific command by choosing the DescribeCommand
        command.\n\nYour result type is described by the following JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:30:13 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '77000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:30:15Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:30:13Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:30:12Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '112000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '109000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:30:13Z'
      Request-Id:
      - req_011CRQapqPrtc7ELAQmHoYzP
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963def2f0f85aaaf-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01MNrbHhpveDNGVMZV71FaVe","type":"message","role":"assistant","model":"claude-3-7-sonnet-20250219","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2432,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":31,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:30:13 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-3-7-sonnet-20250219","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"institution\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":2}}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review all loan files needing review\n\nYour behavior has been described to
        the person or agent that chose to run you as: Checks each LoanFile needing
        review against all requirements in its CreditPolicy. If any requirement is
        not satisfied, it will be denied. Otherwise, approved\n\nYou will answer with
        the name of the next command to run and, if needed, its inputs. Choose whichever
        command is best to make progress towards accomplishing the current goal based
        on the progress made so far. If the goal has been accomplished then choose
        the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you are stuck
        either due to errors or because you do not have the command you need to accomplish
        the goal, then choose GiveUp.\n\nYou can get more details about the inputs
        and result schemas for a specific command by choosing the DescribeCommand
        command.\n\nYour result type is described by the following JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:30:15 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '77000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:30:17Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:30:15Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:30:13Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '112000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '109000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:30:15Z'
      Request-Id:
      - req_011CRQapvkZzUsR6S1JWjJUK
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963def36ee2935d6-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_013sjWTTrQvprTZ6yGh27Jvq","type":"message","role":"assistant","model":"claude-3-7-sonnet-20250219","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2511,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":34,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:30:15 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-3-7-sonnet-20250219","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"institution\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review all loan files needing review\n\nYour behavior has been described to
        the person or agent that chose to run you as: Checks each LoanFile needing
        review against all requirements in its CreditPolicy. If any requirement is
        not satisfied, it will be denied. Otherwise, approved\n\nYou will answer with
        the name of the next command to run and, if needed, its inputs. Choose whichever
        command is best to make progress towards accomplishing the current goal based
        on the progress made so far. If the goal has been accomplished then choose
        the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you are stuck
        either due to errors or because you do not have the command you need to accomplish
        the goal, then choose GiveUp.\n\nYou can get more details about the inputs
        and result schemas for a specific command by choosing the DescribeCommand
        command.\n\nYour result type is described by the following JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:30:16 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '76000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:30:19Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:30:16Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:30:15Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '112000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '108000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:30:16Z'
      Request-Id:
      - req_011CRQaq4UuWkdfi6EGrwWdM
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963def422cdd67b2-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01YAyga5K4aQp6hpEL9TF9Dq","type":"message","role":"assistant","model":"claude-3-7-sonnet-20250219","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2557,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":55,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:30:16 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-3-7-sonnet-20250219","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"institution\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review all loan files needing review\n\nYour behavior has been described to
        the person or agent that chose to run you as: Checks each LoanFile needing
        review against all requirements in its CreditPolicy. If any requirement is
        not satisfied, it will be denied. Otherwise, approved\n\nYou will answer with
        the name of the next command to run and, if needed, its inputs. Choose whichever
        command is best to make progress towards accomplishing the current goal based
        on the progress made so far. If the goal has been accomplished then choose
        the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you are stuck
        either due to errors or because you do not have the command you need to accomplish
        the goal, then choose GiveUp.\n\nYou can get more details about the inputs
        and result schemas for a specific command by choosing the DescribeCommand
        command.\n\nYour result type is described by the following JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:30:18 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '76000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:30:21Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:30:18Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:30:17Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '112000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '108000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:30:18Z'
      Request-Id:
      - req_011CRQaqBhEpKYwoULWumY22
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963def4cad61ce40-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01X1TCUQauF8p61NHXa4iiKo","type":"message","role":"assistant","model":"claude-3-7-sonnet-20250219","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2624,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":30,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:30:18 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-3-7-sonnet-20250219","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"institution\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"id\":3}}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review all loan files needing review\n\nYour behavior has been described to
        the person or agent that chose to run you as: Checks each LoanFile needing
        review against all requirements in its CreditPolicy. If any requirement is
        not satisfied, it will be denied. Otherwise, approved\n\nYou will answer with
        the name of the next command to run and, if needed, its inputs. Choose whichever
        command is best to make progress towards accomplishing the current goal based
        on the progress made so far. If the goal has been accomplished then choose
        the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you are stuck
        either due to errors or because you do not have the command you need to accomplish
        the goal, then choose GiveUp.\n\nYou can get more details about the inputs
        and result schemas for a specific command by choosing the DescribeCommand
        command.\n\nYour result type is described by the following JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:30:20 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '76000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:30:23Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:30:20Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:30:19Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '112000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '108000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:30:20Z'
      Request-Id:
      - req_011CRQaqLnBtKEEkq9K7AYMu
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963def59ecfafa1a-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01Q1z7pngZAzr98G1pA53841","type":"message","role":"assistant","model":"claude-3-7-sonnet-20250219","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":3}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2771,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":31,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:30:20 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-3-7-sonnet-20250219","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"institution\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"id\":3}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":3,\"institution\":\"Bank
        C\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":1}}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review all loan files needing review\n\nYour behavior has been described to
        the person or agent that chose to run you as: Checks each LoanFile needing
        review against all requirements in its CreditPolicy. If any requirement is
        not satisfied, it will be denied. Otherwise, approved\n\nYou will answer with
        the name of the next command to run and, if needed, its inputs. Choose whichever
        command is best to make progress towards accomplishing the current goal based
        on the progress made so far. If the goal has been accomplished then choose
        the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you are stuck
        either due to errors or because you do not have the command you need to accomplish
        the goal, then choose GiveUp.\n\nYou can get more details about the inputs
        and result schemas for a specific command by choosing the DescribeCommand
        command.\n\nYour result type is described by the following JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:30:22 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '75000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:30:25Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:30:22Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:30:20Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '112000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '107000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:30:22Z'
      Request-Id:
      - req_011CRQaqTw3vGhsf25Z7Pdnp
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963def64480215ba-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01HfE7am4KHT9d9DvmKNiz7K","type":"message","role":"assistant","model":"claude-3-7-sonnet-20250219","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":3}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2850,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":34,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:30:22 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-3-7-sonnet-20250219","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"institution\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"id\":3}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":3,\"institution\":\"Bank
        C\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review all loan files needing review\n\nYour behavior has been described to
        the person or agent that chose to run you as: Checks each LoanFile needing
        review against all requirements in its CreditPolicy. If any requirement is
        not satisfied, it will be denied. Otherwise, approved\n\nYou will answer with
        the name of the next command to run and, if needed, its inputs. Choose whichever
        command is best to make progress towards accomplishing the current goal based
        on the progress made so far. If the goal has been accomplished then choose
        the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you are stuck
        either due to errors or because you do not have the command you need to accomplish
        the goal, then choose GiveUp.\n\nYou can get more details about the inputs
        and result schemas for a specific command by choosing the DescribeCommand
        command.\n\nYour result type is described by the following JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:30:23 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '74000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:30:27Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:30:23Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:30:22Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '112000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '106000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:30:23Z'
      Request-Id:
      - req_011CRQaqayiLKMsNchoxGKZK
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963def6ebd1beb25-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01Q6MGvaqUKzyavgxLteoQAN","type":"message","role":"assistant","model":"claude-3-7-sonnet-20250219","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2896,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":43,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:30:23 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-3-7-sonnet-20250219","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"institution\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"id\":3}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":3,\"institution\":\"Bank
        C\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"}],"temperature":0.0,"system":"You are part of an agent implementation.
        Your task is to decide which command to run next.\n\nYou are working towards
        accomplishing the following goal: Review all loan files needing review\n\nYour
        behavior has been described to the person or agent that chose to run you as:
        Checks each LoanFile needing review against all requirements in its CreditPolicy.
        If any requirement is not satisfied, it will be denied. Otherwise, approved\n\nYou
        will answer with the name of the next command to run and, if needed, its inputs.
        Choose whichever command is best to make progress towards accomplishing the
        current goal based on the progress made so far. If the goal has been accomplished
        then choose the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you
        are stuck either due to errors or because you do not have the command you
        need to accomplish the goal, then choose GiveUp.\n\nYou can get more details
        about the inputs and result schemas for a specific command by choosing the
        DescribeCommand command.\n\nYour result type is described by the following
        JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:30:25 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '73000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:30:29Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:30:25Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:30:24Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '112000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '105000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:30:25Z'
      Request-Id:
      - req_011CRQaqhHyGUmBA2KFQENcC
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963def780af1d438-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_012h4pvkEJRhpZmWoqnRcMdw","type":"message","role":"assistant","model":"claude-3-7-sonnet-20250219","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"inputs\":{\"loan_file\":3,\"credit_score_used\":750}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":3033,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":40,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:30:25 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-3-7-sonnet-20250219","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"institution\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"id\":3}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":3,\"institution\":\"Bank
        C\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"inputs\":{\"loan_file\":3,\"credit_score_used\":750}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review all loan files needing review\n\nYour behavior has been described to
        the person or agent that chose to run you as: Checks each LoanFile needing
        review against all requirements in its CreditPolicy. If any requirement is
        not satisfied, it will be denied. Otherwise, approved\n\nYou will answer with
        the name of the next command to run and, if needed, its inputs. Choose whichever
        command is best to make progress towards accomplishing the current goal based
        on the progress made so far. If the goal has been accomplished then choose
        the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you are stuck
        either due to errors or because you do not have the command you need to accomplish
        the goal, then choose GiveUp.\n\nYou can get more details about the inputs
        and result schemas for a specific command by choosing the DescribeCommand
        command.\n\nYour result type is described by the following JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:30:26 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '72000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:30:32Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:30:26Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:30:25Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '112000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '104000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:30:26Z'
      Request-Id:
      - req_011CRQaqoPLe74j7WpeeAh8A
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963def80eabbffb8-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_015GbVu2Aejf6s6raEBCfDhf","type":"message","role":"assistant","model":"claude-3-7-sonnet-20250219","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":3085,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":30,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:30:26 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-3-7-sonnet-20250219","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"institution\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"id\":3}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":3,\"institution\":\"Bank
        C\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"inputs\":{\"loan_file\":3,\"credit_score_used\":750}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":null}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review all loan files needing review\n\nYour behavior has been described to
        the person or agent that chose to run you as: Checks each LoanFile needing
        review against all requirements in its CreditPolicy. If any requirement is
        not satisfied, it will be denied. Otherwise, approved\n\nYou will answer with
        the name of the next command to run and, if needed, its inputs. Choose whichever
        command is best to make progress towards accomplishing the current goal based
        on the progress made so far. If the goal has been accomplished then choose
        the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you are stuck
        either due to errors or because you do not have the command you need to accomplish
        the goal, then choose GiveUp.\n\nYou can get more details about the inputs
        and result schemas for a specific command by choosing the DescribeCommand
        command.\n\nYour result type is described by the following JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:30:28 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '71000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:30:34Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:30:28Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:30:26Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '112000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '103000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:30:28Z'
      Request-Id:
      - req_011CRQaquGoErrxtoEYVRZ4n
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963def897c66175e-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01Vzfxmq2UYKBjJN1rytnLUy","type":"message","role":"assistant","model":"claude-3-7-sonnet-20250219","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\"}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":3127,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":41,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:30:28 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-3-7-sonnet-20250219","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::SubmitApplicationForUnderwriterReview\",\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::FindAllLoanFiles\",\"FoobaraDemo::LoanOrigination::GenerateLoanFilesReport\",\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::StartLoanApplication\",\"FoobaraDemo::LoanOrigination::CreateCreditPolicy\",\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"FoobaraDemo::LoanOrigination::AddCreditScore\",\"FoobaraDemo::LoanOrigination::FindLoanFile\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::AddPayStub\",\"FoobaraDemo::LoanOrigination::Demo::PrepareDemoRecords\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_policy\"],\"properties\":{\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":2,\"institution\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":2}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"id\":3}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindCreditPolicy\",\"inputs\":{\"credit_policy\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"id\":3,\"institution\":\"Bank
        C\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":1}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"inputs\":{\"loan_file\":3,\"credit_score_used\":750}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\",\"description\":\"Notifies
        the user that the current goal has been accomplished and results in a message
        to the user. The user might issue a new goal.\",\"inputs_type\":{\"type\":\"object\",\"required\":[\"message_to_user\"],\"properties\":{\"message_to_user\":{\"type\":\"string\",\"description\":\"Message
        to the user about what was done\"}}}}}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review all loan files needing review\n\nYour behavior has been described to
        the person or agent that chose to run you as: Checks each LoanFile needing
        review against all requirements in its CreditPolicy. If any requirement is
        not satisfied, it will be denied. Otherwise, approved\n\nYou will answer with
        the name of the next command to run and, if needed, its inputs. Choose whichever
        command is best to make progress towards accomplishing the current goal based
        on the progress made so far. If the goal has been accomplished then choose
        the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you are stuck
        either due to errors or because you do not have the command you need to accomplish
        the goal, then choose GiveUp.\n\nYou can get more details about the inputs
        and result schemas for a specific command by choosing the DescribeCommand
        command.\n\nYour result type is described by the following JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:30:31 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '70000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:30:37Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '32000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:30:31Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:30:29Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '112000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '102000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:30:31Z'
      Request-Id:
      - req_011CRQar4jKFobf7XNetvbbW
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963def974c3afad6-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_019SvrRJutcW6WntUzbm79XV","type":"message","role":"assistant","model":"claude-3-7-sonnet-20250219","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\",\"inputs\":{\"message_to_user\":\"I
        have reviewed all loan files that needed review. I processed 3 loan files:\\n1.
        Barbara''s loan file was denied due to low credit score (median score 650,
        minimum required 700)\\n2. Basil''s loan file was denied due to insufficient
        pay stubs (had 1, required 2)\\n3. Fumiko''s loan file was approved (maximum
        score 750, minimum required 700)\"}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":3318,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":142,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:30:31 GMT
recorded_with: VCR 6.3.1
