---
http_interactions:
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-sonnet-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review all loan files needing review\n\nYou will answer with the name of the
        next command to run and, if needed, its inputs. Choose whichever command is
        best to make progress towards accomplishing the current goal based on the
        progress made so far. If the goal has been accomplished then choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command. If you are stuck either due to errors or because you do not have
        the command you need to accomplish the goal, then choose GiveUp.\n\nYou can
        get more details about the inputs and result schemas for a specific command
        by choosing the DescribeCommand command.\n\nYour result type is described
        by the following JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:49:28 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '800000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '800000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:49:28Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '160000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '160000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:49:28Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:49:27Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '960000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '960000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:49:28Z'
      Request-Id:
      - req_011CRQcHxgGv3XNBfp9rfyAS
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963e0b608fc3169e-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_016ZtM2i3AsYFLbFvDCjHHaA","type":"message","role":"assistant","model":"claude-sonnet-4-20250514","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":605,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":50,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:49:28 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-sonnet-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}}}}"}],"temperature":0.0,"system":"You are part of an agent implementation.
        Your task is to decide which command to run next.\n\nYou are working towards
        accomplishing the following goal: Review all loan files needing review\n\nYou
        will answer with the name of the next command to run and, if needed, its inputs.
        Choose whichever command is best to make progress towards accomplishing the
        current goal based on the progress made so far. If the goal has been accomplished
        then choose the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you
        are stuck either due to errors or because you do not have the command you
        need to accomplish the goal, then choose GiveUp.\n\nYou can get more details
        about the inputs and result schemas for a specific command by choosing the
        DescribeCommand command.\n\nYour result type is described by the following
        JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:49:30 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '800000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '800000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:49:29Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '160000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '160000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:49:30Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:49:29Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '960000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '960000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:49:29Z'
      Request-Id:
      - req_011CRQcJ6mh1U1CZXuR8kTxX
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963e0b6c6f09fa7a-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01DSHobyawNr7Jd1xj7p27wT","type":"message","role":"assistant","model":"claude-sonnet-4-20250514","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":1102,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":42,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:49:30 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-sonnet-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"description\":\"Checks
        the LoanFile against all requirements in its CreditPolicy. Denies the LoanFile
        that has any unsatisfied requirements.\",\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}}}}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review all loan files needing review\n\nYou will answer with the name of the
        next command to run and, if needed, its inputs. Choose whichever command is
        best to make progress towards accomplishing the current goal based on the
        progress made so far. If the goal has been accomplished then choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command. If you are stuck either due to errors or because you do not have
        the command you need to accomplish the goal, then choose GiveUp.\n\nYou can
        get more details about the inputs and result schemas for a specific command
        by choosing the DescribeCommand command.\n\nYour result type is described
        by the following JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:49:31 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '800000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '800000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:49:31Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '160000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '160000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:49:31Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:49:30Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '960000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '960000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:49:31Z'
      Request-Id:
      - req_011CRQcJChtNAtwedttKpvYe
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963e0b75096c5850-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01UizCWfeFTB4o9MHQsM9L85","type":"message","role":"assistant","model":"claude-sonnet-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":1337,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":30,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:49:31 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-sonnet-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"description\":\"Checks
        the LoanFile against all requirements in its CreditPolicy. Denies the LoanFile
        that has any unsatisfied requirements.\",\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1}}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review all loan files needing review\n\nYou will answer with the name of the
        next command to run and, if needed, its inputs. Choose whichever command is
        best to make progress towards accomplishing the current goal based on the
        progress made so far. If the goal has been accomplished then choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command. If you are stuck either due to errors or because you do not have
        the command you need to accomplish the goal, then choose GiveUp.\n\nYou can
        get more details about the inputs and result schemas for a specific command
        by choosing the DescribeCommand command.\n\nYour result type is described
        by the following JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:49:33 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '800000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '800000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:49:33Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '160000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '160000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:49:33Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:49:32Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '960000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '960000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:49:33Z'
      Request-Id:
      - req_011CRQcJKn2vy2eobeSjWtbA
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963e0b7f6c36232b-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_019Pt4tRVqj6ycyHaeY8oESR","type":"message","role":"assistant","model":"claude-sonnet-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"inputs\":{\"loan_file\":1}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":1482,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":31,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:49:33 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review loan file\n\nYour behavior has been described to the person or agent
        that chose to run you as: Checks the LoanFile against all requirements in
        its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements.\n\nYour
        inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}}}\n\nYou have been ran with the following inputs:\n\n{\"loan_file\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1},\"id\":1}}\n\nYou
        will answer with the name of the next command to run and, if needed, its inputs.
        Choose whichever command is best to make progress towards accomplishing the
        current goal based on the progress made so far. If the goal has been accomplished
        then choose the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you
        are stuck either due to errors or because you do not have the command you
        need to accomplish the goal, then choose GiveUp.\n\nYou can get more details
        about the inputs and result schemas for a specific command by choosing the
        DescribeCommand command.\n\nYour result type is described by the following
        JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:49:40 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:49:36Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:49:41Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:49:34Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '96000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '96000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:49:36Z'
      Request-Id:
      - req_011CRQcJURgoKv8qeVcQsUxf
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963e0b8c0c21ce8c-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01F6mxxjY63t29LmyCKrbh6L","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"I
        need to review the loan file against the credit policy requirements. Let me
        check what the credit policy requires:\n\n1. Minimum credit score: 700\n2.
        Credit score to use: median\n3. Minimum pay stub count: 1\n\nNow let me analyze
        the loan file:\n- Pay stubs: 1 pay stub provided (meets the minimum requirement
        of 1)\n- Credit scores: 600 (Experian), 650 (Equifax), 750 (TransUnion)\n-
        The median credit score is 650\n\nSince the credit policy requires a minimum
        credit score of 700 and uses the median score for comparison, and the median
        score (650) is less than the required 700, this loan file does not meet the
        credit score requirement.\n\nTherefore, I need to deny the loan file.\n\n{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file_id\":1,\"denied_reasons\":[\"low_credit_score\"]}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":1373,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":226,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:49:41 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"agent\":\"#<Foobara::Agent:0x00007fd7cb24fdd8>\",\"llm_model\":\"claude-opus-4-20250514\",\"pass_aggregates_to_llm\":true}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"runtime.could_not_parse_result_json\":{\"key\":\"runtime.could_not_parse_result_json\",\"path\":[],\"runtime_path\":[],\"category\":\"runtime\",\"symbol\":\"could_not_parse_result_json\",\"message\":\"Could
        not parse result JSON: unexpected token ''I'' at line 1 column 1\",\"context\":{\"raw_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check what the credit policy requires:\\n\\n1. Minimum credit score: 700\\n2.
        Credit score to use: median\\n3. Minimum pay stub count: 1\\n\\nNow let me
        analyze the loan file:\\n- Pay stubs: 1 pay stub provided (meets the minimum
        requirement of 1)\\n- Credit scores: 600 (Experian), 650 (Equifax), 750 (TransUnion)\\n-
        The median credit score is 650\\n\\nSince the credit policy requires a minimum
        credit score of 700 and uses the median score for comparison, and the median
        score (650) is less than the required 700, this loan file does not meet the
        credit score requirement.\\n\\nTherefore, I need to deny the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":1,\\\"denied_reasons\\\":[\\\"low_credit_score\\\"]}}\",\"stripped_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check what the credit policy requires:\\n\\n1. Minimum credit score: 700\\n2.
        Credit score to use: median\\n3. Minimum pay stub count: 1\\n\\nNow let me
        analyze the loan file:\\n- Pay stubs: 1 pay stub provided (meets the minimum
        requirement of 1)\\n- Credit scores: 600 (Experian), 650 (Equifax), 750 (TransUnion)\\n-
        The median credit score is 650\\n\\nSince the credit policy requires a minimum
        credit score of 700 and uses the median score for comparison, and the median
        score (650) is less than the required 700, this loan file does not meet the
        credit score requirement.\\n\\nTherefore, I need to deny the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":1,\\\"denied_reasons\\\":[\\\"low_credit_score\\\"]}}\"},\"is_fatal\":false}}}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review loan file\n\nYour behavior has been described to the person or agent
        that chose to run you as: Checks the LoanFile against all requirements in
        its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements.\n\nYour
        inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}}}\n\nYou have been ran with the following inputs:\n\n{\"loan_file\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1},\"id\":1}}\n\nYou
        will answer with the name of the next command to run and, if needed, its inputs.
        Choose whichever command is best to make progress towards accomplishing the
        current goal based on the progress made so far. If the goal has been accomplished
        then choose the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you
        are stuck either due to errors or because you do not have the command you
        need to accomplish the goal, then choose GiveUp.\n\nYou can get more details
        about the inputs and result schemas for a specific command by choosing the
        DescribeCommand command.\n\nYour result type is described by the following
        JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:49:43 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:49:43Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:49:44Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:49:41Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '96000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '96000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:49:43Z'
      Request-Id:
      - req_011CRQcJznohWdkr9Ab1DrMT
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963e0bb8696467a0-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01ScowwcNXMeDrqgwjvMhEX3","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file_id\":1,\"denied_reasons\":[\"low_credit_score\"]}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2058,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":46,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:49:44 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"agent\":\"#<Foobara::Agent:0x00007fd7cb24fdd8>\",\"llm_model\":\"claude-opus-4-20250514\",\"pass_aggregates_to_llm\":true}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"runtime.could_not_parse_result_json\":{\"key\":\"runtime.could_not_parse_result_json\",\"path\":[],\"runtime_path\":[],\"category\":\"runtime\",\"symbol\":\"could_not_parse_result_json\",\"message\":\"Could
        not parse result JSON: unexpected token ''I'' at line 1 column 1\",\"context\":{\"raw_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check what the credit policy requires:\\n\\n1. Minimum credit score: 700\\n2.
        Credit score to use: median\\n3. Minimum pay stub count: 1\\n\\nNow let me
        analyze the loan file:\\n- Pay stubs: 1 pay stub provided (meets the minimum
        requirement of 1)\\n- Credit scores: 600 (Experian), 650 (Equifax), 750 (TransUnion)\\n-
        The median credit score is 650\\n\\nSince the credit policy requires a minimum
        credit score of 700 and uses the median score for comparison, and the median
        score (650) is less than the required 700, this loan file does not meet the
        credit score requirement.\\n\\nTherefore, I need to deny the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":1,\\\"denied_reasons\\\":[\\\"low_credit_score\\\"]}}\",\"stripped_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check what the credit policy requires:\\n\\n1. Minimum credit score: 700\\n2.
        Credit score to use: median\\n3. Minimum pay stub count: 1\\n\\nNow let me
        analyze the loan file:\\n- Pay stubs: 1 pay stub provided (meets the minimum
        requirement of 1)\\n- Credit scores: 600 (Experian), 650 (Equifax), 750 (TransUnion)\\n-
        The median credit score is 650\\n\\nSince the credit policy requires a minimum
        credit score of 700 and uses the median score for comparison, and the median
        score (650) is less than the required 700, this loan file does not meet the
        credit score requirement.\\n\\nTherefore, I need to deny the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":1,\\\"denied_reasons\\\":[\\\"low_credit_score\\\"]}}\"},\"is_fatal\":false}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"}],"temperature":0.0,"system":"You are part of an agent implementation.
        Your task is to decide which command to run next.\n\nYou are working towards
        accomplishing the following goal: Review loan file\n\nYour behavior has been
        described to the person or agent that chose to run you as: Checks the LoanFile
        against all requirements in its CreditPolicy. Denies the LoanFile that has
        any unsatisfied requirements.\n\nYour inputs to this command have the following
        type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}}}\n\nYou have been ran with the following inputs:\n\n{\"loan_file\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1},\"id\":1}}\n\nYou
        will answer with the name of the next command to run and, if needed, its inputs.
        Choose whichever command is best to make progress towards accomplishing the
        current goal based on the progress made so far. If the goal has been accomplished
        then choose the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you
        are stuck either due to errors or because you do not have the command you
        need to accomplish the goal, then choose GiveUp.\n\nYou can get more details
        about the inputs and result schemas for a specific command by choosing the
        DescribeCommand command.\n\nYour result type is described by the following
        JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:49:46 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:49:45Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:49:46Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:49:44Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '96000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '96000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:49:45Z'
      Request-Id:
      - req_011CRQcKDgSq3znpbHCiBBBp
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963e0bcb4eb7182a-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01VWUK9tqNxEjwJs5WbtbCRx","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2235,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":52,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:49:46 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"agent\":\"#<Foobara::Agent:0x00007fd7cb24fdd8>\",\"llm_model\":\"claude-opus-4-20250514\",\"pass_aggregates_to_llm\":true}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"runtime.could_not_parse_result_json\":{\"key\":\"runtime.could_not_parse_result_json\",\"path\":[],\"runtime_path\":[],\"category\":\"runtime\",\"symbol\":\"could_not_parse_result_json\",\"message\":\"Could
        not parse result JSON: unexpected token ''I'' at line 1 column 1\",\"context\":{\"raw_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check what the credit policy requires:\\n\\n1. Minimum credit score: 700\\n2.
        Credit score to use: median\\n3. Minimum pay stub count: 1\\n\\nNow let me
        analyze the loan file:\\n- Pay stubs: 1 pay stub provided (meets the minimum
        requirement of 1)\\n- Credit scores: 600 (Experian), 650 (Equifax), 750 (TransUnion)\\n-
        The median credit score is 650\\n\\nSince the credit policy requires a minimum
        credit score of 700 and uses the median score for comparison, and the median
        score (650) is less than the required 700, this loan file does not meet the
        credit score requirement.\\n\\nTherefore, I need to deny the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":1,\\\"denied_reasons\\\":[\\\"low_credit_score\\\"]}}\",\"stripped_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check what the credit policy requires:\\n\\n1. Minimum credit score: 700\\n2.
        Credit score to use: median\\n3. Minimum pay stub count: 1\\n\\nNow let me
        analyze the loan file:\\n- Pay stubs: 1 pay stub provided (meets the minimum
        requirement of 1)\\n- Credit scores: 600 (Experian), 650 (Equifax), 750 (TransUnion)\\n-
        The median credit score is 650\\n\\nSince the credit policy requires a minimum
        credit score of 700 and uses the median score for comparison, and the median
        score (650) is less than the required 700, this loan file does not meet the
        credit score requirement.\\n\\nTherefore, I need to deny the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":1,\\\"denied_reasons\\\":[\\\"low_credit_score\\\"]}}\"},\"is_fatal\":false}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"data.loan_file.cannot_transition_state\":{\"key\":\"data.loan_file.cannot_transition_state\",\"path\":[\"loan_file\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"cannot_transition_state\",\"message\":\"Cannot
        perform deny transition for loan file 1 from needs_review. Expected state
        to be one of: [:in_review]. Did you forget to start the review?\",\"context\":{\"loan_file_id\":1,\"current_state\":\"needs_review\",\"required_states\":[\"in_review\"],\"attempted_transition\":\"deny\"},\"is_fatal\":false}}}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review loan file\n\nYour behavior has been described to the person or agent
        that chose to run you as: Checks the LoanFile against all requirements in
        its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements.\n\nYour
        inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}}}\n\nYou have been ran with the following inputs:\n\n{\"loan_file\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1},\"id\":1}}\n\nYou
        will answer with the name of the next command to run and, if needed, its inputs.
        Choose whichever command is best to make progress towards accomplishing the
        current goal based on the progress made so far. If the goal has been accomplished
        then choose the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you
        are stuck either due to errors or because you do not have the command you
        need to accomplish the goal, then choose GiveUp.\n\nYou can get more details
        about the inputs and result schemas for a specific command by choosing the
        DescribeCommand command.\n\nYour result type is described by the following
        JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:49:49 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:49:49Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:49:49Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:49:47Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '96000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '96000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:49:49Z'
      Request-Id:
      - req_011CRQcKRNAGJVtyMDB2Xbmz
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963e0bdc5be717d2-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01UJCffMuUL4hGVuCEkjzx7Y","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2434,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":34,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:49:49 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"agent\":\"#<Foobara::Agent:0x00007fd7cb24fdd8>\",\"llm_model\":\"claude-opus-4-20250514\",\"pass_aggregates_to_llm\":true}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"runtime.could_not_parse_result_json\":{\"key\":\"runtime.could_not_parse_result_json\",\"path\":[],\"runtime_path\":[],\"category\":\"runtime\",\"symbol\":\"could_not_parse_result_json\",\"message\":\"Could
        not parse result JSON: unexpected token ''I'' at line 1 column 1\",\"context\":{\"raw_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check what the credit policy requires:\\n\\n1. Minimum credit score: 700\\n2.
        Credit score to use: median\\n3. Minimum pay stub count: 1\\n\\nNow let me
        analyze the loan file:\\n- Pay stubs: 1 pay stub provided (meets the minimum
        requirement of 1)\\n- Credit scores: 600 (Experian), 650 (Equifax), 750 (TransUnion)\\n-
        The median credit score is 650\\n\\nSince the credit policy requires a minimum
        credit score of 700 and uses the median score for comparison, and the median
        score (650) is less than the required 700, this loan file does not meet the
        credit score requirement.\\n\\nTherefore, I need to deny the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":1,\\\"denied_reasons\\\":[\\\"low_credit_score\\\"]}}\",\"stripped_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check what the credit policy requires:\\n\\n1. Minimum credit score: 700\\n2.
        Credit score to use: median\\n3. Minimum pay stub count: 1\\n\\nNow let me
        analyze the loan file:\\n- Pay stubs: 1 pay stub provided (meets the minimum
        requirement of 1)\\n- Credit scores: 600 (Experian), 650 (Equifax), 750 (TransUnion)\\n-
        The median credit score is 650\\n\\nSince the credit policy requires a minimum
        credit score of 700 and uses the median score for comparison, and the median
        score (650) is less than the required 700, this loan file does not meet the
        credit score requirement.\\n\\nTherefore, I need to deny the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":1,\\\"denied_reasons\\\":[\\\"low_credit_score\\\"]}}\"},\"is_fatal\":false}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"data.loan_file.cannot_transition_state\":{\"key\":\"data.loan_file.cannot_transition_state\",\"path\":[\"loan_file\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"cannot_transition_state\",\"message\":\"Cannot
        perform deny transition for loan file 1 from needs_review. Expected state
        to be one of: [:in_review]. Did you forget to start the review?\",\"context\":{\"loan_file_id\":1,\"current_state\":\"needs_review\",\"required_states\":[\"in_review\"],\"attempted_transition\":\"deny\"},\"is_fatal\":false}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"}],"temperature":0.0,"system":"You are part of an agent implementation.
        Your task is to decide which command to run next.\n\nYou are working towards
        accomplishing the following goal: Review loan file\n\nYour behavior has been
        described to the person or agent that chose to run you as: Checks the LoanFile
        against all requirements in its CreditPolicy. Denies the LoanFile that has
        any unsatisfied requirements.\n\nYour inputs to this command have the following
        type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}}}\n\nYou have been ran with the following inputs:\n\n{\"loan_file\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1},\"id\":1}}\n\nYou
        will answer with the name of the next command to run and, if needed, its inputs.
        Choose whichever command is best to make progress towards accomplishing the
        current goal based on the progress made so far. If the goal has been accomplished
        then choose the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you
        are stuck either due to errors or because you do not have the command you
        need to accomplish the goal, then choose GiveUp.\n\nYou can get more details
        about the inputs and result schemas for a specific command by choosing the
        DescribeCommand command.\n\nYour result type is described by the following
        JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:49:51 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '79000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:49:51Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:49:51Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:49:49Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '96000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '95000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:49:51Z'
      Request-Id:
      - req_011CRQcKdCocsa4vCgbJ9CgW
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963e0bedad77ed3f-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01DyaderUpFpiT8V5qUtd5fv","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2557,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":34,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:49:51 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"agent\":\"#<Foobara::Agent:0x00007fd7cb24fdd8>\",\"llm_model\":\"claude-opus-4-20250514\",\"pass_aggregates_to_llm\":true}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"runtime.could_not_parse_result_json\":{\"key\":\"runtime.could_not_parse_result_json\",\"path\":[],\"runtime_path\":[],\"category\":\"runtime\",\"symbol\":\"could_not_parse_result_json\",\"message\":\"Could
        not parse result JSON: unexpected token ''I'' at line 1 column 1\",\"context\":{\"raw_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check what the credit policy requires:\\n\\n1. Minimum credit score: 700\\n2.
        Credit score to use: median\\n3. Minimum pay stub count: 1\\n\\nNow let me
        analyze the loan file:\\n- Pay stubs: 1 pay stub provided (meets the minimum
        requirement of 1)\\n- Credit scores: 600 (Experian), 650 (Equifax), 750 (TransUnion)\\n-
        The median credit score is 650\\n\\nSince the credit policy requires a minimum
        credit score of 700 and uses the median score for comparison, and the median
        score (650) is less than the required 700, this loan file does not meet the
        credit score requirement.\\n\\nTherefore, I need to deny the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":1,\\\"denied_reasons\\\":[\\\"low_credit_score\\\"]}}\",\"stripped_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check what the credit policy requires:\\n\\n1. Minimum credit score: 700\\n2.
        Credit score to use: median\\n3. Minimum pay stub count: 1\\n\\nNow let me
        analyze the loan file:\\n- Pay stubs: 1 pay stub provided (meets the minimum
        requirement of 1)\\n- Credit scores: 600 (Experian), 650 (Equifax), 750 (TransUnion)\\n-
        The median credit score is 650\\n\\nSince the credit policy requires a minimum
        credit score of 700 and uses the median score for comparison, and the median
        score (650) is less than the required 700, this loan file does not meet the
        credit score requirement.\\n\\nTherefore, I need to deny the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":1,\\\"denied_reasons\\\":[\\\"low_credit_score\\\"]}}\"},\"is_fatal\":false}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"data.loan_file.cannot_transition_state\":{\"key\":\"data.loan_file.cannot_transition_state\",\"path\":[\"loan_file\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"cannot_transition_state\",\"message\":\"Cannot
        perform deny transition for loan file 1 from needs_review. Expected state
        to be one of: [:in_review]. Did you forget to start the review?\",\"context\":{\"loan_file_id\":1,\"current_state\":\"needs_review\",\"required_states\":[\"in_review\"],\"attempted_transition\":\"deny\"},\"is_fatal\":false}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review loan file\n\nYour behavior has been described to the person or agent
        that chose to run you as: Checks the LoanFile against all requirements in
        its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements.\n\nYour
        inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}}}\n\nYou have been ran with the following inputs:\n\n{\"loan_file\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1},\"id\":1}}\n\nYou
        will answer with the name of the next command to run and, if needed, its inputs.
        Choose whichever command is best to make progress towards accomplishing the
        current goal based on the progress made so far. If the goal has been accomplished
        then choose the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you
        are stuck either due to errors or because you do not have the command you
        need to accomplish the goal, then choose GiveUp.\n\nYou can get more details
        about the inputs and result schemas for a specific command by choosing the
        DescribeCommand command.\n\nYour result type is described by the following
        JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:49:55 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:49:54Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:49:55Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:49:52Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '96000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '96000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:49:54Z'
      Request-Id:
      - req_011CRQcKoGY7irMRJWsyasnT
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963e0bfc5ad66896-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_012m6w5a7k2eXaJikjKaVHkL","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2603,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":52,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:49:55 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"agent\":\"#<Foobara::Agent:0x00007fd7cb24fdd8>\",\"llm_model\":\"claude-opus-4-20250514\",\"pass_aggregates_to_llm\":true}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"runtime.could_not_parse_result_json\":{\"key\":\"runtime.could_not_parse_result_json\",\"path\":[],\"runtime_path\":[],\"category\":\"runtime\",\"symbol\":\"could_not_parse_result_json\",\"message\":\"Could
        not parse result JSON: unexpected token ''I'' at line 1 column 1\",\"context\":{\"raw_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check what the credit policy requires:\\n\\n1. Minimum credit score: 700\\n2.
        Credit score to use: median\\n3. Minimum pay stub count: 1\\n\\nNow let me
        analyze the loan file:\\n- Pay stubs: 1 pay stub provided (meets the minimum
        requirement of 1)\\n- Credit scores: 600 (Experian), 650 (Equifax), 750 (TransUnion)\\n-
        The median credit score is 650\\n\\nSince the credit policy requires a minimum
        credit score of 700 and uses the median score for comparison, and the median
        score (650) is less than the required 700, this loan file does not meet the
        credit score requirement.\\n\\nTherefore, I need to deny the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":1,\\\"denied_reasons\\\":[\\\"low_credit_score\\\"]}}\",\"stripped_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check what the credit policy requires:\\n\\n1. Minimum credit score: 700\\n2.
        Credit score to use: median\\n3. Minimum pay stub count: 1\\n\\nNow let me
        analyze the loan file:\\n- Pay stubs: 1 pay stub provided (meets the minimum
        requirement of 1)\\n- Credit scores: 600 (Experian), 650 (Equifax), 750 (TransUnion)\\n-
        The median credit score is 650\\n\\nSince the credit policy requires a minimum
        credit score of 700 and uses the median score for comparison, and the median
        score (650) is less than the required 700, this loan file does not meet the
        credit score requirement.\\n\\nTherefore, I need to deny the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":1,\\\"denied_reasons\\\":[\\\"low_credit_score\\\"]}}\"},\"is_fatal\":false}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review loan file\n\nYour behavior has been described to the person or agent
        that chose to run you as: Checks the LoanFile against all requirements in
        its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements.\n\nYour
        inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}}}\n\nYou have been ran with the following inputs:\n\n{\"loan_file\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1},\"id\":1}}\n\nYou
        will answer with the name of the next command to run and, if needed, its inputs.
        Choose whichever command is best to make progress towards accomplishing the
        current goal based on the progress made so far. If the goal has been accomplished
        then choose the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you
        are stuck either due to errors or because you do not have the command you
        need to accomplish the goal, then choose GiveUp.\n\nYou can get more details
        about the inputs and result schemas for a specific command by choosing the
        DescribeCommand command.\n\nYour result type is described by the following
        JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:50:05 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:50:04Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:50:05Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:49:55Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '96000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '96000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:50:04Z'
      Request-Id:
      - req_011CRQcL3Nrh3H51QDAwkgyJ
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963e0c11082067ca-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01MYr1fGCsumgpeCrxsj1PnW","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\"}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2468,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":34,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:50:05 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"agent\":\"#<Foobara::Agent:0x00007fd7cb24fdd8>\",\"llm_model\":\"claude-opus-4-20250514\",\"pass_aggregates_to_llm\":true}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"runtime.could_not_parse_result_json\":{\"key\":\"runtime.could_not_parse_result_json\",\"path\":[],\"runtime_path\":[],\"category\":\"runtime\",\"symbol\":\"could_not_parse_result_json\",\"message\":\"Could
        not parse result JSON: unexpected token ''I'' at line 1 column 1\",\"context\":{\"raw_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check what the credit policy requires:\\n\\n1. Minimum credit score: 700\\n2.
        Credit score to use: median\\n3. Minimum pay stub count: 1\\n\\nNow let me
        analyze the loan file:\\n- Pay stubs: 1 pay stub provided (meets the minimum
        requirement of 1)\\n- Credit scores: 600 (Experian), 650 (Equifax), 750 (TransUnion)\\n-
        The median credit score is 650\\n\\nSince the credit policy requires a minimum
        credit score of 700 and uses the median score for comparison, and the median
        score (650) is less than the required 700, this loan file does not meet the
        credit score requirement.\\n\\nTherefore, I need to deny the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":1,\\\"denied_reasons\\\":[\\\"low_credit_score\\\"]}}\",\"stripped_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check what the credit policy requires:\\n\\n1. Minimum credit score: 700\\n2.
        Credit score to use: median\\n3. Minimum pay stub count: 1\\n\\nNow let me
        analyze the loan file:\\n- Pay stubs: 1 pay stub provided (meets the minimum
        requirement of 1)\\n- Credit scores: 600 (Experian), 650 (Equifax), 750 (TransUnion)\\n-
        The median credit score is 650\\n\\nSince the credit policy requires a minimum
        credit score of 700 and uses the median score for comparison, and the median
        score (650) is less than the required 700, this loan file does not meet the
        credit score requirement.\\n\\nTherefore, I need to deny the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":1,\\\"denied_reasons\\\":[\\\"low_credit_score\\\"]}}\"},\"is_fatal\":false}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":1,\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\",\"description\":\"Notifies
        the user that the current goal has been accomplished and accepts a final result
        value as inputs. The user might issue a new goal.\",\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}}}}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review loan file\n\nYour behavior has been described to the person or agent
        that chose to run you as: Checks the LoanFile against all requirements in
        its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements.\n\nYour
        inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}}}\n\nYou have been ran with the following inputs:\n\n{\"loan_file\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":{\"id\":1,\"institution\":\"Bank
        A\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"median\",\"minimum_pay_stub_count\":1},\"id\":1}}\n\nYou
        will answer with the name of the next command to run and, if needed, its inputs.
        Choose whichever command is best to make progress towards accomplishing the
        current goal based on the progress made so far. If the goal has been accomplished
        then choose the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you
        are stuck either due to errors or because you do not have the command you
        need to accomplish the goal, then choose GiveUp.\n\nYou can get more details
        about the inputs and result schemas for a specific command by choosing the
        DescribeCommand command.\n\nYour result type is described by the following
        JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:50:11 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:50:10Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:50:11Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:50:06Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '96000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '96000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:50:10Z'
      Request-Id:
      - req_011CRQcLqEdyVnbMxdX4We8m
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963e0c52fa30cee5-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01W49rq6kkJWLYi2BSZfTEhQ","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\",\"inputs\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2688,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":61,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:50:11 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-sonnet-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"description\":\"Checks
        the LoanFile against all requirements in its CreditPolicy. Denies the LoanFile
        that has any unsatisfied requirements.\",\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review all loan files needing review\n\nYou will answer with the name of the
        next command to run and, if needed, its inputs. Choose whichever command is
        best to make progress towards accomplishing the current goal based on the
        progress made so far. If the goal has been accomplished then choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command. If you are stuck either due to errors or because you do not have
        the command you need to accomplish the goal, then choose GiveUp.\n\nYou can
        get more details about the inputs and result schemas for a specific command
        by choosing the DescribeCommand command.\n\nYour result type is described
        by the following JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:50:13 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '800000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '800000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:50:12Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '160000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '160000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:50:13Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:50:12Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '960000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '960000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:50:12Z'
      Request-Id:
      - req_011CRQcMG8LnwA8jUmTWXaru
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963e0c786fcf9e58-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01DxzN1BPBmXLzq7qT62vkJi","type":"message","role":"assistant","model":"claude-sonnet-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":1577,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":30,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:50:13 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-sonnet-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"description\":\"Checks
        the LoanFile against all requirements in its CreditPolicy. Denies the LoanFile
        that has any unsatisfied requirements.\",\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2}}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review all loan files needing review\n\nYou will answer with the name of the
        next command to run and, if needed, its inputs. Choose whichever command is
        best to make progress towards accomplishing the current goal based on the
        progress made so far. If the goal has been accomplished then choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command. If you are stuck either due to errors or because you do not have
        the command you need to accomplish the goal, then choose GiveUp.\n\nYou can
        get more details about the inputs and result schemas for a specific command
        by choosing the DescribeCommand command.\n\nYour result type is described
        by the following JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:50:14 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '800000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '800000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:50:14Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '160000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '160000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:50:14Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:50:13Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '960000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '960000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:50:14Z'
      Request-Id:
      - req_011CRQcMNrALe6J4yddGzpU1
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963e0c823934fa01-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01SDDz85KmvUhjLsUUd5cBXK","type":"message","role":"assistant","model":"claude-sonnet-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"inputs\":{\"loan_file\":2}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":1724,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":31,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:50:14 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review loan file\n\nYour behavior has been described to the person or agent
        that chose to run you as: Checks the LoanFile against all requirements in
        its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements.\n\nYour
        inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}}}\n\nYou have been ran with the following inputs:\n\n{\"loan_file\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":{\"id\":2,\"institution\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":2},\"id\":2}}\n\nYou
        will answer with the name of the next command to run and, if needed, its inputs.
        Choose whichever command is best to make progress towards accomplishing the
        current goal based on the progress made so far. If the goal has been accomplished
        then choose the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you
        are stuck either due to errors or because you do not have the command you
        need to accomplish the goal, then choose GiveUp.\n\nYou can get more details
        about the inputs and result schemas for a specific command by choosing the
        DescribeCommand command.\n\nYour result type is described by the following
        JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:50:21 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:50:16Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:50:22Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:50:15Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '96000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '96000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:50:16Z'
      Request-Id:
      - req_011CRQcMVQJqQGH7E4CtqLqJ
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963e0c8bbd5d2302-SJC
    body:
      encoding: ASCII-8BIT
      string: !binary |-
        eyJpZCI6Im1zZ18wMVNOZUw0dzMzbjFnY1BhM2J4R0o4bTciLCJ0eXBlIjoibWVzc2FnZSIsInJvbGUiOiJhc3Npc3RhbnQiLCJtb2RlbCI6ImNsYXVkZS1vcHVzLTQtMjAyNTA1MTQiLCJjb250ZW50IjpbeyJ0eXBlIjoidGV4dCIsInRleHQiOiJJIG5lZWQgdG8gcmV2aWV3IHRoZSBsb2FuIGZpbGUgYWdhaW5zdCB0aGUgY3JlZGl0IHBvbGljeSByZXF1aXJlbWVudHMuIExldCBtZSBjaGVjayB3aGF0IHRoZSByZXF1aXJlbWVudHMgYXJlOlxuXG4xLiAqKkNyZWRpdCBTY29yZSBSZXF1aXJlbWVudCoqOiBUaGUgY3JlZGl0IHBvbGljeSByZXF1aXJlcyBhIG1pbmltdW0gY3JlZGl0IHNjb3JlIG9mIDcwMCwgdXNpbmcgdGhlIFwibWF4aW11bVwiIHNjb3JlIGZyb20gdGhlIHRocmVlIGJ1cmVhdXNcbjIuICoqUGF5IFN0dWIgUmVxdWlyZW1lbnQqKjogVGhlIGNyZWRpdCBwb2xpY3kgcmVxdWlyZXMgYXQgbGVhc3QgMiBwYXkgc3R1YnNcblxuTG9va2luZyBhdCB0aGUgbG9hbiBmaWxlOlxuLSBDcmVkaXQgc2NvcmVzOiBFeHBlcmlhbiA2MDAsIEVxdWlmYXggNjUwLCBUcmFuc1VuaW9uIDc1MFxuLSBNYXhpbXVtIGNyZWRpdCBzY29yZTogNzUwIChtZWV0cyB0aGUgNzAwIG1pbmltdW0gcmVxdWlyZW1lbnQg4pyTKVxuLSBQYXkgc3R1YnM6IE9ubHkgMSBwYXkgc3R1YiBwcm92aWRlZCAoZG9lcyBOT1QgbWVldCB0aGUgMiBwYXkgc3R1YiBtaW5pbXVtIHJlcXVpcmVtZW50IOKclylcblxuU2luY2UgdGhlIGxvYW4gZmlsZSBkb2VzIG5vdCBtZWV0IGFsbCByZXF1aXJlbWVudHMgKHNwZWNpZmljYWxseSwgaXQgb25seSBoYXMgMSBwYXkgc3R1YiB3aGVuIDIgYXJlIHJlcXVpcmVkKSwgSSBuZWVkIHRvIGRlbnkgdGhlIGxvYW4gZmlsZS5cblxue1wiY29tbWFuZFwiOlwiRm9vYmFyYURlbW86OkxvYW5PcmlnaW5hdGlvbjo6RGVueUxvYW5GaWxlXCIsXCJpbnB1dHNcIjp7XCJsb2FuX2ZpbGVfaWRcIjoyLFwiZGVuaWVkX3JlYXNvbnNcIjpbXCJpbnN1ZmZpY2llbnRfcGF5X3N0dWJzX3Byb3ZpZGVkXCJdfX0ifV0sInN0b3BfcmVhc29uIjoiZW5kX3R1cm4iLCJzdG9wX3NlcXVlbmNlIjpudWxsLCJ1c2FnZSI6eyJpbnB1dF90b2tlbnMiOjEzNzUsImNhY2hlX2NyZWF0aW9uX2lucHV0X3Rva2VucyI6MCwiY2FjaGVfcmVhZF9pbnB1dF90b2tlbnMiOjAsIm91dHB1dF90b2tlbnMiOjI0MCwic2VydmljZV90aWVyIjoic3RhbmRhcmQifX0=
  recorded_at: Wed, 23 Jul 2025 20:50:21 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"agent\":\"#<Foobara::Agent:0x00007fd7cb476558>\",\"llm_model\":\"claude-opus-4-20250514\",\"pass_aggregates_to_llm\":true}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"runtime.could_not_parse_result_json\":{\"key\":\"runtime.could_not_parse_result_json\",\"path\":[],\"runtime_path\":[],\"category\":\"runtime\",\"symbol\":\"could_not_parse_result_json\",\"message\":\"Could
        not parse result JSON: unexpected token ''I'' at line 1 column 1\",\"context\":{\"raw_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check what the requirements are:\\n\\n1. **Credit Score Requirement**: The
        credit policy requires a minimum credit score of 700, using the \\\"maximum\\\"
        score from the three bureaus\\n2. **Pay Stub Requirement**: The credit policy
        requires at least 2 pay stubs\\n\\nLooking at the loan file:\\n- Credit scores:
        Experian 600, Equifax 650, TransUnion 750\\n- Maximum credit score: 750 (meets
        the 700 minimum requirement ✓)\\n- Pay stubs: Only 1 pay stub provided (does
        NOT meet the 2 pay stub minimum requirement ✗)\\n\\nSince the loan file does
        not meet all requirements (specifically, it only has 1 pay stub when 2 are
        required), I need to deny the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":2,\\\"denied_reasons\\\":[\\\"insufficient_pay_stubs_provided\\\"]}}\",\"stripped_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check what the requirements are:\\n\\n1. **Credit Score Requirement**: The
        credit policy requires a minimum credit score of 700, using the \\\"maximum\\\"
        score from the three bureaus\\n2. **Pay Stub Requirement**: The credit policy
        requires at least 2 pay stubs\\n\\nLooking at the loan file:\\n- Credit scores:
        Experian 600, Equifax 650, TransUnion 750\\n- Maximum credit score: 750 (meets
        the 700 minimum requirement ✓)\\n- Pay stubs: Only 1 pay stub provided (does
        NOT meet the 2 pay stub minimum requirement ✗)\\n\\nSince the loan file does
        not meet all requirements (specifically, it only has 1 pay stub when 2 are
        required), I need to deny the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":2,\\\"denied_reasons\\\":[\\\"insufficient_pay_stubs_provided\\\"]}}\"},\"is_fatal\":false}}}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review loan file\n\nYour behavior has been described to the person or agent
        that chose to run you as: Checks the LoanFile against all requirements in
        its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements.\n\nYour
        inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}}}\n\nYou have been ran with the following inputs:\n\n{\"loan_file\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":{\"id\":2,\"institution\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":2},\"id\":2}}\n\nYou
        will answer with the name of the next command to run and, if needed, its inputs.
        Choose whichever command is best to make progress towards accomplishing the
        current goal based on the progress made so far. If the goal has been accomplished
        then choose the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you
        are stuck either due to errors or because you do not have the command you
        need to accomplish the goal, then choose GiveUp.\n\nYou can get more details
        about the inputs and result schemas for a specific command by choosing the
        DescribeCommand command.\n\nYour result type is described by the following
        JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:50:24 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:50:23Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:50:24Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:50:22Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '96000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '96000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:50:23Z'
      Request-Id:
      - req_011CRQcN1Y2kR2dRZQJAihDQ
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963e0cb7dc90ce58-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01Dj7Fn3Fa9j4JSD78vbCpuM","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file_id\":2,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2078,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":49,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:50:24 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"agent\":\"#<Foobara::Agent:0x00007fd7cb476558>\",\"llm_model\":\"claude-opus-4-20250514\",\"pass_aggregates_to_llm\":true}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"runtime.could_not_parse_result_json\":{\"key\":\"runtime.could_not_parse_result_json\",\"path\":[],\"runtime_path\":[],\"category\":\"runtime\",\"symbol\":\"could_not_parse_result_json\",\"message\":\"Could
        not parse result JSON: unexpected token ''I'' at line 1 column 1\",\"context\":{\"raw_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check what the requirements are:\\n\\n1. **Credit Score Requirement**: The
        credit policy requires a minimum credit score of 700, using the \\\"maximum\\\"
        score from the three bureaus\\n2. **Pay Stub Requirement**: The credit policy
        requires at least 2 pay stubs\\n\\nLooking at the loan file:\\n- Credit scores:
        Experian 600, Equifax 650, TransUnion 750\\n- Maximum credit score: 750 (meets
        the 700 minimum requirement ✓)\\n- Pay stubs: Only 1 pay stub provided (does
        NOT meet the 2 pay stub minimum requirement ✗)\\n\\nSince the loan file does
        not meet all requirements (specifically, it only has 1 pay stub when 2 are
        required), I need to deny the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":2,\\\"denied_reasons\\\":[\\\"insufficient_pay_stubs_provided\\\"]}}\",\"stripped_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check what the requirements are:\\n\\n1. **Credit Score Requirement**: The
        credit policy requires a minimum credit score of 700, using the \\\"maximum\\\"
        score from the three bureaus\\n2. **Pay Stub Requirement**: The credit policy
        requires at least 2 pay stubs\\n\\nLooking at the loan file:\\n- Credit scores:
        Experian 600, Equifax 650, TransUnion 750\\n- Maximum credit score: 750 (meets
        the 700 minimum requirement ✓)\\n- Pay stubs: Only 1 pay stub provided (does
        NOT meet the 2 pay stub minimum requirement ✗)\\n\\nSince the loan file does
        not meet all requirements (specifically, it only has 1 pay stub when 2 are
        required), I need to deny the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":2,\\\"denied_reasons\\\":[\\\"insufficient_pay_stubs_provided\\\"]}}\"},\"is_fatal\":false}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"}],"temperature":0.0,"system":"You are part of an agent implementation.
        Your task is to decide which command to run next.\n\nYou are working towards
        accomplishing the following goal: Review loan file\n\nYour behavior has been
        described to the person or agent that chose to run you as: Checks the LoanFile
        against all requirements in its CreditPolicy. Denies the LoanFile that has
        any unsatisfied requirements.\n\nYour inputs to this command have the following
        type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}}}\n\nYou have been ran with the following inputs:\n\n{\"loan_file\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":{\"id\":2,\"institution\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":2},\"id\":2}}\n\nYou
        will answer with the name of the next command to run and, if needed, its inputs.
        Choose whichever command is best to make progress towards accomplishing the
        current goal based on the progress made so far. If the goal has been accomplished
        then choose the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you
        are stuck either due to errors or because you do not have the command you
        need to accomplish the goal, then choose GiveUp.\n\nYou can get more details
        about the inputs and result schemas for a specific command by choosing the
        DescribeCommand command.\n\nYour result type is described by the following
        JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:50:29 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:50:26Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:50:30Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:50:24Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '96000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '96000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:50:26Z'
      Request-Id:
      - req_011CRQcNDKhi36ZGRFoME4Ao
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963e0cc8faccf963-SJC
    body:
      encoding: ASCII-8BIT
      string: !binary |-
        eyJpZCI6Im1zZ18wMVg2a210ZlJkTEs3aUdBRUJZVXRGWm4iLCJ0eXBlIjoibWVzc2FnZSIsInJvbGUiOiJhc3Npc3RhbnQiLCJtb2RlbCI6ImNsYXVkZS1vcHVzLTQtMjAyNTA1MTQiLCJjb250ZW50IjpbeyJ0eXBlIjoidGV4dCIsInRleHQiOiJMb29raW5nIGF0IHRoZSBsb2FuIGZpbGUgYWdhaW5zdCB0aGUgY3JlZGl0IHBvbGljeSByZXF1aXJlbWVudHM6XG5cbjEuICoqQ3JlZGl0IFNjb3JlIFJlcXVpcmVtZW50Kio6IE1pbmltdW0gNzAwLCB1c2luZyBcIm1heGltdW1cIiBzY29yZVxuICAgLSBDcmVkaXQgc2NvcmVzOiBFeHBlcmlhbiA2MDAsIEVxdWlmYXggNjUwLCBUcmFuc1VuaW9uIDc1MFxuICAgLSBNYXhpbXVtIHNjb3JlOiA3NTAg4pyTIChtZWV0cyByZXF1aXJlbWVudClcblxuMi4gKipQYXkgU3R1YiBSZXF1aXJlbWVudCoqOiBNaW5pbXVtIDIgcGF5IHN0dWJzXG4gICAtIFBheSBzdHVicyBwcm92aWRlZDogMSDinJcgKGRvZXMgTk9UIG1lZXQgcmVxdWlyZW1lbnQpXG5cblNpbmNlIHRoZSBsb2FuIGZpbGUgZmFpbHMgdG8gbWVldCB0aGUgbWluaW11bSBwYXkgc3R1YiByZXF1aXJlbWVudCwgSSBuZWVkIHRvIGRlbnkgaXQuXG5cbntcImNvbW1hbmRcIjpcIkZvb2JhcmFEZW1vOjpMb2FuT3JpZ2luYXRpb246OkRlbnlMb2FuRmlsZVwiLFwiaW5wdXRzXCI6e1wibG9hbl9maWxlXCI6MixcImNyZWRpdF9zY29yZV91c2VkXCI6NzUwLFwiZGVuaWVkX3JlYXNvbnNcIjpbXCJpbnN1ZmZpY2llbnRfcGF5X3N0dWJzX3Byb3ZpZGVkXCJdfX0ifV0sInN0b3BfcmVhc29uIjoiZW5kX3R1cm4iLCJzdG9wX3NlcXVlbmNlIjpudWxsLCJ1c2FnZSI6eyJpbnB1dF90b2tlbnMiOjIyNTUsImNhY2hlX2NyZWF0aW9uX2lucHV0X3Rva2VucyI6MCwiY2FjaGVfcmVhZF9pbnB1dF90b2tlbnMiOjAsIm91dHB1dF90b2tlbnMiOjE4NSwic2VydmljZV90aWVyIjoic3RhbmRhcmQifX0=
  recorded_at: Wed, 23 Jul 2025 20:50:30 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"agent\":\"#<Foobara::Agent:0x00007fd7cb476558>\",\"llm_model\":\"claude-opus-4-20250514\",\"pass_aggregates_to_llm\":true}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"runtime.could_not_parse_result_json\":{\"key\":\"runtime.could_not_parse_result_json\",\"path\":[],\"runtime_path\":[],\"category\":\"runtime\",\"symbol\":\"could_not_parse_result_json\",\"message\":\"Could
        not parse result JSON: unexpected token ''I'' at line 1 column 1\",\"context\":{\"raw_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check what the requirements are:\\n\\n1. **Credit Score Requirement**: The
        credit policy requires a minimum credit score of 700, using the \\\"maximum\\\"
        score from the three bureaus\\n2. **Pay Stub Requirement**: The credit policy
        requires at least 2 pay stubs\\n\\nLooking at the loan file:\\n- Credit scores:
        Experian 600, Equifax 650, TransUnion 750\\n- Maximum credit score: 750 (meets
        the 700 minimum requirement ✓)\\n- Pay stubs: Only 1 pay stub provided (does
        NOT meet the 2 pay stub minimum requirement ✗)\\n\\nSince the loan file does
        not meet all requirements (specifically, it only has 1 pay stub when 2 are
        required), I need to deny the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":2,\\\"denied_reasons\\\":[\\\"insufficient_pay_stubs_provided\\\"]}}\",\"stripped_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check what the requirements are:\\n\\n1. **Credit Score Requirement**: The
        credit policy requires a minimum credit score of 700, using the \\\"maximum\\\"
        score from the three bureaus\\n2. **Pay Stub Requirement**: The credit policy
        requires at least 2 pay stubs\\n\\nLooking at the loan file:\\n- Credit scores:
        Experian 600, Equifax 650, TransUnion 750\\n- Maximum credit score: 750 (meets
        the 700 minimum requirement ✓)\\n- Pay stubs: Only 1 pay stub provided (does
        NOT meet the 2 pay stub minimum requirement ✗)\\n\\nSince the loan file does
        not meet all requirements (specifically, it only has 1 pay stub when 2 are
        required), I need to deny the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":2,\\\"denied_reasons\\\":[\\\"insufficient_pay_stubs_provided\\\"]}}\"},\"is_fatal\":false}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"agent\":\"#<Foobara::Agent:0x00007fd7cb476558>\",\"llm_model\":\"claude-opus-4-20250514\",\"pass_aggregates_to_llm\":true}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"runtime.could_not_parse_result_json\":{\"key\":\"runtime.could_not_parse_result_json\",\"path\":[],\"runtime_path\":[],\"category\":\"runtime\",\"symbol\":\"could_not_parse_result_json\",\"message\":\"Could
        not parse result JSON: unexpected character: ''Looking'' at line 1 column
        1\",\"context\":{\"raw_answer\":\"Looking at the loan file against the credit
        policy requirements:\\n\\n1. **Credit Score Requirement**: Minimum 700, using
        \\\"maximum\\\" score\\n   - Credit scores: Experian 600, Equifax 650, TransUnion
        750\\n   - Maximum score: 750 ✓ (meets requirement)\\n\\n2. **Pay Stub Requirement**:
        Minimum 2 pay stubs\\n   - Pay stubs provided: 1 ✗ (does NOT meet requirement)\\n\\nSince
        the loan file fails to meet the minimum pay stub requirement, I need to deny
        it.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file\\\":2,\\\"credit_score_used\\\":750,\\\"denied_reasons\\\":[\\\"insufficient_pay_stubs_provided\\\"]}}\",\"stripped_answer\":\"Looking
        at the loan file against the credit policy requirements:\\n\\n1. **Credit
        Score Requirement**: Minimum 700, using \\\"maximum\\\" score\\n   - Credit
        scores: Experian 600, Equifax 650, TransUnion 750\\n   - Maximum score: 750
        ✓ (meets requirement)\\n\\n2. **Pay Stub Requirement**: Minimum 2 pay stubs\\n   -
        Pay stubs provided: 1 ✗ (does NOT meet requirement)\\n\\nSince the loan file
        fails to meet the minimum pay stub requirement, I need to deny it.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file\\\":2,\\\"credit_score_used\\\":750,\\\"denied_reasons\\\":[\\\"insufficient_pay_stubs_provided\\\"]}}\"},\"is_fatal\":false}}}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review loan file\n\nYour behavior has been described to the person or agent
        that chose to run you as: Checks the LoanFile against all requirements in
        its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements.\n\nYour
        inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}}}\n\nYou have been ran with the following inputs:\n\n{\"loan_file\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":{\"id\":2,\"institution\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":2},\"id\":2}}\n\nYou
        will answer with the name of the next command to run and, if needed, its inputs.
        Choose whichever command is best to make progress towards accomplishing the
        current goal based on the progress made so far. If the goal has been accomplished
        then choose the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you
        are stuck either due to errors or because you do not have the command you
        need to accomplish the goal, then choose GiveUp.\n\nYou can get more details
        about the inputs and result schemas for a specific command by choosing the
        DescribeCommand command.\n\nYour result type is described by the following
        JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:50:32 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '79000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:50:32Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:50:32Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:50:30Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '96000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '95000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:50:32Z'
      Request-Id:
      - req_011CRQcNcdQicyyuvu7jEQf4
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963e0ceaef74aaa6-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_014dgYENCNYRkiskU2aE9SBu","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2847,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":55,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:50:32 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"agent\":\"#<Foobara::Agent:0x00007fd7cb476558>\",\"llm_model\":\"claude-opus-4-20250514\",\"pass_aggregates_to_llm\":true}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"runtime.could_not_parse_result_json\":{\"key\":\"runtime.could_not_parse_result_json\",\"path\":[],\"runtime_path\":[],\"category\":\"runtime\",\"symbol\":\"could_not_parse_result_json\",\"message\":\"Could
        not parse result JSON: unexpected token ''I'' at line 1 column 1\",\"context\":{\"raw_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check what the requirements are:\\n\\n1. **Credit Score Requirement**: The
        credit policy requires a minimum credit score of 700, using the \\\"maximum\\\"
        score from the three bureaus\\n2. **Pay Stub Requirement**: The credit policy
        requires at least 2 pay stubs\\n\\nLooking at the loan file:\\n- Credit scores:
        Experian 600, Equifax 650, TransUnion 750\\n- Maximum credit score: 750 (meets
        the 700 minimum requirement ✓)\\n- Pay stubs: Only 1 pay stub provided (does
        NOT meet the 2 pay stub minimum requirement ✗)\\n\\nSince the loan file does
        not meet all requirements (specifically, it only has 1 pay stub when 2 are
        required), I need to deny the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":2,\\\"denied_reasons\\\":[\\\"insufficient_pay_stubs_provided\\\"]}}\",\"stripped_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check what the requirements are:\\n\\n1. **Credit Score Requirement**: The
        credit policy requires a minimum credit score of 700, using the \\\"maximum\\\"
        score from the three bureaus\\n2. **Pay Stub Requirement**: The credit policy
        requires at least 2 pay stubs\\n\\nLooking at the loan file:\\n- Credit scores:
        Experian 600, Equifax 650, TransUnion 750\\n- Maximum credit score: 750 (meets
        the 700 minimum requirement ✓)\\n- Pay stubs: Only 1 pay stub provided (does
        NOT meet the 2 pay stub minimum requirement ✗)\\n\\nSince the loan file does
        not meet all requirements (specifically, it only has 1 pay stub when 2 are
        required), I need to deny the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":2,\\\"denied_reasons\\\":[\\\"insufficient_pay_stubs_provided\\\"]}}\"},\"is_fatal\":false}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"agent\":\"#<Foobara::Agent:0x00007fd7cb476558>\",\"llm_model\":\"claude-opus-4-20250514\",\"pass_aggregates_to_llm\":true}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"runtime.could_not_parse_result_json\":{\"key\":\"runtime.could_not_parse_result_json\",\"path\":[],\"runtime_path\":[],\"category\":\"runtime\",\"symbol\":\"could_not_parse_result_json\",\"message\":\"Could
        not parse result JSON: unexpected character: ''Looking'' at line 1 column
        1\",\"context\":{\"raw_answer\":\"Looking at the loan file against the credit
        policy requirements:\\n\\n1. **Credit Score Requirement**: Minimum 700, using
        \\\"maximum\\\" score\\n   - Credit scores: Experian 600, Equifax 650, TransUnion
        750\\n   - Maximum score: 750 ✓ (meets requirement)\\n\\n2. **Pay Stub Requirement**:
        Minimum 2 pay stubs\\n   - Pay stubs provided: 1 ✗ (does NOT meet requirement)\\n\\nSince
        the loan file fails to meet the minimum pay stub requirement, I need to deny
        it.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file\\\":2,\\\"credit_score_used\\\":750,\\\"denied_reasons\\\":[\\\"insufficient_pay_stubs_provided\\\"]}}\",\"stripped_answer\":\"Looking
        at the loan file against the credit policy requirements:\\n\\n1. **Credit
        Score Requirement**: Minimum 700, using \\\"maximum\\\" score\\n   - Credit
        scores: Experian 600, Equifax 650, TransUnion 750\\n   - Maximum score: 750
        ✓ (meets requirement)\\n\\n2. **Pay Stub Requirement**: Minimum 2 pay stubs\\n   -
        Pay stubs provided: 1 ✗ (does NOT meet requirement)\\n\\nSince the loan file
        fails to meet the minimum pay stub requirement, I need to deny it.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file\\\":2,\\\"credit_score_used\\\":750,\\\"denied_reasons\\\":[\\\"insufficient_pay_stubs_provided\\\"]}}\"},\"is_fatal\":false}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"data.loan_file.cannot_transition_state\":{\"key\":\"data.loan_file.cannot_transition_state\",\"path\":[\"loan_file\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"cannot_transition_state\",\"message\":\"Cannot
        perform deny transition for loan file 2 from needs_review. Expected state
        to be one of: [:in_review]. Did you forget to start the review?\",\"context\":{\"loan_file_id\":2,\"current_state\":\"needs_review\",\"required_states\":[\"in_review\"],\"attempted_transition\":\"deny\"},\"is_fatal\":false}}}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review loan file\n\nYour behavior has been described to the person or agent
        that chose to run you as: Checks the LoanFile against all requirements in
        its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements.\n\nYour
        inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}}}\n\nYou have been ran with the following inputs:\n\n{\"loan_file\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":{\"id\":2,\"institution\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":2},\"id\":2}}\n\nYou
        will answer with the name of the next command to run and, if needed, its inputs.
        Choose whichever command is best to make progress towards accomplishing the
        current goal based on the progress made so far. If the goal has been accomplished
        then choose the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you
        are stuck either due to errors or because you do not have the command you
        need to accomplish the goal, then choose GiveUp.\n\nYou can get more details
        about the inputs and result schemas for a specific command by choosing the
        DescribeCommand command.\n\nYour result type is described by the following
        JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:50:41 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:50:40Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:50:41Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:50:33Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '96000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '96000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:50:40Z'
      Request-Id:
      - req_011CRQcNowJc1TZapXyHg3dg
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963e0cfbbb0cb976-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01U69C54hFSMtNFHny2rBTUR","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":3049,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":34,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:50:41 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"agent\":\"#<Foobara::Agent:0x00007fd7cb476558>\",\"llm_model\":\"claude-opus-4-20250514\",\"pass_aggregates_to_llm\":true}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"runtime.could_not_parse_result_json\":{\"key\":\"runtime.could_not_parse_result_json\",\"path\":[],\"runtime_path\":[],\"category\":\"runtime\",\"symbol\":\"could_not_parse_result_json\",\"message\":\"Could
        not parse result JSON: unexpected token ''I'' at line 1 column 1\",\"context\":{\"raw_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check what the requirements are:\\n\\n1. **Credit Score Requirement**: The
        credit policy requires a minimum credit score of 700, using the \\\"maximum\\\"
        score from the three bureaus\\n2. **Pay Stub Requirement**: The credit policy
        requires at least 2 pay stubs\\n\\nLooking at the loan file:\\n- Credit scores:
        Experian 600, Equifax 650, TransUnion 750\\n- Maximum credit score: 750 (meets
        the 700 minimum requirement ✓)\\n- Pay stubs: Only 1 pay stub provided (does
        NOT meet the 2 pay stub minimum requirement ✗)\\n\\nSince the loan file does
        not meet all requirements (specifically, it only has 1 pay stub when 2 are
        required), I need to deny the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":2,\\\"denied_reasons\\\":[\\\"insufficient_pay_stubs_provided\\\"]}}\",\"stripped_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check what the requirements are:\\n\\n1. **Credit Score Requirement**: The
        credit policy requires a minimum credit score of 700, using the \\\"maximum\\\"
        score from the three bureaus\\n2. **Pay Stub Requirement**: The credit policy
        requires at least 2 pay stubs\\n\\nLooking at the loan file:\\n- Credit scores:
        Experian 600, Equifax 650, TransUnion 750\\n- Maximum credit score: 750 (meets
        the 700 minimum requirement ✓)\\n- Pay stubs: Only 1 pay stub provided (does
        NOT meet the 2 pay stub minimum requirement ✗)\\n\\nSince the loan file does
        not meet all requirements (specifically, it only has 1 pay stub when 2 are
        required), I need to deny the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":2,\\\"denied_reasons\\\":[\\\"insufficient_pay_stubs_provided\\\"]}}\"},\"is_fatal\":false}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"agent\":\"#<Foobara::Agent:0x00007fd7cb476558>\",\"llm_model\":\"claude-opus-4-20250514\",\"pass_aggregates_to_llm\":true}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"runtime.could_not_parse_result_json\":{\"key\":\"runtime.could_not_parse_result_json\",\"path\":[],\"runtime_path\":[],\"category\":\"runtime\",\"symbol\":\"could_not_parse_result_json\",\"message\":\"Could
        not parse result JSON: unexpected character: ''Looking'' at line 1 column
        1\",\"context\":{\"raw_answer\":\"Looking at the loan file against the credit
        policy requirements:\\n\\n1. **Credit Score Requirement**: Minimum 700, using
        \\\"maximum\\\" score\\n   - Credit scores: Experian 600, Equifax 650, TransUnion
        750\\n   - Maximum score: 750 ✓ (meets requirement)\\n\\n2. **Pay Stub Requirement**:
        Minimum 2 pay stubs\\n   - Pay stubs provided: 1 ✗ (does NOT meet requirement)\\n\\nSince
        the loan file fails to meet the minimum pay stub requirement, I need to deny
        it.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file\\\":2,\\\"credit_score_used\\\":750,\\\"denied_reasons\\\":[\\\"insufficient_pay_stubs_provided\\\"]}}\",\"stripped_answer\":\"Looking
        at the loan file against the credit policy requirements:\\n\\n1. **Credit
        Score Requirement**: Minimum 700, using \\\"maximum\\\" score\\n   - Credit
        scores: Experian 600, Equifax 650, TransUnion 750\\n   - Maximum score: 750
        ✓ (meets requirement)\\n\\n2. **Pay Stub Requirement**: Minimum 2 pay stubs\\n   -
        Pay stubs provided: 1 ✗ (does NOT meet requirement)\\n\\nSince the loan file
        fails to meet the minimum pay stub requirement, I need to deny it.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file\\\":2,\\\"credit_score_used\\\":750,\\\"denied_reasons\\\":[\\\"insufficient_pay_stubs_provided\\\"]}}\"},\"is_fatal\":false}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"data.loan_file.cannot_transition_state\":{\"key\":\"data.loan_file.cannot_transition_state\",\"path\":[\"loan_file\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"cannot_transition_state\",\"message\":\"Cannot
        perform deny transition for loan file 2 from needs_review. Expected state
        to be one of: [:in_review]. Did you forget to start the review?\",\"context\":{\"loan_file_id\":2,\"current_state\":\"needs_review\",\"required_states\":[\"in_review\"],\"attempted_transition\":\"deny\"},\"is_fatal\":false}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"}],"temperature":0.0,"system":"You are part of an agent implementation.
        Your task is to decide which command to run next.\n\nYou are working towards
        accomplishing the following goal: Review loan file\n\nYour behavior has been
        described to the person or agent that chose to run you as: Checks the LoanFile
        against all requirements in its CreditPolicy. Denies the LoanFile that has
        any unsatisfied requirements.\n\nYour inputs to this command have the following
        type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}}}\n\nYou have been ran with the following inputs:\n\n{\"loan_file\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":{\"id\":2,\"institution\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":2},\"id\":2}}\n\nYou
        will answer with the name of the next command to run and, if needed, its inputs.
        Choose whichever command is best to make progress towards accomplishing the
        current goal based on the progress made so far. If the goal has been accomplished
        then choose the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you
        are stuck either due to errors or because you do not have the command you
        need to accomplish the goal, then choose GiveUp.\n\nYou can get more details
        about the inputs and result schemas for a specific command by choosing the
        DescribeCommand command.\n\nYour result type is described by the following
        JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:50:43 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '79000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:50:43Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:50:43Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:50:41Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '96000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '95000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:50:43Z'
      Request-Id:
      - req_011CRQcPSit4fEYdEL6G54Pa
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963e0d317b9b156b-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01UAehaFbwUKftFe3qfhjooM","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":3172,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":34,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:50:43 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"agent\":\"#<Foobara::Agent:0x00007fd7cb476558>\",\"llm_model\":\"claude-opus-4-20250514\",\"pass_aggregates_to_llm\":true}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"runtime.could_not_parse_result_json\":{\"key\":\"runtime.could_not_parse_result_json\",\"path\":[],\"runtime_path\":[],\"category\":\"runtime\",\"symbol\":\"could_not_parse_result_json\",\"message\":\"Could
        not parse result JSON: unexpected token ''I'' at line 1 column 1\",\"context\":{\"raw_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check what the requirements are:\\n\\n1. **Credit Score Requirement**: The
        credit policy requires a minimum credit score of 700, using the \\\"maximum\\\"
        score from the three bureaus\\n2. **Pay Stub Requirement**: The credit policy
        requires at least 2 pay stubs\\n\\nLooking at the loan file:\\n- Credit scores:
        Experian 600, Equifax 650, TransUnion 750\\n- Maximum credit score: 750 (meets
        the 700 minimum requirement ✓)\\n- Pay stubs: Only 1 pay stub provided (does
        NOT meet the 2 pay stub minimum requirement ✗)\\n\\nSince the loan file does
        not meet all requirements (specifically, it only has 1 pay stub when 2 are
        required), I need to deny the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":2,\\\"denied_reasons\\\":[\\\"insufficient_pay_stubs_provided\\\"]}}\",\"stripped_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check what the requirements are:\\n\\n1. **Credit Score Requirement**: The
        credit policy requires a minimum credit score of 700, using the \\\"maximum\\\"
        score from the three bureaus\\n2. **Pay Stub Requirement**: The credit policy
        requires at least 2 pay stubs\\n\\nLooking at the loan file:\\n- Credit scores:
        Experian 600, Equifax 650, TransUnion 750\\n- Maximum credit score: 750 (meets
        the 700 minimum requirement ✓)\\n- Pay stubs: Only 1 pay stub provided (does
        NOT meet the 2 pay stub minimum requirement ✗)\\n\\nSince the loan file does
        not meet all requirements (specifically, it only has 1 pay stub when 2 are
        required), I need to deny the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":2,\\\"denied_reasons\\\":[\\\"insufficient_pay_stubs_provided\\\"]}}\"},\"is_fatal\":false}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"agent\":\"#<Foobara::Agent:0x00007fd7cb476558>\",\"llm_model\":\"claude-opus-4-20250514\",\"pass_aggregates_to_llm\":true}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"runtime.could_not_parse_result_json\":{\"key\":\"runtime.could_not_parse_result_json\",\"path\":[],\"runtime_path\":[],\"category\":\"runtime\",\"symbol\":\"could_not_parse_result_json\",\"message\":\"Could
        not parse result JSON: unexpected character: ''Looking'' at line 1 column
        1\",\"context\":{\"raw_answer\":\"Looking at the loan file against the credit
        policy requirements:\\n\\n1. **Credit Score Requirement**: Minimum 700, using
        \\\"maximum\\\" score\\n   - Credit scores: Experian 600, Equifax 650, TransUnion
        750\\n   - Maximum score: 750 ✓ (meets requirement)\\n\\n2. **Pay Stub Requirement**:
        Minimum 2 pay stubs\\n   - Pay stubs provided: 1 ✗ (does NOT meet requirement)\\n\\nSince
        the loan file fails to meet the minimum pay stub requirement, I need to deny
        it.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file\\\":2,\\\"credit_score_used\\\":750,\\\"denied_reasons\\\":[\\\"insufficient_pay_stubs_provided\\\"]}}\",\"stripped_answer\":\"Looking
        at the loan file against the credit policy requirements:\\n\\n1. **Credit
        Score Requirement**: Minimum 700, using \\\"maximum\\\" score\\n   - Credit
        scores: Experian 600, Equifax 650, TransUnion 750\\n   - Maximum score: 750
        ✓ (meets requirement)\\n\\n2. **Pay Stub Requirement**: Minimum 2 pay stubs\\n   -
        Pay stubs provided: 1 ✗ (does NOT meet requirement)\\n\\nSince the loan file
        fails to meet the minimum pay stub requirement, I need to deny it.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file\\\":2,\\\"credit_score_used\\\":750,\\\"denied_reasons\\\":[\\\"insufficient_pay_stubs_provided\\\"]}}\"},\"is_fatal\":false}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"data.loan_file.cannot_transition_state\":{\"key\":\"data.loan_file.cannot_transition_state\",\"path\":[\"loan_file\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"cannot_transition_state\",\"message\":\"Cannot
        perform deny transition for loan file 2 from needs_review. Expected state
        to be one of: [:in_review]. Did you forget to start the review?\",\"context\":{\"loan_file_id\":2,\"current_state\":\"needs_review\",\"required_states\":[\"in_review\"],\"attempted_transition\":\"deny\"},\"is_fatal\":false}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review loan file\n\nYour behavior has been described to the person or agent
        that chose to run you as: Checks the LoanFile against all requirements in
        its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements.\n\nYour
        inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}}}\n\nYou have been ran with the following inputs:\n\n{\"loan_file\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":{\"id\":2,\"institution\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":2},\"id\":2}}\n\nYou
        will answer with the name of the next command to run and, if needed, its inputs.
        Choose whichever command is best to make progress towards accomplishing the
        current goal based on the progress made so far. If the goal has been accomplished
        then choose the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you
        are stuck either due to errors or because you do not have the command you
        need to accomplish the goal, then choose GiveUp.\n\nYou can get more details
        about the inputs and result schemas for a specific command by choosing the
        DescribeCommand command.\n\nYour result type is described by the following
        JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:50:46 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '79000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:50:46Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:50:46Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:50:43Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '96000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '95000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:50:46Z'
      Request-Id:
      - req_011CRQcPcp6vvcP3UXqW3gbF
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963e0d40381bed41-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01LknNx6yt24b6BUf6XyapTc","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":3218,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":55,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:50:46 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"agent\":\"#<Foobara::Agent:0x00007fd7cb476558>\",\"llm_model\":\"claude-opus-4-20250514\",\"pass_aggregates_to_llm\":true}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"runtime.could_not_parse_result_json\":{\"key\":\"runtime.could_not_parse_result_json\",\"path\":[],\"runtime_path\":[],\"category\":\"runtime\",\"symbol\":\"could_not_parse_result_json\",\"message\":\"Could
        not parse result JSON: unexpected token ''I'' at line 1 column 1\",\"context\":{\"raw_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check what the requirements are:\\n\\n1. **Credit Score Requirement**: The
        credit policy requires a minimum credit score of 700, using the \\\"maximum\\\"
        score from the three bureaus\\n2. **Pay Stub Requirement**: The credit policy
        requires at least 2 pay stubs\\n\\nLooking at the loan file:\\n- Credit scores:
        Experian 600, Equifax 650, TransUnion 750\\n- Maximum credit score: 750 (meets
        the 700 minimum requirement ✓)\\n- Pay stubs: Only 1 pay stub provided (does
        NOT meet the 2 pay stub minimum requirement ✗)\\n\\nSince the loan file does
        not meet all requirements (specifically, it only has 1 pay stub when 2 are
        required), I need to deny the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":2,\\\"denied_reasons\\\":[\\\"insufficient_pay_stubs_provided\\\"]}}\",\"stripped_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check what the requirements are:\\n\\n1. **Credit Score Requirement**: The
        credit policy requires a minimum credit score of 700, using the \\\"maximum\\\"
        score from the three bureaus\\n2. **Pay Stub Requirement**: The credit policy
        requires at least 2 pay stubs\\n\\nLooking at the loan file:\\n- Credit scores:
        Experian 600, Equifax 650, TransUnion 750\\n- Maximum credit score: 750 (meets
        the 700 minimum requirement ✓)\\n- Pay stubs: Only 1 pay stub provided (does
        NOT meet the 2 pay stub minimum requirement ✗)\\n\\nSince the loan file does
        not meet all requirements (specifically, it only has 1 pay stub when 2 are
        required), I need to deny the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":2,\\\"denied_reasons\\\":[\\\"insufficient_pay_stubs_provided\\\"]}}\"},\"is_fatal\":false}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"agent\":\"#<Foobara::Agent:0x00007fd7cb476558>\",\"llm_model\":\"claude-opus-4-20250514\",\"pass_aggregates_to_llm\":true}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"runtime.could_not_parse_result_json\":{\"key\":\"runtime.could_not_parse_result_json\",\"path\":[],\"runtime_path\":[],\"category\":\"runtime\",\"symbol\":\"could_not_parse_result_json\",\"message\":\"Could
        not parse result JSON: unexpected character: ''Looking'' at line 1 column
        1\",\"context\":{\"raw_answer\":\"Looking at the loan file against the credit
        policy requirements:\\n\\n1. **Credit Score Requirement**: Minimum 700, using
        \\\"maximum\\\" score\\n   - Credit scores: Experian 600, Equifax 650, TransUnion
        750\\n   - Maximum score: 750 ✓ (meets requirement)\\n\\n2. **Pay Stub Requirement**:
        Minimum 2 pay stubs\\n   - Pay stubs provided: 1 ✗ (does NOT meet requirement)\\n\\nSince
        the loan file fails to meet the minimum pay stub requirement, I need to deny
        it.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file\\\":2,\\\"credit_score_used\\\":750,\\\"denied_reasons\\\":[\\\"insufficient_pay_stubs_provided\\\"]}}\",\"stripped_answer\":\"Looking
        at the loan file against the credit policy requirements:\\n\\n1. **Credit
        Score Requirement**: Minimum 700, using \\\"maximum\\\" score\\n   - Credit
        scores: Experian 600, Equifax 650, TransUnion 750\\n   - Maximum score: 750
        ✓ (meets requirement)\\n\\n2. **Pay Stub Requirement**: Minimum 2 pay stubs\\n   -
        Pay stubs provided: 1 ✗ (does NOT meet requirement)\\n\\nSince the loan file
        fails to meet the minimum pay stub requirement, I need to deny it.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file\\\":2,\\\"credit_score_used\\\":750,\\\"denied_reasons\\\":[\\\"insufficient_pay_stubs_provided\\\"]}}\"},\"is_fatal\":false}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review loan file\n\nYour behavior has been described to the person or agent
        that chose to run you as: Checks the LoanFile against all requirements in
        its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements.\n\nYour
        inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}}}\n\nYou have been ran with the following inputs:\n\n{\"loan_file\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":{\"id\":2,\"institution\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":2},\"id\":2}}\n\nYou
        will answer with the name of the next command to run and, if needed, its inputs.
        Choose whichever command is best to make progress towards accomplishing the
        current goal based on the progress made so far. If the goal has been accomplished
        then choose the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you
        are stuck either due to errors or because you do not have the command you
        need to accomplish the goal, then choose GiveUp.\n\nYou can get more details
        about the inputs and result schemas for a specific command by choosing the
        DescribeCommand command.\n\nYour result type is described by the following
        JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:50:49 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '79000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:50:49Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:50:49Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:50:46Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '96000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '95000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:50:49Z'
      Request-Id:
      - req_011CRQcPpdWP47tY7s4hs3wE
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963e0d518bf3ebe2-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01FRYH8MaAKFQLKgDD5a2un8","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\"}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":3083,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":34,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:50:49 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"agent\":\"#<Foobara::Agent:0x00007fd7cb476558>\",\"llm_model\":\"claude-opus-4-20250514\",\"pass_aggregates_to_llm\":true}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"runtime.could_not_parse_result_json\":{\"key\":\"runtime.could_not_parse_result_json\",\"path\":[],\"runtime_path\":[],\"category\":\"runtime\",\"symbol\":\"could_not_parse_result_json\",\"message\":\"Could
        not parse result JSON: unexpected token ''I'' at line 1 column 1\",\"context\":{\"raw_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check what the requirements are:\\n\\n1. **Credit Score Requirement**: The
        credit policy requires a minimum credit score of 700, using the \\\"maximum\\\"
        score from the three bureaus\\n2. **Pay Stub Requirement**: The credit policy
        requires at least 2 pay stubs\\n\\nLooking at the loan file:\\n- Credit scores:
        Experian 600, Equifax 650, TransUnion 750\\n- Maximum credit score: 750 (meets
        the 700 minimum requirement ✓)\\n- Pay stubs: Only 1 pay stub provided (does
        NOT meet the 2 pay stub minimum requirement ✗)\\n\\nSince the loan file does
        not meet all requirements (specifically, it only has 1 pay stub when 2 are
        required), I need to deny the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":2,\\\"denied_reasons\\\":[\\\"insufficient_pay_stubs_provided\\\"]}}\",\"stripped_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check what the requirements are:\\n\\n1. **Credit Score Requirement**: The
        credit policy requires a minimum credit score of 700, using the \\\"maximum\\\"
        score from the three bureaus\\n2. **Pay Stub Requirement**: The credit policy
        requires at least 2 pay stubs\\n\\nLooking at the loan file:\\n- Credit scores:
        Experian 600, Equifax 650, TransUnion 750\\n- Maximum credit score: 750 (meets
        the 700 minimum requirement ✓)\\n- Pay stubs: Only 1 pay stub provided (does
        NOT meet the 2 pay stub minimum requirement ✗)\\n\\nSince the loan file does
        not meet all requirements (specifically, it only has 1 pay stub when 2 are
        required), I need to deny the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":2,\\\"denied_reasons\\\":[\\\"insufficient_pay_stubs_provided\\\"]}}\"},\"is_fatal\":false}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"denied_reasons\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"agent\":\"#<Foobara::Agent:0x00007fd7cb476558>\",\"llm_model\":\"claude-opus-4-20250514\",\"pass_aggregates_to_llm\":true}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"runtime.could_not_parse_result_json\":{\"key\":\"runtime.could_not_parse_result_json\",\"path\":[],\"runtime_path\":[],\"category\":\"runtime\",\"symbol\":\"could_not_parse_result_json\",\"message\":\"Could
        not parse result JSON: unexpected character: ''Looking'' at line 1 column
        1\",\"context\":{\"raw_answer\":\"Looking at the loan file against the credit
        policy requirements:\\n\\n1. **Credit Score Requirement**: Minimum 700, using
        \\\"maximum\\\" score\\n   - Credit scores: Experian 600, Equifax 650, TransUnion
        750\\n   - Maximum score: 750 ✓ (meets requirement)\\n\\n2. **Pay Stub Requirement**:
        Minimum 2 pay stubs\\n   - Pay stubs provided: 1 ✗ (does NOT meet requirement)\\n\\nSince
        the loan file fails to meet the minimum pay stub requirement, I need to deny
        it.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file\\\":2,\\\"credit_score_used\\\":750,\\\"denied_reasons\\\":[\\\"insufficient_pay_stubs_provided\\\"]}}\",\"stripped_answer\":\"Looking
        at the loan file against the credit policy requirements:\\n\\n1. **Credit
        Score Requirement**: Minimum 700, using \\\"maximum\\\" score\\n   - Credit
        scores: Experian 600, Equifax 650, TransUnion 750\\n   - Maximum score: 750
        ✓ (meets requirement)\\n\\n2. **Pay Stub Requirement**: Minimum 2 pay stubs\\n   -
        Pay stubs provided: 1 ✗ (does NOT meet requirement)\\n\\nSince the loan file
        fails to meet the minimum pay stub requirement, I need to deny it.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::DenyLoanFile\\\",\\\"inputs\\\":{\\\"loan_file\\\":2,\\\"credit_score_used\\\":750,\\\"denied_reasons\\\":[\\\"insufficient_pay_stubs_provided\\\"]}}\"},\"is_fatal\":false}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"inputs\":{\"loan_file\":2,\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\",\"description\":\"Notifies
        the user that the current goal has been accomplished and accepts a final result
        value as inputs. The user might issue a new goal.\",\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}}}}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review loan file\n\nYour behavior has been described to the person or agent
        that chose to run you as: Checks the LoanFile against all requirements in
        its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements.\n\nYour
        inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}}}\n\nYou have been ran with the following inputs:\n\n{\"loan_file\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":{\"id\":2,\"institution\":\"Bank
        B\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":2},\"id\":2}}\n\nYou
        will answer with the name of the next command to run and, if needed, its inputs.
        Choose whichever command is best to make progress towards accomplishing the
        current goal based on the progress made so far. If the goal has been accomplished
        then choose the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you
        are stuck either due to errors or because you do not have the command you
        need to accomplish the goal, then choose GiveUp.\n\nYou can get more details
        about the inputs and result schemas for a specific command by choosing the
        DescribeCommand command.\n\nYour result type is described by the following
        JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:50:52 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '79000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:50:51Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:50:52Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:50:49Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '96000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '95000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:50:51Z'
      Request-Id:
      - req_011CRQcQ2caQhyuYaeS4s5s7
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963e0d6309ce06ad-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01Xxioj5qCsn8ZGCcYVVsGup","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\",\"inputs\":{\"decision\":\"denied\",\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":3303,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":64,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:50:52 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-sonnet-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"description\":\"Checks
        the LoanFile against all requirements in its CreditPolicy. Denies the LoanFile
        that has any unsatisfied requirements.\",\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"inputs\":{\"loan_file\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"decision\":\"denied\",\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review all loan files needing review\n\nYou will answer with the name of the
        next command to run and, if needed, its inputs. Choose whichever command is
        best to make progress towards accomplishing the current goal based on the
        progress made so far. If the goal has been accomplished then choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command. If you are stuck either due to errors or because you do not have
        the command you need to accomplish the goal, then choose GiveUp.\n\nYou can
        get more details about the inputs and result schemas for a specific command
        by choosing the DescribeCommand command.\n\nYour result type is described
        by the following JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:50:53 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '800000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '800000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:50:53Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '160000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '160000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:50:53Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:50:52Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '960000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '960000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:50:53Z'
      Request-Id:
      - req_011CRQcQFC7zxwB8r3qnsjYX
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963e0d756a4667a6-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01LiwV7RUf4ofLjnQCwGFkgd","type":"message","role":"assistant","model":"claude-sonnet-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":1825,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":30,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:50:53 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-sonnet-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"description\":\"Checks
        the LoanFile against all requirements in its CreditPolicy. Denies the LoanFile
        that has any unsatisfied requirements.\",\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"inputs\":{\"loan_file\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"decision\":\"denied\",\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"id\":3}}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review all loan files needing review\n\nYou will answer with the name of the
        next command to run and, if needed, its inputs. Choose whichever command is
        best to make progress towards accomplishing the current goal based on the
        progress made so far. If the goal has been accomplished then choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command. If you are stuck either due to errors or because you do not have
        the command you need to accomplish the goal, then choose GiveUp.\n\nYou can
        get more details about the inputs and result schemas for a specific command
        by choosing the DescribeCommand command.\n\nYour result type is described
        by the following JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:50:55 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '800000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '800000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:50:54Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '160000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '160000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:50:55Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:50:53Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '960000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '960000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:50:54Z'
      Request-Id:
      - req_011CRQcQMHEui6gG7FzsmZqi
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963e0d7e498b15b0-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_014aEQACtYWwQP9hSwV2yS7X","type":"message","role":"assistant","model":"claude-sonnet-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"inputs\":{\"loan_file\":3}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":1972,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":31,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:50:55 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review loan file\n\nYour behavior has been described to the person or agent
        that chose to run you as: Checks the LoanFile against all requirements in
        its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements.\n\nYour
        inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}}}\n\nYou have been ran with the following inputs:\n\n{\"loan_file\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":{\"id\":3,\"institution\":\"Bank
        C\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":1},\"id\":3}}\n\nYou
        will answer with the name of the next command to run and, if needed, its inputs.
        Choose whichever command is best to make progress towards accomplishing the
        current goal based on the progress made so far. If the goal has been accomplished
        then choose the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you
        are stuck either due to errors or because you do not have the command you
        need to accomplish the goal, then choose GiveUp.\n\nYou can get more details
        about the inputs and result schemas for a specific command by choosing the
        DescribeCommand command.\n\nYour result type is described by the following
        JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:51:01 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:50:57Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:51:02Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:50:55Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '96000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '96000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:50:57Z'
      Request-Id:
      - req_011CRQcQTL83AADkC2ubZG9i
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963e0d872c8bf037-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01Gk6CY1PmpetPLg7o82mwM3","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"I
        need to review the loan file against the credit policy requirements. Let me
        check the details:\n\n1. The loan file has a credit policy that requires:\n   -
        Minimum credit score: 700\n   - Credit score to use: \"maximum\" (use the
        highest score)\n   - Minimum pay stub count: 1\n\n2. The loan file contains:\n   -
        Credit scores: 600 (Experian), 650 (Equifax), 750 (TransUnion)\n   - Maximum
        credit score: 750\n   - Pay stubs: 1 pay stub provided\n\nThe maximum credit
        score (750) meets the minimum requirement of 700, and there is 1 pay stub
        which meets the minimum requirement of 1. All requirements are satisfied,
        so I should approve the loan file.\n\n{\"command\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"inputs\":{\"loan_file_id\":3}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":1375,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":211,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:51:01 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"agent\":\"#<Foobara::Agent:0x00007fd7cb20f648>\",\"llm_model\":\"claude-opus-4-20250514\",\"pass_aggregates_to_llm\":true}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"runtime.could_not_parse_result_json\":{\"key\":\"runtime.could_not_parse_result_json\",\"path\":[],\"runtime_path\":[],\"category\":\"runtime\",\"symbol\":\"could_not_parse_result_json\",\"message\":\"Could
        not parse result JSON: unexpected token ''I'' at line 1 column 1\",\"context\":{\"raw_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check the details:\\n\\n1. The loan file has a credit policy that requires:\\n   -
        Minimum credit score: 700\\n   - Credit score to use: \\\"maximum\\\" (use
        the highest score)\\n   - Minimum pay stub count: 1\\n\\n2. The loan file
        contains:\\n   - Credit scores: 600 (Experian), 650 (Equifax), 750 (TransUnion)\\n   -
        Maximum credit score: 750\\n   - Pay stubs: 1 pay stub provided\\n\\nThe maximum
        credit score (750) meets the minimum requirement of 700, and there is 1 pay
        stub which meets the minimum requirement of 1. All requirements are satisfied,
        so I should approve the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::ApproveLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":3}}\",\"stripped_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check the details:\\n\\n1. The loan file has a credit policy that requires:\\n   -
        Minimum credit score: 700\\n   - Credit score to use: \\\"maximum\\\" (use
        the highest score)\\n   - Minimum pay stub count: 1\\n\\n2. The loan file
        contains:\\n   - Credit scores: 600 (Experian), 650 (Equifax), 750 (TransUnion)\\n   -
        Maximum credit score: 750\\n   - Pay stubs: 1 pay stub provided\\n\\nThe maximum
        credit score (750) meets the minimum requirement of 700, and there is 1 pay
        stub which meets the minimum requirement of 1. All requirements are satisfied,
        so I should approve the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::ApproveLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":3}}\"},\"is_fatal\":false}}}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review loan file\n\nYour behavior has been described to the person or agent
        that chose to run you as: Checks the LoanFile against all requirements in
        its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements.\n\nYour
        inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}}}\n\nYou have been ran with the following inputs:\n\n{\"loan_file\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":{\"id\":3,\"institution\":\"Bank
        C\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":1},\"id\":3}}\n\nYou
        will answer with the name of the next command to run and, if needed, its inputs.
        Choose whichever command is best to make progress towards accomplishing the
        current goal based on the progress made so far. If the goal has been accomplished
        then choose the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you
        are stuck either due to errors or because you do not have the command you
        need to accomplish the goal, then choose GiveUp.\n\nYou can get more details
        about the inputs and result schemas for a specific command by choosing the
        DescribeCommand command.\n\nYour result type is described by the following
        JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:51:04 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:51:03Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:51:04Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:51:01Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '96000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '96000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:51:03Z'
      Request-Id:
      - req_011CRQcQwqs4VWYQKjAXbtks
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963e0db0dc29ebed-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01DDRXbLuGP3zX2dXYzzkkf8","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"inputs\":{\"loan_file_id\":3}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2011,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":34,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:51:04 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"agent\":\"#<Foobara::Agent:0x00007fd7cb20f648>\",\"llm_model\":\"claude-opus-4-20250514\",\"pass_aggregates_to_llm\":true}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"runtime.could_not_parse_result_json\":{\"key\":\"runtime.could_not_parse_result_json\",\"path\":[],\"runtime_path\":[],\"category\":\"runtime\",\"symbol\":\"could_not_parse_result_json\",\"message\":\"Could
        not parse result JSON: unexpected token ''I'' at line 1 column 1\",\"context\":{\"raw_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check the details:\\n\\n1. The loan file has a credit policy that requires:\\n   -
        Minimum credit score: 700\\n   - Credit score to use: \\\"maximum\\\" (use
        the highest score)\\n   - Minimum pay stub count: 1\\n\\n2. The loan file
        contains:\\n   - Credit scores: 600 (Experian), 650 (Equifax), 750 (TransUnion)\\n   -
        Maximum credit score: 750\\n   - Pay stubs: 1 pay stub provided\\n\\nThe maximum
        credit score (750) meets the minimum requirement of 700, and there is 1 pay
        stub which meets the minimum requirement of 1. All requirements are satisfied,
        so I should approve the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::ApproveLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":3}}\",\"stripped_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check the details:\\n\\n1. The loan file has a credit policy that requires:\\n   -
        Minimum credit score: 700\\n   - Credit score to use: \\\"maximum\\\" (use
        the highest score)\\n   - Minimum pay stub count: 1\\n\\n2. The loan file
        contains:\\n   - Credit scores: 600 (Experian), 650 (Equifax), 750 (TransUnion)\\n   -
        Maximum credit score: 750\\n   - Pay stubs: 1 pay stub provided\\n\\nThe maximum
        credit score (750) meets the minimum requirement of 700, and there is 1 pay
        stub which meets the minimum requirement of 1. All requirements are satisfied,
        so I should approve the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::ApproveLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":3}}\"},\"is_fatal\":false}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"}],"temperature":0.0,"system":"You are part of an agent implementation.
        Your task is to decide which command to run next.\n\nYou are working towards
        accomplishing the following goal: Review loan file\n\nYour behavior has been
        described to the person or agent that chose to run you as: Checks the LoanFile
        against all requirements in its CreditPolicy. Denies the LoanFile that has
        any unsatisfied requirements.\n\nYour inputs to this command have the following
        type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}}}\n\nYou have been ran with the following inputs:\n\n{\"loan_file\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":{\"id\":3,\"institution\":\"Bank
        C\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":1},\"id\":3}}\n\nYou
        will answer with the name of the next command to run and, if needed, its inputs.
        Choose whichever command is best to make progress towards accomplishing the
        current goal based on the progress made so far. If the goal has been accomplished
        then choose the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you
        are stuck either due to errors or because you do not have the command you
        need to accomplish the goal, then choose GiveUp.\n\nYou can get more details
        about the inputs and result schemas for a specific command by choosing the
        DescribeCommand command.\n\nYour result type is described by the following
        JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:51:07 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:51:06Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:51:07Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:51:04Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '96000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '96000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:51:06Z'
      Request-Id:
      - req_011CRQcR7rNroX6EaMDoCbod
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963e0dbf5b5f67f1-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01NMibRwi4VN5ta5BfdXTxxE","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"inputs\":{\"loan_file\":3,\"credit_score_used\":750}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2148,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":40,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:51:07 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"agent\":\"#<Foobara::Agent:0x00007fd7cb20f648>\",\"llm_model\":\"claude-opus-4-20250514\",\"pass_aggregates_to_llm\":true}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"runtime.could_not_parse_result_json\":{\"key\":\"runtime.could_not_parse_result_json\",\"path\":[],\"runtime_path\":[],\"category\":\"runtime\",\"symbol\":\"could_not_parse_result_json\",\"message\":\"Could
        not parse result JSON: unexpected token ''I'' at line 1 column 1\",\"context\":{\"raw_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check the details:\\n\\n1. The loan file has a credit policy that requires:\\n   -
        Minimum credit score: 700\\n   - Credit score to use: \\\"maximum\\\" (use
        the highest score)\\n   - Minimum pay stub count: 1\\n\\n2. The loan file
        contains:\\n   - Credit scores: 600 (Experian), 650 (Equifax), 750 (TransUnion)\\n   -
        Maximum credit score: 750\\n   - Pay stubs: 1 pay stub provided\\n\\nThe maximum
        credit score (750) meets the minimum requirement of 700, and there is 1 pay
        stub which meets the minimum requirement of 1. All requirements are satisfied,
        so I should approve the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::ApproveLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":3}}\",\"stripped_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check the details:\\n\\n1. The loan file has a credit policy that requires:\\n   -
        Minimum credit score: 700\\n   - Credit score to use: \\\"maximum\\\" (use
        the highest score)\\n   - Minimum pay stub count: 1\\n\\n2. The loan file
        contains:\\n   - Credit scores: 600 (Experian), 650 (Equifax), 750 (TransUnion)\\n   -
        Maximum credit score: 750\\n   - Pay stubs: 1 pay stub provided\\n\\nThe maximum
        credit score (750) meets the minimum requirement of 700, and there is 1 pay
        stub which meets the minimum requirement of 1. All requirements are satisfied,
        so I should approve the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::ApproveLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":3}}\"},\"is_fatal\":false}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"inputs\":{\"loan_file\":3,\"credit_score_used\":750}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"data.loan_file.cannot_transition_state\":{\"key\":\"data.loan_file.cannot_transition_state\",\"path\":[\"loan_file\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"cannot_transition_state\",\"message\":\"Cannot
        perform approve transition for loan file 3 from needs_review. Expected state
        to be one of: [:in_review]. Did you forget to start the review?\",\"context\":{\"loan_file_id\":3,\"current_state\":\"needs_review\",\"required_states\":[\"in_review\"],\"attempted_transition\":\"approve\"},\"is_fatal\":false}}}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review loan file\n\nYour behavior has been described to the person or agent
        that chose to run you as: Checks the LoanFile against all requirements in
        its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements.\n\nYour
        inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}}}\n\nYou have been ran with the following inputs:\n\n{\"loan_file\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":{\"id\":3,\"institution\":\"Bank
        C\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":1},\"id\":3}}\n\nYou
        will answer with the name of the next command to run and, if needed, its inputs.
        Choose whichever command is best to make progress towards accomplishing the
        current goal based on the progress made so far. If the goal has been accomplished
        then choose the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you
        are stuck either due to errors or because you do not have the command you
        need to accomplish the goal, then choose GiveUp.\n\nYou can get more details
        about the inputs and result schemas for a specific command by choosing the
        DescribeCommand command.\n\nYour result type is described by the following
        JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:51:10 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:51:09Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:51:10Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:51:07Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '96000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '96000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:51:09Z'
      Request-Id:
      - req_011CRQcRMY9K6gQukWEuoZp3
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963e0dd37a6d7aac-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_011DYxvX6sfr96SS9nRyUrmR","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":3}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2335,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":34,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:51:10 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"agent\":\"#<Foobara::Agent:0x00007fd7cb20f648>\",\"llm_model\":\"claude-opus-4-20250514\",\"pass_aggregates_to_llm\":true}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"runtime.could_not_parse_result_json\":{\"key\":\"runtime.could_not_parse_result_json\",\"path\":[],\"runtime_path\":[],\"category\":\"runtime\",\"symbol\":\"could_not_parse_result_json\",\"message\":\"Could
        not parse result JSON: unexpected token ''I'' at line 1 column 1\",\"context\":{\"raw_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check the details:\\n\\n1. The loan file has a credit policy that requires:\\n   -
        Minimum credit score: 700\\n   - Credit score to use: \\\"maximum\\\" (use
        the highest score)\\n   - Minimum pay stub count: 1\\n\\n2. The loan file
        contains:\\n   - Credit scores: 600 (Experian), 650 (Equifax), 750 (TransUnion)\\n   -
        Maximum credit score: 750\\n   - Pay stubs: 1 pay stub provided\\n\\nThe maximum
        credit score (750) meets the minimum requirement of 700, and there is 1 pay
        stub which meets the minimum requirement of 1. All requirements are satisfied,
        so I should approve the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::ApproveLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":3}}\",\"stripped_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check the details:\\n\\n1. The loan file has a credit policy that requires:\\n   -
        Minimum credit score: 700\\n   - Credit score to use: \\\"maximum\\\" (use
        the highest score)\\n   - Minimum pay stub count: 1\\n\\n2. The loan file
        contains:\\n   - Credit scores: 600 (Experian), 650 (Equifax), 750 (TransUnion)\\n   -
        Maximum credit score: 750\\n   - Pay stubs: 1 pay stub provided\\n\\nThe maximum
        credit score (750) meets the minimum requirement of 700, and there is 1 pay
        stub which meets the minimum requirement of 1. All requirements are satisfied,
        so I should approve the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::ApproveLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":3}}\"},\"is_fatal\":false}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"inputs\":{\"loan_file\":3,\"credit_score_used\":750}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"data.loan_file.cannot_transition_state\":{\"key\":\"data.loan_file.cannot_transition_state\",\"path\":[\"loan_file\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"cannot_transition_state\",\"message\":\"Cannot
        perform approve transition for loan file 3 from needs_review. Expected state
        to be one of: [:in_review]. Did you forget to start the review?\",\"context\":{\"loan_file_id\":3,\"current_state\":\"needs_review\",\"required_states\":[\"in_review\"],\"attempted_transition\":\"approve\"},\"is_fatal\":false}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"}],"temperature":0.0,"system":"You are part of an agent implementation.
        Your task is to decide which command to run next.\n\nYou are working towards
        accomplishing the following goal: Review loan file\n\nYour behavior has been
        described to the person or agent that chose to run you as: Checks the LoanFile
        against all requirements in its CreditPolicy. Denies the LoanFile that has
        any unsatisfied requirements.\n\nYour inputs to this command have the following
        type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}}}\n\nYou have been ran with the following inputs:\n\n{\"loan_file\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":{\"id\":3,\"institution\":\"Bank
        C\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":1},\"id\":3}}\n\nYou
        will answer with the name of the next command to run and, if needed, its inputs.
        Choose whichever command is best to make progress towards accomplishing the
        current goal based on the progress made so far. If the goal has been accomplished
        then choose the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you
        are stuck either due to errors or because you do not have the command you
        need to accomplish the goal, then choose GiveUp.\n\nYou can get more details
        about the inputs and result schemas for a specific command by choosing the
        DescribeCommand command.\n\nYour result type is described by the following
        JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:51:12 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '79000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:51:12Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:51:12Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:51:10Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '96000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '95000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:51:12Z'
      Request-Id:
      - req_011CRQcRb6UHfe3nfSYn9FAf
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963e0de74f9ded3d-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_015E2efEpr8epeV4YTmxM87n","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":3}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2458,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":34,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:51:13 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"agent\":\"#<Foobara::Agent:0x00007fd7cb20f648>\",\"llm_model\":\"claude-opus-4-20250514\",\"pass_aggregates_to_llm\":true}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"runtime.could_not_parse_result_json\":{\"key\":\"runtime.could_not_parse_result_json\",\"path\":[],\"runtime_path\":[],\"category\":\"runtime\",\"symbol\":\"could_not_parse_result_json\",\"message\":\"Could
        not parse result JSON: unexpected token ''I'' at line 1 column 1\",\"context\":{\"raw_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check the details:\\n\\n1. The loan file has a credit policy that requires:\\n   -
        Minimum credit score: 700\\n   - Credit score to use: \\\"maximum\\\" (use
        the highest score)\\n   - Minimum pay stub count: 1\\n\\n2. The loan file
        contains:\\n   - Credit scores: 600 (Experian), 650 (Equifax), 750 (TransUnion)\\n   -
        Maximum credit score: 750\\n   - Pay stubs: 1 pay stub provided\\n\\nThe maximum
        credit score (750) meets the minimum requirement of 700, and there is 1 pay
        stub which meets the minimum requirement of 1. All requirements are satisfied,
        so I should approve the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::ApproveLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":3}}\",\"stripped_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check the details:\\n\\n1. The loan file has a credit policy that requires:\\n   -
        Minimum credit score: 700\\n   - Credit score to use: \\\"maximum\\\" (use
        the highest score)\\n   - Minimum pay stub count: 1\\n\\n2. The loan file
        contains:\\n   - Credit scores: 600 (Experian), 650 (Equifax), 750 (TransUnion)\\n   -
        Maximum credit score: 750\\n   - Pay stubs: 1 pay stub provided\\n\\nThe maximum
        credit score (750) meets the minimum requirement of 700, and there is 1 pay
        stub which meets the minimum requirement of 1. All requirements are satisfied,
        so I should approve the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::ApproveLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":3}}\"},\"is_fatal\":false}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"inputs\":{\"loan_file\":3,\"credit_score_used\":750}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"data.loan_file.cannot_transition_state\":{\"key\":\"data.loan_file.cannot_transition_state\",\"path\":[\"loan_file\"],\"runtime_path\":[],\"category\":\"data\",\"symbol\":\"cannot_transition_state\",\"message\":\"Cannot
        perform approve transition for loan file 3 from needs_review. Expected state
        to be one of: [:in_review]. Did you forget to start the review?\",\"context\":{\"loan_file_id\":3,\"current_state\":\"needs_review\",\"required_states\":[\"in_review\"],\"attempted_transition\":\"approve\"},\"is_fatal\":false}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review loan file\n\nYour behavior has been described to the person or agent
        that chose to run you as: Checks the LoanFile against all requirements in
        its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements.\n\nYour
        inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}}}\n\nYou have been ran with the following inputs:\n\n{\"loan_file\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":{\"id\":3,\"institution\":\"Bank
        C\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":1},\"id\":3}}\n\nYou
        will answer with the name of the next command to run and, if needed, its inputs.
        Choose whichever command is best to make progress towards accomplishing the
        current goal based on the progress made so far. If the goal has been accomplished
        then choose the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you
        are stuck either due to errors or because you do not have the command you
        need to accomplish the goal, then choose GiveUp.\n\nYou can get more details
        about the inputs and result schemas for a specific command by choosing the
        DescribeCommand command.\n\nYour result type is described by the following
        JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:51:16 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:51:16Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:51:16Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:51:13Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '96000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '96000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:51:16Z'
      Request-Id:
      - req_011CRQcRn2ny1X89rTGi2Cdm
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963e0df74ad35850-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01CTgRU1cTeAsfYiF7Xd4znT","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"inputs\":{\"loan_file\":3,\"credit_score_used\":750}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2504,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":40,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:51:16 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"agent\":\"#<Foobara::Agent:0x00007fd7cb20f648>\",\"llm_model\":\"claude-opus-4-20250514\",\"pass_aggregates_to_llm\":true}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"runtime.could_not_parse_result_json\":{\"key\":\"runtime.could_not_parse_result_json\",\"path\":[],\"runtime_path\":[],\"category\":\"runtime\",\"symbol\":\"could_not_parse_result_json\",\"message\":\"Could
        not parse result JSON: unexpected token ''I'' at line 1 column 1\",\"context\":{\"raw_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check the details:\\n\\n1. The loan file has a credit policy that requires:\\n   -
        Minimum credit score: 700\\n   - Credit score to use: \\\"maximum\\\" (use
        the highest score)\\n   - Minimum pay stub count: 1\\n\\n2. The loan file
        contains:\\n   - Credit scores: 600 (Experian), 650 (Equifax), 750 (TransUnion)\\n   -
        Maximum credit score: 750\\n   - Pay stubs: 1 pay stub provided\\n\\nThe maximum
        credit score (750) meets the minimum requirement of 700, and there is 1 pay
        stub which meets the minimum requirement of 1. All requirements are satisfied,
        so I should approve the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::ApproveLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":3}}\",\"stripped_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check the details:\\n\\n1. The loan file has a credit policy that requires:\\n   -
        Minimum credit score: 700\\n   - Credit score to use: \\\"maximum\\\" (use
        the highest score)\\n   - Minimum pay stub count: 1\\n\\n2. The loan file
        contains:\\n   - Credit scores: 600 (Experian), 650 (Equifax), 750 (TransUnion)\\n   -
        Maximum credit score: 750\\n   - Pay stubs: 1 pay stub provided\\n\\nThe maximum
        credit score (750) meets the minimum requirement of 700, and there is 1 pay
        stub which meets the minimum requirement of 1. All requirements are satisfied,
        so I should approve the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::ApproveLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":3}}\"},\"is_fatal\":false}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"inputs\":{\"loan_file\":3,\"credit_score_used\":750}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review loan file\n\nYour behavior has been described to the person or agent
        that chose to run you as: Checks the LoanFile against all requirements in
        its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements.\n\nYour
        inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}}}\n\nYou have been ran with the following inputs:\n\n{\"loan_file\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":{\"id\":3,\"institution\":\"Bank
        C\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":1},\"id\":3}}\n\nYou
        will answer with the name of the next command to run and, if needed, its inputs.
        Choose whichever command is best to make progress towards accomplishing the
        current goal based on the progress made so far. If the goal has been accomplished
        then choose the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you
        are stuck either due to errors or because you do not have the command you
        need to accomplish the goal, then choose GiveUp.\n\nYou can get more details
        about the inputs and result schemas for a specific command by choosing the
        DescribeCommand command.\n\nYour result type is described by the following
        JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:51:18 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '79000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:51:18Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:51:19Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:51:17Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '96000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '95000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:51:18Z'
      Request-Id:
      - req_011CRQcS4TGEX4sdaZ9Kyqcs
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963e0e0f389b67cd-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_012b8bqELoH5xJYk4b49YkJk","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\"}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2369,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":34,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:51:19 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-opus-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"FoobaraDemo::LoanOrigination::DenyLoanFile\",\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DetermineNextCommandNameAndInputs\",\"inputs\":{\"agent\":\"#<Foobara::Agent:0x00007fd7cb20f648>\",\"llm_model\":\"claude-opus-4-20250514\",\"pass_aggregates_to_llm\":true}}"},{"role":"user","content":"{\"success\":false,\"errors_hash\":{\"runtime.could_not_parse_result_json\":{\"key\":\"runtime.could_not_parse_result_json\",\"path\":[],\"runtime_path\":[],\"category\":\"runtime\",\"symbol\":\"could_not_parse_result_json\",\"message\":\"Could
        not parse result JSON: unexpected token ''I'' at line 1 column 1\",\"context\":{\"raw_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check the details:\\n\\n1. The loan file has a credit policy that requires:\\n   -
        Minimum credit score: 700\\n   - Credit score to use: \\\"maximum\\\" (use
        the highest score)\\n   - Minimum pay stub count: 1\\n\\n2. The loan file
        contains:\\n   - Credit scores: 600 (Experian), 650 (Equifax), 750 (TransUnion)\\n   -
        Maximum credit score: 750\\n   - Pay stubs: 1 pay stub provided\\n\\nThe maximum
        credit score (750) meets the minimum requirement of 700, and there is 1 pay
        stub which meets the minimum requirement of 1. All requirements are satisfied,
        so I should approve the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::ApproveLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":3}}\",\"stripped_answer\":\"I
        need to review the loan file against the credit policy requirements. Let me
        check the details:\\n\\n1. The loan file has a credit policy that requires:\\n   -
        Minimum credit score: 700\\n   - Credit score to use: \\\"maximum\\\" (use
        the highest score)\\n   - Minimum pay stub count: 1\\n\\n2. The loan file
        contains:\\n   - Credit scores: 600 (Experian), 650 (Equifax), 750 (TransUnion)\\n   -
        Maximum credit score: 750\\n   - Pay stubs: 1 pay stub provided\\n\\nThe maximum
        credit score (750) meets the minimum requirement of 700, and there is 1 pay
        stub which meets the minimum requirement of 1. All requirements are satisfied,
        so I should approve the loan file.\\n\\n{\\\"command\\\":\\\"FoobaraDemo::LoanOrigination::ApproveLoanFile\\\",\\\"inputs\\\":{\\\"loan_file_id\\\":3}}\"},\"is_fatal\":false}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"loan_file\"],\"properties\":{\"credit_score_used\":{\"type\":\"number\"},\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"description\":null,\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::StartUnderwriterReview\",\"inputs\":{\"loan_file\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ApproveLoanFile\",\"inputs\":{\"loan_file\":3,\"credit_score_used\":750}}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\",\"description\":\"Notifies
        the user that the current goal has been accomplished and accepts a final result
        value as inputs. The user might issue a new goal.\",\"inputs_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}}}}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review loan file\n\nYour behavior has been described to the person or agent
        that chose to run you as: Checks the LoanFile against all requirements in
        its CreditPolicy. Denies the LoanFile that has any unsatisfied requirements.\n\nYour
        inputs to this command have the following type:\n\n{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"object\",\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"object\",\"required\":[\"credit_score_to_use\",\"institution\",\"minimum_credit_score\",\"minimum_pay_stub_count\"],\"properties\":{\"id\":{\"type\":\"number\"},\"institution\":{\"type\":\"string\"},\"minimum_pay_stub_count\":{\"type\":\"number\",\"description\":\"The
        loan file must have at least this many pay stubs.\"},\"minimum_credit_score\":{\"type\":\"number\"},\"credit_score_to_use\":{\"type\":\"string\",\"enum\":[\"median\",\"maximum\"],\"description\":\"If
        the scores are 500, 650, and 700, then maximum will compare the biggest (700)
        against minimum_credit_score and median will compare the median (650) against
        minimum_credit_score.\"}}}}}}}\n\nYou have been ran with the following inputs:\n\n{\"loan_file\":{\"state\":\"needs_review\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":{\"id\":3,\"institution\":\"Bank
        C\",\"minimum_credit_score\":700,\"credit_score_to_use\":\"maximum\",\"minimum_pay_stub_count\":1},\"id\":3}}\n\nYou
        will answer with the name of the next command to run and, if needed, its inputs.
        Choose whichever command is best to make progress towards accomplishing the
        current goal based on the progress made so far. If the goal has been accomplished
        then choose the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you
        are stuck either due to errors or because you do not have the command you
        need to accomplish the goal, then choose GiveUp.\n\nYou can get more details
        about the inputs and result schemas for a specific command by choosing the
        DescribeCommand command.\n\nYour result type is described by the following
        JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:51:24 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '80000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:51:23Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '16000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:51:24Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:51:19Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '96000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '96000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:51:23Z'
      Request-Id:
      - req_011CRQcSDwmeSMmgRHTzV9Ct
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963e0e1d2e37176d-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01SUj1cRexiqHppqHCviC7mT","type":"message","role":"assistant","model":"claude-opus-4-20250514","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::ReviewLoanFile::NotifyUserThatCurrentGoalHasBeenAccomplished\",\"inputs\":{\"decision\":\"approved\",\"credit_score_used\":750}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2589,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":49,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:51:24 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-sonnet-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"description\":\"Checks
        the LoanFile against all requirements in its CreditPolicy. Denies the LoanFile
        that has any unsatisfied requirements.\",\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"inputs\":{\"loan_file\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"decision\":\"denied\",\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"drafting_docs\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"id\":3,\"underwriter_decision\":{\"decision\":\"approved\",\"credit_score_used\":750}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"inputs\":{\"loan_file\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"decision\":\"approved\",\"credit_score_used\":750,\"denied_reasons\":[]}}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review all loan files needing review\n\nYou will answer with the name of the
        next command to run and, if needed, its inputs. Choose whichever command is
        best to make progress towards accomplishing the current goal based on the
        progress made so far. If the goal has been accomplished then choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command. If you are stuck either due to errors or because you do not have
        the command you need to accomplish the goal, then choose GiveUp.\n\nYou can
        get more details about the inputs and result schemas for a specific command
        by choosing the DescribeCommand command.\n\nYour result type is described
        by the following JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:51:25 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '800000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '800000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:51:25Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '160000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '160000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:51:25Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:51:24Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '960000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '960000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:51:25Z'
      Request-Id:
      - req_011CRQcSd92xDpWA5By7K9DB
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963e0e3f090722f6-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_013x2bMKc3sggLAS1q4gEAdw","type":"message","role":"assistant","model":"claude-sonnet-4-20250514","content":[{"type":"text","text":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2052,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":30,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:51:25 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-sonnet-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"description\":\"Checks
        the LoanFile against all requirements in its CreditPolicy. Denies the LoanFile
        that has any unsatisfied requirements.\",\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"inputs\":{\"loan_file\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"decision\":\"denied\",\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"drafting_docs\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"id\":3,\"underwriter_decision\":{\"decision\":\"approved\",\"credit_score_used\":750}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"inputs\":{\"loan_file\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"decision\":\"approved\",\"credit_score_used\":750,\"denied_reasons\":[]}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":null}"}],"temperature":0.0,"system":"You
        are part of an agent implementation. Your task is to decide which command
        to run next.\n\nYou are working towards accomplishing the following goal:
        Review all loan files needing review\n\nYou will answer with the name of the
        next command to run and, if needed, its inputs. Choose whichever command is
        best to make progress towards accomplishing the current goal based on the
        progress made so far. If the goal has been accomplished then choose the NotifyUserThatCurrentGoalHasBeenAccomplished
        command. If you are stuck either due to errors or because you do not have
        the command you need to accomplish the goal, then choose GiveUp.\n\nYou can
        get more details about the inputs and result schemas for a specific command
        by choosing the DescribeCommand command.\n\nYour result type is described
        by the following JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:51:27 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '800000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '800000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:51:27Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '160000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '160000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:51:27Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:51:26Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '960000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '960000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:51:27Z'
      Request-Id:
      - req_011CRQcSjHNRdFmtvT4bMR77
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963e0e480a3615e5-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01XByFGoMF4ZfLPQxBjVhHfJ","type":"message","role":"assistant","model":"claude-sonnet-4-20250514","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\"}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2094,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":41,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:51:27 GMT
- request:
    method: post
    uri: https://api.anthropic.com/v1/messages
    body:
      encoding: UTF-8
      string: '{"model":"claude-sonnet-4-20250514","max_tokens":1024,"messages":[{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ListCommands\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ListCommands\",\"description\":null,\"inputs_type\":{\"type\":\"object\"},\"result_type\":{\"type\":\"object\",\"required\":[\"agent_specific_commands\",\"user_provided_commands\"],\"properties\":{\"user_provided_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"List
        of commands the user would like you to choose from to accomplish the goal\"},\"agent_specific_commands\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"description\":\"Commands
        available to all agents to introspect or end the session\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::ListCommands\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"user_provided_commands\":[\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"],\"agent_specific_commands\":[\"Foobara::Agent::DescribeCommand\",\"Foobara::Agent::DescribeType\",\"Foobara::Agent::GiveUp\",\"Foobara::Agent::ListCommands\",\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\"]}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\",\"description\":\"Will
        return a loan file that needs review or nil if there are no loan files that
        need review\",\"result_type\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_scores\",\"loan_application\",\"pay_stubs\",\"state\"],\"properties\":{\"id\":{\"type\":\"number\"},\"loan_application\":{\"type\":\"object\",\"required\":[\"applicant\"],\"properties\":{\"applicant\":{\"type\":\"object\",\"required\":[\"name\"],\"properties\":{\"name\":{\"type\":\"string\"}}}}},\"state\":{\"type\":\"string\",\"enum\":[\"building_loan_file\",\"denied\",\"drafting_docs\",\"in_escrow\",\"in_review\",\"needs_review\",\"recorded\"]},\"pay_stubs\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"required\":[\"amount\",\"date\",\"employer\"],\"properties\":{\"amount\":{\"type\":\"number\",\"description\":\"Amount
        in dollars of the pay check\"},\"date\":{\"type\":\"string\",\"format\":\"date\",\"description\":\"Date
        the paycheck was issued\"},\"employer\":{\"type\":\"string\",\"description\":\"Name
        of the employer that issued this paycheck\"}}}},\"credit_scores\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"score\":{\"type\":\"number\"},\"reporting_agency\":{\"type\":\"string\",\"enum\":[\"equifax\",\"experian\",\"transunion\"]}}}},\"underwriter_decision\":{\"type\":[\"object\",\"null\"],\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}},\"credit_policy\":{\"type\":\"number\",\"description\":\"CreditPolicy
        id\"}}}}}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"description\":\"Checks
        the LoanFile against all requirements in its CreditPolicy. Denies the LoanFile
        that has any unsatisfied requirements.\",\"inputs_type\":{\"type\":\"object\",\"required\":[\"loan_file\"],\"properties\":{\"loan_file\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}},\"result_type\":{\"type\":\"object\",\"required\":[\"credit_score_used\",\"decision\"],\"properties\":{\"decision\":{\"type\":\"string\",\"enum\":[\"approved\",\"denied\"]},\"credit_score_used\":{\"type\":\"number\"},\"denied_reasons\":{\"type\":\"array\",\"items\":{\"type\":\"string\",\"enum\":[\"insufficient_pay_stubs_provided\",\"low_credit_score\"]}}}}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Barbara\"}},\"credit_policy\":1,\"id\":1,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"inputs\":{\"loan_file\":1}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"decision\":\"denied\",\"credit_score_used\":650,\"denied_reasons\":[\"low_credit_score\"]}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"denied\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Basil\"}},\"credit_policy\":2,\"id\":2,\"underwriter_decision\":{\"decision\":\"denied\",\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"inputs\":{\"loan_file\":2}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"decision\":\"denied\",\"credit_score_used\":750,\"denied_reasons\":[\"insufficient_pay_stubs_provided\"]}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":{\"state\":\"drafting_docs\",\"pay_stubs\":[{\"amount\":3000,\"date\":\"2025-06-25\",\"employer\":\"Some
        Employer\"}],\"credit_scores\":[{\"reporting_agency\":\"experian\",\"score\":600},{\"reporting_agency\":\"equifax\",\"score\":650},{\"reporting_agency\":\"transunion\",\"score\":750}],\"loan_application\":{\"applicant\":{\"name\":\"Fumiko\"}},\"credit_policy\":3,\"id\":3,\"underwriter_decision\":{\"decision\":\"approved\",\"credit_score_used\":750}}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::ReviewLoanFile\",\"inputs\":{\"loan_file\":3}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"decision\":\"approved\",\"credit_score_used\":750,\"denied_reasons\":[]}}"},{"role":"assistant","content":"{\"command\":\"FoobaraDemo::LoanOrigination::FindALoanFileThatNeedsReview\"}"},{"role":"user","content":"{\"success\":true,\"result\":null}"},{"role":"assistant","content":"{\"command\":\"Foobara::Agent::DescribeCommand\",\"inputs\":{\"command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\"}}"},{"role":"user","content":"{\"success\":true,\"result\":{\"full_command_name\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\",\"description\":\"Notifies
        the user that the current goal has been accomplished and accepts a final result
        value as inputs. The user might issue a new goal.\",\"inputs_type\":{\"type\":\"object\",\"required\":[\"approved\",\"denied\"],\"properties\":{\"approved\":{\"type\":\"array\",\"items\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}},\"denied\":{\"type\":\"array\",\"items\":{\"type\":\"number\",\"description\":\"LoanFile
        id\"}}}}}}"}],"temperature":0.0,"system":"You are part of an agent implementation.
        Your task is to decide which command to run next.\n\nYou are working towards
        accomplishing the following goal: Review all loan files needing review\n\nYou
        will answer with the name of the next command to run and, if needed, its inputs.
        Choose whichever command is best to make progress towards accomplishing the
        current goal based on the progress made so far. If the goal has been accomplished
        then choose the NotifyUserThatCurrentGoalHasBeenAccomplished command. If you
        are stuck either due to errors or because you do not have the command you
        need to accomplish the goal, then choose GiveUp.\n\nYou can get more details
        about the inputs and result schemas for a specific command by choosing the
        DescribeCommand command.\n\nYour result type is described by the following
        JSON schema:\n\n{\"type\":\"object\",\"required\":[\"command\"],\"properties\":{\"command\":{\"type\":\"string\"},\"inputs\":{\"type\":[\"object\",\"null\"]}}}\n\nYou
        will reply with nothing more than the JSON that you''ve generated that adheres
        to this result type schema so that the calling code can successfully parse
        your answer."}'
    headers:
      Content-Type:
      - application/json
      X-Api-Key:
      - "<SCRUBBED_ANTHROPIC_API_KEY>"
      Anthropic-Version:
      - '2023-06-01'
      Accept-Encoding:
      - gzip;q=1.0,deflate;q=0.6,identity;q=0.3
      Accept:
      - "*/*"
      User-Agent:
      - Ruby
  response:
    status:
      code: 200
      message: OK
    headers:
      Date:
      - Wed, 23 Jul 2025 20:51:29 GMT
      Content-Type:
      - application/json
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Anthropic-Ratelimit-Input-Tokens-Limit:
      - '800000'
      Anthropic-Ratelimit-Input-Tokens-Remaining:
      - '800000'
      Anthropic-Ratelimit-Input-Tokens-Reset:
      - '2025-07-23T20:51:28Z'
      Anthropic-Ratelimit-Output-Tokens-Limit:
      - '160000'
      Anthropic-Ratelimit-Output-Tokens-Remaining:
      - '160000'
      Anthropic-Ratelimit-Output-Tokens-Reset:
      - '2025-07-23T20:51:29Z'
      Anthropic-Ratelimit-Requests-Limit:
      - '2000'
      Anthropic-Ratelimit-Requests-Remaining:
      - '1999'
      Anthropic-Ratelimit-Requests-Reset:
      - '2025-07-23T20:51:28Z'
      Anthropic-Ratelimit-Tokens-Limit:
      - '960000'
      Anthropic-Ratelimit-Tokens-Remaining:
      - '960000'
      Anthropic-Ratelimit-Tokens-Reset:
      - '2025-07-23T20:51:28Z'
      Request-Id:
      - req_011CRQcSsBsv2BRXCM4zvSRL
      Strict-Transport-Security:
      - max-age=31536000; includeSubDomains; preload
      Anthropic-Organization-Id:
      - 7a8e3751-3b70-4f90-a3ce-07f57c9d0bfc
      Via:
      - 1.1 google
      Cf-Cache-Status:
      - DYNAMIC
      X-Robots-Tag:
      - none
      Server:
      - cloudflare
      Cf-Ray:
      - 963e0e53a8ddeb24-SJC
    body:
      encoding: ASCII-8BIT
      string: '{"id":"msg_01LqEi6Hx2oCTwwtJ3qyTq5d","type":"message","role":"assistant","model":"claude-sonnet-4-20250514","content":[{"type":"text","text":"{\"command\":\"Foobara::Agent::ReviewAllLoanFilesNeedingReview::NotifyUserThatCurrentGoalHasBeenAccomplished\",\"inputs\":{\"approved\":[3],\"denied\":[1,2]}}"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":2306,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":58,"service_tier":"standard"}}'
  recorded_at: Wed, 23 Jul 2025 20:51:29 GMT
recorded_with: VCR 6.3.1
